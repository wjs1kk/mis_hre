(function(){try{var a={pluginName:"magicjscrypto",isLoadedComplete:!1,module:null,iv:null,secretKey:null,cipher:null,cipherKey:"",digest:null,originalMD:null,encryptedMD:null};G_KUPlugin.magicjscrypto=a;a.isRequiredCheck=function(b){return a.isLoadedComplete};var g=function(a,c){var e=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript";d.onload=function(){c(!0)};d.onerror=function(){c(!1)};d.src=a;e.appendChild(d)};a.onInit=function(){var b=KUPLOADTOP.G_CURRKUPLOADER._config.webPath.plugin+
"magicjscrypto/js"+(KUPLOADTOP.RAONKUPLOAD.isRelease?"":"_dev")+"/config.js",b=b+("?t="+KUPLOADTOP.RAONKUPLOAD.util.getTimeStamp());g(b,function(b){if(0==b)a.isLoadError=!0,a.isLoadedComplete=!0;else{var e=G_KUPlugin.magicjscrypto.options.extraJsModules,d=e.length;0==d&&e.push(KUPLOADTOP.G_CURRKUPLOADER._config.webPath.plugin+"magicjscrypto/js/magicjs_1.2.4.0.min.js");var h=0,f=e[0]+"?t="+KUPLOADTOP.RAONKUPLOAD.util.getTimeStamp(),l=function(){h++;h>=d?a.isLoadedComplete=!0:(f=e[h]+"?t="+KUPLOADTOP.RAONKUPLOAD.util.getTimeStamp(),
g(f,l))};g(f,l)}})};a.onInit();a.onLoaded=function(){if(magicjs)try{a.module=magicjs,"string"==typeof a.options.initKey&&0<a.options.initKey.length&&a.moduleInit(a.options.initKey)}catch(b){var c={strType:"plugin",strCode:"C100",strMessage:b.message};if("function"==typeof KUPLOADTOP.G_CURRKUPLOADER._config.event.onError)KUPLOADTOP.G_CURRKUPLOADER._config.event.onError(KUPLOADTOP.G_CURRKUPLOADER.ID,c);else"function"!==typeof KUPLOADTOP.KUPLOADWIN.RAONKUPLOAD_OnError?alert("Error Code : "+c.strCode+
"\nError Message : "+c.strMessage):KUPLOADTOP.KUPLOADWIN.RAONKUPLOAD_OnError(KUPLOADTOP.G_CURRKUPLOADER.ID,c)}else if(c={strType:"plugin",strCode:"C100",strMessage:"magicjs is null"},"function"==typeof KUPLOADTOP.G_CURRKUPLOADER._config.event.onError)KUPLOADTOP.G_CURRKUPLOADER._config.event.onError(KUPLOADTOP.G_CURRKUPLOADER.ID,c);else"function"!==typeof KUPLOADTOP.KUPLOADWIN.RAONKUPLOAD_OnError?alert("Error Code : "+c.strCode+"\nError Message : "+c.strMessage):KUPLOADTOP.KUPLOADWIN.RAONKUPLOAD_OnError(KUPLOADTOP.G_CURRKUPLOADER.ID,
c)};a.encryptFileData=function(b){var c=null,e=null;try{var d=b.fileArrayBuffer,h=b.callback,f=b.chunkIdx,l=b.isLast,m=b.updateExtraData;b={cipherKey:""};var k=null;0==f&&(m(null),m(b));0==f&&(a.cipher=a.module.cipher.create(!0,"ARIA128-CBC",a.secretKey));"0"==a.options.encrypt.decryptInServer?(0==f&&a.cipher.init(a.iv),k=a.cipher.update(d),l&&(k=a.cipher.finish(),b.cipherKey=a.getCipherKey(),m(b))):(a.cipher.init(a.iv),k=a.cipher.update(d),k=a.cipher.finish(),b.cipherKey=a.getCipherKey(),m(b));e=
k.getBytes()}catch(g){c={message:g.message}}h(a.module.hex.encode(e),c)};a.getCipherKey=function(){return a.cipherKey};a.setCipherKey=function(){a.secretKey=a.module.generateRandomBytes(16);a.iv=a.module.generateRandomBytes(16);var b=a.module.x509Cert.create(a.options.kmCert).pubKey,c=a.module.hex.decode(a.module.hex.encode(a.secretKey)+a.module.hex.encode(a.iv)),b=b.encrypt(c,{md:"SHA1",scheme:"RSA-OAEP"});a.cipherKey=a.module.hex.encode(b)};a.moduleInit=function(b){var c=!0;try{a.options.initKey=
b,a.module.init(a.options.initKey)}catch(e){c=!1}return c}}catch(n){KUPLOADTOP.RAONKUPLOAD.logMode&&console.log(n)}})();
