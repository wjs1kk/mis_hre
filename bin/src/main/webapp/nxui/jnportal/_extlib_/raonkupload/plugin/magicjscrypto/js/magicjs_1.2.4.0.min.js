/*! MagicJS-v1.2.4.0-2021.11.05-(c) 2014~2021, Dreamsecurity co.,ltd. All rights reserved. Some or all of MagicJS module, reproduced without the consent of DreamSecurity, modify, decompile, conversion into other languages is forbidden to use and distribute . MagicJS module is developed based on 'The forge software' of Digital Bazaar.*/
"undefined"==typeof dreamsecurity&&(dreamsecurity={disableNativeCode:!0}),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var e=dreamsecurity,t=e.intg=e.intg||{};e.vi={},e.vi.s="1e9c5de4d6e614166b05ffb20d67a1e43445f7365810b50597076a30720a0331291a8ed47bab7d70c3d7116219a006d0514e8e2e5d4077cfa2bd8905d37bc6ff75e5ce92c389b19e1aeee5e15dec735675bdb09d1f7a1aa953cee4a3b0c6798802228c85b72241f9907fffd43f59caa4b711815ff002c166fd44466764d9ed40ce77b0ce8f5da88955a9f01c9f22436d4e40746bb2bc2c836be76419a1bdb25b3ba7d33a92e8670dac6697b6802dee8fc11b824cdf49b2a36f7ec551a199778064cd07e3d03b4d1b9924bab3b3a2efeb2e9e4d5e9c8347e8827f483eabdad6043bf5e00722842f33cd76b9ea461a81b71f4c21fcf20627b26629638b67f317e49a599ea9ef94294d31ed7d131faeeb57dab24332acf707af00d057d49d807c24a69653f323f838723dfbce436a22f99dc8228fe9a92ec9",e.vi.gf=!1,e.vi.init=!1,t.digestLength=32,t.blockSize=64;var E=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function o(e,t,r,a,i,n){for(var s,o,c,u,d,p,l,y,f,h,g,m,C;64<=i;){for(s=t[0],o=t[1],c=t[2],u=t[3],d=t[4],p=t[5],l=t[6],y=t[7],h=0;h<16;h++)g=a+4*h,e[h]=n?(255&r.charCodeAt(g))<<24|(255&r.charCodeAt(g+1))<<16|(255&r.charCodeAt(g+2))<<8|255&r.charCodeAt(g+3):(255&r[g])<<24|(255&r[g+1])<<16|(255&r[g+2])<<8|255&r[g+3];for(h=16;h<64;h++)m=((f=e[h-2])>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,f=e[h-15],e[h]=(m+e[h-7]|0)+((C=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3)+e[h-16]|0);for(h=0;h<64;h++)m=(((d>>>6|d<<26)^(d>>>11|d<<21)^(d>>>25|d<<7))+(d&p^~d&l)|0)+(y+(E[h]+e[h]|0)|0)|0,C=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&o^s&c^o&c)|0,y=l,l=p,p=d,d=u+m|0,u=c,c=o,o=s,s=m+C|0;t[0]+=s,t[1]+=o,t[2]+=c,t[3]+=u,t[4]+=d,t[5]+=p,t[6]+=l,t[7]+=y,a+=64,i-=64}return a}var r=(a.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},a.prototype.clean=function(){for(var e=0;e<this.buffer.length;e++)this.buffer[e]=0;for(e=0;e<this.temp.length;e++)this.temp[e]=0;this.reset()},a.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var r=0;if(this.bytesHashed+=t,0<this.bufferLength){for(;this.bufferLength<64&&0<t;)this.buffer[this.bufferLength++]=e.charCodeAt(r++),t--;64===this.bufferLength&&(o(this.temp,this.state,this.buffer,0,64,!1),this.bufferLength=0)}for(64<=t&&(r=o(this.temp,this.state,e,r,t,!0),t%=64);0<t;)this.buffer[this.bufferLength++]=e.charCodeAt(r++),t--;return this},a.prototype.finish=function(e){if(!this.finished){var t=this.bytesHashed,r=this.bufferLength,a=t/536870912|0,i=t<<3,n=t%64<56?64:128;this.buffer[r]=128;for(var s=r+1;s<n-8;s++)this.buffer[s]=0;this.buffer[n-8]=a>>>24&255,this.buffer[n-7]=a>>>16&255,this.buffer[n-6]=a>>>8&255,this.buffer[n-5]=a>>>0&255,this.buffer[n-4]=i>>>24&255,this.buffer[n-3]=i>>>16&255,this.buffer[n-2]=i>>>8&255,this.buffer[n-1]=i>>>0&255,o(this.temp,this.state,this.buffer,0,n,!1),this.finished=!0}for(s=0;s<8;s++)e[4*s+0]=this.state[s]>>>24&255,e[4*s+1]=this.state[s]>>>16&255,e[4*s+2]=this.state[s]>>>8&255,e[4*s+3]=this.state[s]>>>0&255;return this},a.prototype.digest=function(){var e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return this.finish(e),String.fromCharCode.apply(null,e)},a.prototype._saveState=function(e){for(var t=0;t<this.state.length;t++)e[t]=this.state[t]},a.prototype._restoreState=function(e,t){for(var r=0;r<this.state.length;r++)this.state[r]=e[r];this.bytesHashed=t,this.finished=!1,this.bufferLength=0},a);function a(){this.digestLength=t.digestLength,this.blockSize=t.blockSize,this.state=new Array(8),this.temp=new Array(64),this.buffer=new Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}t.create=function(e){var t=(new r).update(e),e=t.digest();return t.clean(),e}}(),function(){function d(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"asn1")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var p=dreamsecurity,l=p.asn1=p.asn1||{};l.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},l.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},l.create=function(e,t,r,a){if(p.util.isArray(a)){for(var i=[],n=0;n<a.length;++n)void 0!==a[n]&&i.push(a[n]);a=i}return{tagClass:e,type:t,constructed:r,composed:r||p.util.isArray(a),value:a}};l.fromDer=function(e,t){if(arguments.length<3&&d(),void 0===t&&(t=!0),(e="string"==typeof e?p.util.createBuffer(e):e).length()<2)throw(r=new Error("Too few bytes to parse DER.")).bytes=e.length(),r;var r,a=e.getByte(),i=192&a,n=31&a,s=function(e){var t=e.getByte();if(128!==t){t=128&t?e.getInt((127&t)<<3):t;return t}}(e);if(e.length()<s){if(t)throw(r=new Error("Too few bytes to read ASN.1 value.")).detail=e.length()+" < "+s,r;s=e.length()}a=32==(32&a);if(a)if(c=[],void 0===s)for(;;){if(e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2);break}c.push(l.fromDer(e,t,!0))}else for(var o=e.length();0<s;)c.push(l.fromDer(e,t,!0)),s-=o-e.length(),o=e.length();else{if(void 0===s){if(t)throw new Error("Non-constructed ASN.1 object of indefinite length.");s=e.length()}if(n===l.Type.BMPSTRING)for(var c="",u=0;u<s;u+=2)c+=String.fromCharCode(e.getInt16());else c=e.getBytes(s)}return l.create(i,n,a,c)},l.toDer=function(e){1==arguments.length&&d();var t=p.util.createBuffer(),r=e.tagClass|e.type,a=p.util.createBuffer();if(e.composed){e.constructed?r|=32:a.putByte(0);for(var i=0;i<e.value.length;++i)void 0!==e.value[i]&&a.putBuffer(l.toDer(e.value[i],!0))}else if(e.type===l.Type.BMPSTRING)for(i=0;i<e.value.length;++i)a.putInt16(e.value.charCodeAt(i));else a.putBytes(e.value);if(t.putByte(r),a.length()<=127)t.putByte(127&a.length());else{for(var n=a.length(),s="";s+=String.fromCharCode(255&n),0<(n>>>=8););t.putByte(128|s.length);for(i=s.length-1;0<=i;--i)t.putByte(s.charCodeAt(i))}return t.putBuffer(a),t},l.oidToDer=function(e){var t,r,a,i,n=e.split("."),s=p.util.createBuffer();s.putByte(40*parseInt(n[0],10)+parseInt(n[1],10));for(var o=2;o<n.length;++o){for(t=!0,r=[],a=parseInt(n[o],10);i=127&a,a>>>=7,t||(i|=128),r.push(i),t=!1,0<a;);for(var c=r.length-1;0<=c;--c)s.putByte(r[c])}return s},l.derToOid=function(e){for(var t=(e="string"==typeof e?p.util.createBuffer(e):e).getByte(),r=Math.floor(t/40)+"."+t%40,a=0;0<e.length();)a<<=7,128&(t=e.getByte())?a+=127&t:(r+="."+(a+t),a=0);return r},l.utcTimeToDate=function(e){var t,r,a=new Date,i=50<=(i=parseInt(e.substr(0,2),10))?1900+i:2e3+i,n=parseInt(e.substr(2,2),10)-1,s=parseInt(e.substr(4,2),10),o=parseInt(e.substr(6,2),10),c=parseInt(e.substr(8,2),10),u=0;return 11<e.length&&("+"!==(r=e.charAt(t=10))&&"-"!==r&&(u=parseInt(e.substr(10,2),10),t+=2)),a.setUTCFullYear(i,n,s),a.setUTCHours(o,c,u,0),t&&("+"!==(r=e.charAt(t))&&"-"!==r||(t=60*parseInt(e.substr(t+1,2),10)+parseInt(e.substr(t+4,2),10),t*=6e4,"+"===r?a.setTime(+a-t):a.setTime(+a+t))),a},l.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),a=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),n=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),o=parseInt(e.substr(12,2),10),c=0,u=0,d=!1;"Z"===e.charAt(e.length-1)&&(d=!0);var p=e.length-5,l=e.charAt(p);return"+"!==l&&"-"!==l||(u=60*parseInt(e.substr(1+p,2),10)+parseInt(e.substr(4+p,2),10),u*=6e4,"+"===l&&(u*=-1),d=!0),"."===e.charAt(14)&&(c=1e3*parseFloat(e.substr(14),10)),d?(t.setUTCFullYear(r,a,i),t.setUTCHours(n,s,o,c),t.setTime(+t+u)):(t.setFullYear(r,a,i),t.setHours(n,s,o,c)),t},l.dateToUtcTime=function(e){var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var a=0;a<r.length;++a)r[a].length<2&&(t+="0"),t+=r[a];return t+="Z"},l.integerToDer=function(e){var t=p.util.createBuffer();if(-128<=e&&e<128)return t.putSignedInt(e,8);if(-32768<=e&&e<32768)return t.putSignedInt(e,16);if(-8388608<=e&&e<8388608)return t.putSignedInt(e,24);if(-2147483648<=e&&e<2147483648)return t.putSignedInt(e,32);t=new Error("Integer too large; max is 32-bits.");throw t.integer=e,t},l.derToInteger=function(e){var t=8*(e="string"==typeof e?p.util.createBuffer(e):e).length();if(32<t)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},l.validate=function(e,t,r,a){var i=!1;if(e.tagClass!==t.tagClass&&void 0!==t.tagClass||e.type!==t.type&&void 0!==t.type)a&&(e.tagClass!==t.tagClass&&a.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&a.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||void 0===t.constructed){if(i=!0,t.value&&p.util.isArray(t.value))for(var n=0,s=0;i&&s<t.value.length;++s)i=t.value[s].optional||!1,e.value[n]&&((i=l.validate(e.value[n],t.value[s],r,a))?++n:t.value[s].optional&&(i=!0)),!i&&a&&a.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');i&&r&&(t.capture&&(r[t.capture]=e.value),t.captureAsn1&&(r[t.captureAsn1]=e))}else a&&a.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return i}}(),function(){var e;"undefined"==typeof dreamsecurity&&(dreamsecurity={});function m(e,t,r){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function C(){return new m(null)}function t(e,t,r,a,i,n){for(var s=16383&t,o=t>>14;0<=--n;){var c=16383&this.data[e],u=this.data[e++]>>14,d=o*c+u*s;i=((c=s*c+((16383&d)<<14)+r.data[a]+i)>>28)+(d>>14)+o*u,r.data[a++]=268435455&c}return i}e="undefined"==typeof navigator?(m.prototype.am=t,28):"Microsoft Internet Explorer"==navigator.appName?(m.prototype.am=function(e,t,r,a,i,n){for(var s=32767&t,o=t>>15;0<=--n;){var c=32767&this.data[e],u=this.data[e++]>>15,d=o*c+u*s;i=((c=s*c+((32767&d)<<15)+r.data[a]+(1073741823&i))>>>30)+(d>>>15)+o*u+(i>>>30),r.data[a++]=1073741823&c}return i},30):"Netscape"!=navigator.appName?(m.prototype.am=function(e,t,r,a,i,n){for(;0<=--n;){var s=t*this.data[e++]+r.data[a]+i;i=Math.floor(s/67108864),r.data[a++]=67108863&s}return i},26):(m.prototype.am=t,28),m.prototype.DB=e,m.prototype.DM=(1<<e)-1,m.prototype.DV=1<<e;m.prototype.FV=Math.pow(2,52),m.prototype.F1=52-e,m.prototype.F2=2*e-52;for(var r="0123456789abcdefghijklmnopqrstuvwxyz",a=new Array,i="0".charCodeAt(0),n=0;n<=9;++n)a[i++]=n;for(i="a".charCodeAt(0),n=10;n<36;++n)a[i++]=n;for(i="A".charCodeAt(0),n=10;n<36;++n)a[i++]=n;function c(e){return r.charAt(e)}function u(e,t){t=a[e.charCodeAt(t)];return null==t?-1:t}function g(e){var t=C();return t.fromInt(e),t}function E(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function v(e){this.m=e}function S(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function s(e,t){return e&t}function o(e,t){return e|t}function d(e,t){return e^t}function p(e,t){return e&~t}function l(){}function y(e){return e}function I(e){this.r2=C(),this.q3=C(),m.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}v.prototype.convert=function(e){return e.s<0||0<=e.compareTo(this.m)?e.mod(this.m):e},v.prototype.revert=function(e){return e},v.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},v.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},v.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},S.prototype.convert=function(e){var t=C();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&0<t.compareTo(m.ZERO)&&this.m.subTo(t,t),t},S.prototype.revert=function(e){var t=C();return e.copyTo(t),this.reduce(t),t},S.prototype.reduce=function(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=(a=32767&e.data[t])*this.mpl+((a*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM,a=t+this.m.t;for(e.data[a]+=this.m.am(0,r,e,t,0,this.m.t);e.data[a]>=e.DV;)e.data[a]-=e.DV,e.data[++a]++}e.clamp(),e.drShiftTo(this.m.t,e),0<=e.compareTo(this.m)&&e.subTo(this.m,e)},S.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},S.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},m.prototype.copyTo=function(e){for(var t=this.t-1;0<=t;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},m.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,0<e?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},m.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var a=e.length,i=!1,n=0;0<=--a;){var s=8==r?255&e[a]:u(e,a);s<0?"-"==e.charAt(a)&&(i=!0):(i=!1,0==n?this.data[this.t++]=s:n+r>this.DB?(this.data[this.t-1]|=(s&(1<<this.DB-n)-1)<<n,this.data[this.t++]=s>>this.DB-n):this.data[this.t-1]|=s<<n,(n+=r)>=this.DB&&(n-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,0<n&&(this.data[this.t-1]|=(1<<this.DB-n)-1<<n)),this.clamp(),i&&m.ZERO.subTo(this,this)},m.prototype.clamp=function(){for(var e=this.s&this.DM;0<this.t&&this.data[this.t-1]==e;)--this.t},m.prototype.dlShiftTo=function(e,t){for(var r=this.t-1;0<=r;--r)t.data[r+e]=this.data[r];for(r=e-1;0<=r;--r)t.data[r]=0;t.t=this.t+e,t.s=this.s},m.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t.data[r-e]=this.data[r];t.t=Math.max(this.t-e,0),t.s=this.s},m.prototype.lShiftTo=function(e,t){for(var r=e%this.DB,a=this.DB-r,i=(1<<a)-1,n=Math.floor(e/this.DB),s=this.s<<r&this.DM,o=this.t-1;0<=o;--o)t.data[o+n+1]=this.data[o]>>a|s,s=(this.data[o]&i)<<r;for(o=n-1;0<=o;--o)t.data[o]=0;t.data[n]=s,t.t=this.t+n+1,t.s=this.s,t.clamp()},m.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var a=e%this.DB,i=this.DB-a,n=(1<<a)-1;t.data[0]=this.data[r]>>a;for(var s=r+1;s<this.t;++s)t.data[s-r-1]|=(this.data[s]&n)<<i,t.data[s-r]=this.data[s]>>a;0<a&&(t.data[this.t-r-1]|=(this.s&n)<<i),t.t=this.t-r,t.clamp()}},m.prototype.subTo=function(e,t){for(var r=0,a=0,i=Math.min(e.t,this.t);r<i;)a+=this.data[r]-e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a-=e.s;r<this.t;)a+=this.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;r<e.t;)a-=e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a-=e.s}t.s=a<0?-1:0,a<-1?t.data[r++]=this.DV+a:0<a&&(t.data[r++]=a),t.t=r,t.clamp()},m.prototype.multiplyTo=function(e,t){var r=this.abs(),a=e.abs(),i=r.t;for(t.t=i+a.t;0<=--i;)t.data[i]=0;for(i=0;i<a.t;++i)t.data[i+r.t]=r.am(0,a.data[i],t,i,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&m.ZERO.subTo(t,t)},m.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;0<=--r;)e.data[r]=0;for(r=0;r<t.t-1;++r){var a=t.am(r,t.data[r],e,2*r,0,1);(e.data[r+t.t]+=t.am(r+1,2*t.data[r],e,2*r+1,a,t.t-r-1))>=t.DV&&(e.data[r+t.t]-=t.DV,e.data[r+t.t+1]=1)}0<e.t&&(e.data[e.t-1]+=t.am(r,t.data[r],e,2*r,0,1)),e.s=0,e.clamp()},m.prototype.divRemTo=function(e,t,r){var a=e.abs();if(!(a.t<=0)){var i=this.abs();if(i.t<a.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=C());var n=C(),s=this.s,o=e.s,e=this.DB-E(a.data[a.t-1]);0<e?(a.lShiftTo(e,n),i.lShiftTo(e,r)):(a.copyTo(n),i.copyTo(r));var c=n.t,u=n.data[c-1];if(0!=u){var i=u*(1<<this.F1)+(1<c?n.data[c-2]>>this.F2:0),d=this.FV/i,p=(1<<this.F1)/i,l=1<<this.F2,y=r.t,f=y-c,h=null==t?C():t;for(n.dlShiftTo(f,h),0<=r.compareTo(h)&&(r.data[r.t++]=1,r.subTo(h,r)),m.ONE.dlShiftTo(c,h),h.subTo(n,n);n.t<c;)n.data[n.t++]=0;for(;0<=--f;){var g=r.data[--y]==u?this.DM:Math.floor(r.data[y]*d+(r.data[y-1]+l)*p);if((r.data[y]+=n.am(0,g,r,f,0,c))<g)for(n.dlShiftTo(f,h),r.subTo(h,r);r.data[y]<--g;)r.subTo(h,r)}null!=t&&(r.drShiftTo(c,t),s!=o&&m.ZERO.subTo(t,t)),r.t=c,r.clamp(),0<e&&r.rShiftTo(e,r),s<0&&m.ZERO.subTo(r,r)}}},m.prototype.invDigit=function(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return 0<(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)?this.DV-t:-t},m.prototype.isEven=function(){return 0==(0<this.t?1&this.data[0]:this.s)},m.prototype.exp=function(e,t){if(4294967295<e||e<1)return m.ONE;var r,a=C(),i=C(),n=t.convert(this),s=E(e)-1;for(n.copyTo(a);0<=--s;)t.sqrTo(a,i),0<(e&1<<s)?t.mulTo(i,n,a):(r=a,a=i,i=r);return t.revert(a)},m.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,a=(1<<t)-1,i=!1,n="",s=this.t,o=this.DB-s*this.DB%t;if(0<s--)for(o<this.DB&&0<(r=this.data[s]>>o)&&(i=!0,n=c(r));0<=s;)o<t?(r=(this.data[s]&(1<<o)-1)<<t-o,r|=this.data[--s]>>(o+=this.DB-t)):(r=this.data[s]>>(o-=t)&a,o<=0&&(o+=this.DB,--s)),(i=0<r?!0:i)&&(n+=c(r));return i?n:"0"},m.prototype.negate=function(){var e=C();return m.ZERO.subTo(this,e),e},m.prototype.abs=function(){return this.s<0?this.negate():this},m.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;0<=--r;)if(0!=(t=this.data[r]-e.data[r]))return t;return 0},m.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+E(this.data[this.t-1]^this.s&this.DM)},m.prototype.mod=function(e){var t=C();return this.abs().divRemTo(e,null,t),this.s<0&&0<t.compareTo(m.ZERO)&&e.subTo(t,t),t},m.prototype.modPowInt=function(e,t){return t=new(e<256||t.isEven()?v:S)(t),this.exp(e,t)},m.ZERO=g(0),m.ONE=g(1),l.prototype.convert=y,l.prototype.revert=y,l.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},l.prototype.sqrTo=function(e,t){e.squareTo(t)},I.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=C();return e.copyTo(t),this.reduce(t),t},I.prototype.revert=function(e){return e},I.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);0<=e.compareTo(this.m);)e.subTo(this.m,e)},I.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},I.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var f=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],h=(1<<26)/f[f.length-1];m.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},m.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||36<e)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),a=g(r),i=C(),n=C(),s="";for(this.divRemTo(a,i,n);0<i.signum();)s=(r+n.intValue()).toString(e).substr(1)+s,i.divRemTo(a,i,n);return n.intValue().toString(e)+s},m.prototype.fromRadix=function(e,t){this.fromInt(0);for(var r=this.chunkSize(t=null==t?10:t),a=Math.pow(t,r),i=!1,n=0,s=0,o=0;o<e.length;++o){var c=u(e,o);c<0?"-"==e.charAt(o)&&0==this.signum()&&(i=!0):(s=t*s+c,++n>=r&&(this.dMultiply(a),this.dAddOffset(s,0),s=n=0))}0<n&&(this.dMultiply(Math.pow(t,n)),this.dAddOffset(s,0)),i&&m.ZERO.subTo(this,this)},m.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(m.ONE.shiftLeft(e-1),o,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(m.ONE.shiftLeft(e-1),this);else{var a=new Array,r=7&e;a.length=1+(e>>3),t.nextBytes(a),0<r?a[0]&=(1<<r)-1:a[0]=0,this.fromString(a,256)}},m.prototype.bitwiseTo=function(e,t,r){for(var a,i=Math.min(e.t,this.t),n=0;n<i;++n)r.data[n]=t(this.data[n],e.data[n]);if(e.t<this.t){for(a=e.s&this.DM,n=i;n<this.t;++n)r.data[n]=t(this.data[n],a);r.t=this.t}else{for(a=this.s&this.DM,n=i;n<e.t;++n)r.data[n]=t(a,e.data[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},m.prototype.changeBit=function(e,t){return e=m.ONE.shiftLeft(e),this.bitwiseTo(e,t,e),e},m.prototype.addTo=function(e,t){for(var r=0,a=0,i=Math.min(e.t,this.t);r<i;)a+=this.data[r]+e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a+=e.s;r<this.t;)a+=this.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;r<e.t;)a+=e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a+=e.s}t.s=a<0?-1:0,0<a?t.data[r++]=a:a<-1&&(t.data[r++]=this.DV+a),t.t=r,t.clamp()},m.prototype.dMultiply=function(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},m.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},m.prototype.multiplyLowerTo=function(e,t,r){var a,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;0<i;)r.data[--i]=0;for(a=r.t-this.t;i<a;++i)r.data[i+this.t]=this.am(0,e.data[i],r,i,0,this.t);for(a=Math.min(e.t,t);i<a;++i)this.am(0,e.data[i],r,i,0,t-i);r.clamp()},m.prototype.multiplyUpperTo=function(e,t,r){var a=r.t=this.t+e.t- --t;for(r.s=0;0<=--a;)r.data[a]=0;for(a=Math.max(t-this.t,0);a<e.t;++a)r.data[this.t+a-t]=this.am(t-a,e.data[a],r,0,0,this.t+a-t);r.clamp(),r.drShiftTo(1,r)},m.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(0<this.t)if(0==t)r=this.data[0]%e;else for(var a=this.t-1;0<=a;--a)r=(t*r+this.data[a])%e;return r},m.prototype.millerRabin=function(e){var t=this.subtract(m.ONE),r=t.getLowestSetBit();if(r<=0)return!1;for(var a,i=t.shiftRight(r),n={nextBytes:function(e){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues){Math.ceil(e.length/4);var r=new Uint32Array(Math.ceil(e.length/4));t.getRandomValues(r);for(var a=0,i=0;i<r.length;++i)i==r.length-1?(a<e.length&&(e[a++]=r[i]>>24&255),a<e.length&&(e[a++]=r[i]>>16&255),a<e.length&&(e[a++]=r[i]>>8&255),a<e.length&&(e[a++]=255&r[i])):(e[a++]=r[i]>>24&255,e[a++]=r[i]>>16&255,e[a++]=r[i]>>8&255,e[a++]=255&r[i])}else for(i=0;i<e.length;++i)e[i]=Math.floor(255*Math.random())}},s=0;s<e;++s){for(;(a=new m(this.bitLength(),n)).compareTo(m.ONE)<=0||0<=a.compareTo(t););var o=a.modPow(i,this);if(0!=o.compareTo(m.ONE)&&0!=o.compareTo(t)){for(var c=1;c++<r&&0!=o.compareTo(t);)if(0==(o=o.modPowInt(2,this)).compareTo(m.ONE))return!1;if(0!=o.compareTo(t))return!1}}return!0},m.prototype.clone=function(){var e=C();return this.copyTo(e),e},m.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},m.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24},m.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16},m.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},m.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,a=this.DB-e*this.DB%8,i=0;if(0<e--)for(a<this.DB&&(r=this.data[e]>>a)!=(this.s&this.DM)>>a&&(t[i++]=r|this.s<<this.DB-a);0<=e;)a<8?(r=(this.data[e]&(1<<a)-1)<<8-a,r|=this.data[--e]>>(a+=this.DB-8)):(r=this.data[e]>>(a-=8)&255,a<=0&&(a+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(0<i||r!=this.s)&&(t[i++]=r);return t},m.prototype.equals=function(e){return 0==this.compareTo(e)},m.prototype.min=function(e){return this.compareTo(e)<0?this:e},m.prototype.max=function(e){return 0<this.compareTo(e)?this:e},m.prototype.and=function(e){var t=C();return this.bitwiseTo(e,s,t),t},m.prototype.or=function(e){var t=C();return this.bitwiseTo(e,o,t),t},m.prototype.xor=function(e){var t=C();return this.bitwiseTo(e,d,t),t},m.prototype.andNot=function(e){var t=C();return this.bitwiseTo(e,p,t),t},m.prototype.not=function(){for(var e=C(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},m.prototype.shiftLeft=function(e){var t=C();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},m.prototype.shiftRight=function(e){var t=C();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},m.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+function(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}(this.data[e]);return this.s<0?this.t*this.DB:-1},m.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=function(e){for(var t=0;0!=e;)e&=e-1,++t;return t}(this.data[r]^t);return e},m.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)},m.prototype.setBit=function(e){return this.changeBit(e,o)},m.prototype.clearBit=function(e){return this.changeBit(e,p)},m.prototype.flipBit=function(e){return this.changeBit(e,d)},m.prototype.add=function(e){var t=C();return this.addTo(e,t),t},m.prototype.subtract=function(e){var t=C();return this.subTo(e,t),t},m.prototype.multiply=function(e){var t=C();return this.multiplyTo(e,t),t},m.prototype.divide=function(e){var t=C();return this.divRemTo(e,t,null),t},m.prototype.remainder=function(e){var t=C();return this.divRemTo(e,null,t),t},m.prototype.divideAndRemainder=function(e){var t=C(),r=C();return this.divRemTo(e,t,r),new Array(t,r)},m.prototype.modPow=function(e,t){var r=e.bitLength(),a=g(1);if(r<=0)return a;var i=r<18?1:r<48?3:r<144?4:r<768?5:6,n=new(r<8?v:t.isEven()?I:S)(t),s=new Array,o=3,c=i-1,u=(1<<i)-1;if(s[1]=n.convert(this),1<i){var d=C();for(n.sqrTo(s[1],d);o<=u;)s[o]=C(),n.mulTo(d,s[o-2],s[o]),o+=2}for(var p,l,y=e.t-1,f=!0,h=C(),r=E(e.data[y])-1;0<=y;){for(c<=r?p=e.data[y]>>r-c&u:(p=(e.data[y]&(1<<r+1)-1)<<c-r,0<y&&(p|=e.data[y-1]>>this.DB+r-c)),o=i;0==(1&p);)p>>=1,--o;if((r-=o)<0&&(r+=this.DB,--y),f)s[p].copyTo(a),f=!1;else{for(;1<o;)n.sqrTo(a,h),n.sqrTo(h,a),o-=2;0<o?n.sqrTo(a,h):(l=a,a=h,h=l),n.mulTo(h,s[p],a)}for(;0<=y&&0==(e.data[y]&1<<r);)n.sqrTo(a,h),l=a,a=h,h=l,--r<0&&(r=this.DB-1,--y)}return n.revert(a)},m.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return m.ZERO;for(var r=e.clone(),a=this.clone(),i=g(1),n=g(0),s=g(0),o=g(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(i.isEven()&&n.isEven()||(i.addTo(this,i),n.subTo(e,n)),i.rShiftTo(1,i)):n.isEven()||n.subTo(e,n),n.rShiftTo(1,n);for(;a.isEven();)a.rShiftTo(1,a),t?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);0<=r.compareTo(a)?(r.subTo(a,r),t&&i.subTo(s,i),n.subTo(o,n)):(a.subTo(r,a),t&&s.subTo(i,s),o.subTo(n,o))}return 0!=a.compareTo(m.ONE)?m.ZERO:0<=o.compareTo(e)?o.subtract(e):o.signum()<0?(o.addTo(e,o),o.signum()<0?o.add(e):o):o},m.prototype.pow=function(e){return this.exp(e,new l)},m.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();t.compareTo(r)<0&&(i=t,t=r,r=i);var a=t.getLowestSetBit(),i=r.getLowestSetBit();if(i<0)return t;for(0<(i=a<i?a:i)&&(t.rShiftTo(i,t),r.rShiftTo(i,r));0<t.signum();)0<(a=t.getLowestSetBit())&&t.rShiftTo(a,t),0<(a=r.getLowestSetBit())&&r.rShiftTo(a,r),0<=t.compareTo(r)?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return 0<i&&r.lShiftTo(i,r),r},m.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r.data[0]<=f[f.length-1]){for(t=0;t<f.length;++t)if(r.data[0]==f[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<f.length;){for(var a=f[t],i=t+1;i<f.length&&a<h;)a*=f[i++];for(a=r.modInt(a);t<i;)if(a%f[t++]==0)return!1}return r.millerRabin(e)},m.prototype.square=function(){var e=C();return this.squareTo(e),e},dreamsecurity.jsbn=dreamsecurity.jsbn||{},dreamsecurity.jsbn.BigInteger=m,dreamsecurity.jsbn.Barrett=I}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var e=dreamsecurity,t=e.err=e.err||{};t.unsupported=1,t.wrongPasswd=2,t.revoked=3,t.expired=4,t.encrypt=5,t.decrypt=6,t.sign=7,t.verify=8,t.generate=9,t.process=10,t.encode=11,t.decode=12,t.license=13,t.invalidInput=14,t.vidNotExist=15;var u=e.util=e.util||{};"undefined"!=typeof process&&process.nextTick?(u.nextTick=process.nextTick,"function"==typeof setImmediate?u.setImmediate=setImmediate:u.setImmediate=u.nextTick):"function"==typeof setImmediate?(u.setImmediate=setImmediate,u.nextTick=function(e){return setImmediate(e)}):(u.setImmediate=function(e){setTimeout(e,0)},u.nextTick=u.setImmediate),u.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},u.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},u.arrayIndexOf=function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1};var r=[];function a(e){if(this.data="",this.read=0,null!=e)if("string"==typeof e)this.data=e;else if(u.isArrayBuffer(e)||u.isArrayBufferView(e)){var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(e){for(var r=0;r<t.length;++r)this.data+=String.fromCharCode(t[r])}}else{if(!(e instanceof a||"object"==typeof e&&"data"in e&&"string"==typeof e.data&&"read"in e&&"number"==typeof e.read))throw new Error("new ByteStringBuffer() : The input is invalid type.");this.data=e.data,this.read=e.read}}"undefined"!=typeof DataView&&r.push(DataView),"undefined"!=typeof Int8Array&&r.push(Int8Array),"undefined"!=typeof Uint8Array&&r.push(Uint8Array),"undefined"!=typeof Uint8ClampedArray&&r.push(Uint8ClampedArray),"undefined"!=typeof Int16Array&&r.push(Int16Array),"undefined"!=typeof Uint16Array&&r.push(Uint16Array),"undefined"!=typeof Int32Array&&r.push(Int32Array),"undefined"!=typeof Uint32Array&&r.push(Uint32Array),"undefined"!=typeof Float32Array&&r.push(Float32Array),"undefined"!=typeof Float64Array&&r.push(Float64Array),u.isArrayBufferView=function(e){for(var t=0;t<r.length;++t)if(e instanceof r[t])return!0;return!1},u.ByteBuffer=a,u.ByteStringBuffer=a,u.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},u.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},u.ByteStringBuffer.prototype.putByte=function(e){return this.data+=String.fromCharCode(e),this},u.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;0<t;)1&t&&(r+=e),0<(t>>>=1)&&(e+=e);return this.data=r,this},u.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this},u.ByteStringBuffer.prototype.putString=function(e){return this.data+=u.encodeUtf8(e),this},u.ByteStringBuffer.prototype.putInt16=function(e){return this.data+=String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},u.ByteStringBuffer.prototype.putInt24=function(e){return this.data+=String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},u.ByteStringBuffer.prototype.putInt32=function(e){return this.data+=String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},u.ByteStringBuffer.prototype.putInt16Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255),this},u.ByteStringBuffer.prototype.putInt24Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255),this},u.ByteStringBuffer.prototype.putInt32Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255),this},u.ByteStringBuffer.prototype.putInt=function(e,t){for(;t-=8,this.data+=String.fromCharCode(e>>t&255),0<t;);return this},u.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},u.ByteStringBuffer.prototype.putBuffer=function(e){return this.data+=e.getBytes(),this},u.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},u.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},u.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},u.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},u.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},u.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},u.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},u.ByteStringBuffer.prototype.getInt=function(e){for(var t=0;t=(t<<8)+this.data.charCodeAt(this.read++),0<(e-=8););return t},u.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),e=2<<e-2;return e<=t&&(t-=e<<1),t},u.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},u.ByteStringBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},u.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},u.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},u.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},u.ByteStringBuffer.prototype.copy=function(){var e=u.createBuffer(this.data);return e.read=this.read,e},u.ByteStringBuffer.prototype.compact=function(){return 0<this.read&&(this.data=this.data.slice(this.read),this.read=0),this},u.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},u.ByteStringBuffer.prototype.truncate=function(e){e=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,e),this.read=0,this},u.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var r=this.data.charCodeAt(t);r<16&&(e+="0"),e+=r.toString(16)}return e},u.ByteStringBuffer.prototype.toString=function(){return u.decodeUtf8(this.bytes())},u.DataBuffer=function(e,t){this.read=(t=t||{}).readOffset||0,this.growSize=t.growSize||1024;var r=u.isArrayBuffer(e),a=u.isArrayBufferView(e);if(r||a)return this.data=r?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},u.DataBuffer.prototype.length=function(){return this.write-this.read},u.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},u.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);e=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),t=new Uint8Array(this.length()+t);return t.set(e),this.data=new DataView(t.buffer),this},u.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},u.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var r=0;r<t;++r)this.data.setUint8(e);return this},u.DataBuffer.prototype.putBytes=function(e,t){if(u.isArrayBufferView(e)){var r=(a=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-a.byteOffset;return this.accommodate(r),new Uint8Array(this.data.buffer,this.write).set(a),this.write+=r,this}if(u.isArrayBuffer(e)){var a=new Uint8Array(e);return this.accommodate(a.byteLength),new Uint8Array(this.data.buffer).set(a,this.write),this.write+=a.byteLength,this}if(e instanceof u.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&u.isArrayBufferView(e.data)){a=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(a.byteLength),new Uint8Array(e.data.byteLength,this.write).set(a),this.write+=a.byteLength,this}if(e instanceof u.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"!=typeof e)throw Error("Invalid parameter: "+e);var i;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.hex.decode(e,i,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),i=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.base64.decode(e,i,this.write),this;if("utf8"===t&&(e=u.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.raw.decode(i),this;if("utf16"===t)return this.accommodate(2*e.length),i=new Uint16Array(this.data.buffer,this.write),this.write+=u.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+t)},u.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},u.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},u.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},u.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},u.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},u.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},u.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},u.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},u.DataBuffer.prototype.putInt=function(e,t){for(this.accommodate(t/8);t-=8,this.data.setInt8(this.write++,e>>t&255),0<t;);return this},u.DataBuffer.prototype.putSignedInt=function(e,t){return this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},u.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},u.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},u.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},u.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},u.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},u.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},u.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},u.DataBuffer.prototype.getInt=function(e){for(var t=0;t=(t<<8)+this.data.getInt8(this.read++),0<(e-=8););return t},u.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),e=2<<e-2;return e<=t&&(t-=e<<1),t},u.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},u.DataBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},u.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},u.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},u.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},u.DataBuffer.prototype.copy=function(){return new u.DataBuffer(this)},u.DataBuffer.prototype.compact=function(){var e,t;return 0<this.read&&(e=new Uint8Array(this.data.buffer,this.read),(t=new Uint8Array(e.byteLength)).set(e),this.data=new DataView(t),this.write-=this.read,this.read=0),this},u.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},u.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},u.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var r=this.data.getUint8(t);r<16&&(e+="0"),e+=r.toString(16)}return e},u.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return u.binary.raw.encode(t);if("hex"===e)return u.binary.hex.encode(t);if("base64"===e)return u.binary.base64.encode(t);if("utf8"===e)return u.text.utf8.decode(t);if("utf16"===e)return u.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},u.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=u.encodeUtf8(e)),new u.ByteBuffer(e)},u.fillString=function(e,t){for(var r="";0<t;)1&t&&(r+=e),0<(t>>>=1)&&(e+=e);return r},u.xorBytes=function(e,t,r){for(var a,i="",n="",s=0,o=0;0<r;--r,++s)a=e.charCodeAt(s)^t.charCodeAt(s),10<=o&&(i+=n,n="",o=0),n+=String.fromCharCode(a),++o;return i+=n},u.hexToBytes=function(e){var t="",r=0;for(!0&e.length&&(r=1,t+=String.fromCharCode(parseInt(e.substr(0,1),16)));r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},u.bytesToHex=function(e){return u.createBuffer(e).toHex()},u.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];u.encode64=function(e,t){for(var r,a,i,n="",s="",o=0;o<e.length;)r=e.charCodeAt(o++),a=e.charCodeAt(o++),i=e.charCodeAt(o++),n+=c.charAt(r>>2),n+=c.charAt((3&r)<<4|a>>4),isNaN(a)?n+="==":(n+=c.charAt((15&a)<<2|i>>6),n+=isNaN(i)?"=":c.charAt(63&i)),t&&n.length>t&&(s+=n.substr(0,t)+"\r\n",n=n.substr(t));return s+=n},u.decode64=function(e){if(0<(e=(e=e.replace(/\s/gi,"")).replace(/\r\n/gm,"")).search(/[^A-Za-z0-9\+\/\=]/g)){var t=new Error("Base64 decode fail. (unknown charactor)");throw t.errors=[],t}for(var r,a,i,n,s="",o=0;o<e.length;)r=d[e.charCodeAt(o++)-43],a=d[e.charCodeAt(o++)-43],i=d[e.charCodeAt(o++)-43],n=d[e.charCodeAt(o++)-43],s+=String.fromCharCode(r<<2|a>>4),64!==i&&(s+=String.fromCharCode((15&a)<<4|i>>2),64!==n&&(s+=String.fromCharCode((3&i)<<6|n)));return s},u.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},u.decodeUtf8=function(e){return decodeURIComponent(escape(e))},u.binary={raw:{},hex:{},base64:{}},u.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},u.binary.raw.decode=function(e,t,r){for(var a=(a=t)||new Uint8Array(e.length),i=r=r||0,n=0;n<e.length;++n)a[i++]=e.charCodeAt(n);return t?i-r:a},u.binary.hex.encode=u.bytesToHex,u.binary.hex.decode=function(e,t,r){var a=(a=t)||new Uint8Array(Math.ceil(e.length/2)),i=0,n=r=r||0;for(1&e.length&&(i=1,a[n++]=parseInt(e[0],16));i<e.length;i+=2)a[n++]=parseInt(e.substr(i,2),16);return t?n-r:a},u.binary.base64.encode=function(e,t){for(var r,a,i,n="",s="",o=0;o<e.byteLength;)r=e[o++],a=e[o++],i=e[o++],n+=c.charAt(r>>2),n+=c.charAt((3&r)<<4|a>>4),isNaN(a)?n+="==":(n+=c.charAt((15&a)<<2|i>>6),n+=isNaN(i)?"=":c.charAt(63&i)),t&&n.length>t&&(s+=n.substr(0,t)+"\r\n",n=n.substr(t));return s+=n},u.binary.base64.decode=function(e,t,r){var a,i,n,s,o=(o=t)||new Uint8Array(3*Math.ceil(e.length/4));e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var c=0,u=r=r||0;c<e.length;)a=d[e.charCodeAt(c++)-43],i=d[e.charCodeAt(c++)-43],n=d[e.charCodeAt(c++)-43],s=d[e.charCodeAt(c++)-43],o[u++]=a<<2|i>>4,64!==n&&(o[u++]=(15&i)<<4|n>>2,64!==s&&(o[u++]=(3&n)<<6|s));return t?u-r:o},u.text={utf8:{},utf16:{}},u.text.utf8.encode=function(e,t,r){e=u.encodeUtf8(e);for(var a=(a=t)||new Uint8Array(e.length),i=r=r||0,n=0;n<e.length;++n)a[i++]=e.charCodeAt(n);return t?i-r:a},u.text.utf8.decode=function(e){return u.decodeUtf8(String.fromCharCode.apply(null,e))},u.text.utf16.encode=function(e,t,r){for(var a=(a=t)||new Uint8Array(e.length),i=new Uint16Array(a),n=r=r||0,s=r,o=0;o<e.length;++o)i[s++]=e.charCodeAt(o),n+=2;return t?n-r:a},u.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},u.deflate=function(e,t,r){return t=u.decode64(e.deflate(u.encode64(t)).rval),r&&(e=2,r=t.charCodeAt(1),t=t.substring(e=32&r?6:e,t.length-4)),t},u.inflate=function(e,t,r){t=e.inflate(u.encode64(t)).rval;return null===t?null:u.decode64(t)};function s(e,t,r){if(!e)throw new Error("WebStorage not available.");if(void 0!==(t=null===r?e.removeItem(t):(r=u.encode64(JSON.stringify(r)),e.setItem(t,r)))&&!0!==t.rval){r=new Error(t.error.message);throw r.id=t.error.id,r.name=t.error.name,r}}function o(e,t){if(!e)throw new Error("WebStorage not available.");if(t=e.getItem(t),e.init)if(null===t.rval){if(t.error){e=new Error(t.error.message);throw e.id=t.error.id,e.name=t.error.name,e}t=null}else t=t.rval;return t=null!==t?JSON.parse(u.decode64(t)):t}function n(e,t,r,a){var i=o(e,t);(i=null===i?{}:i)[r]=a,s(e,t,i)}function i(e,t,r){return t=null!==(t=o(e,t))?r in t?t[r]:null:t}function p(e,t,r){var a=o(e,t);if(null!==a&&r in a){delete a[r];var i,n=!0;for(i in a){n=!1;break}s(e,t,a=n?null:a)}}function l(e,t){s(e,t,null)}function y(e,t,r){var a,i,n=null,s=!1,o=null;for(i in r=void 0===r?["web","flash"]:r){a=r[i];try{if("flash"===a||"both"===a){if(null===t[0])throw new Error("Flash local storage not available.");n=e.apply(this,t),s="flash"===a}"web"!==a&&"both"!==a||(t[0]=localStorage,n=e.apply(this,t),s=!0)}catch(e){o=e}if(s)break}if(!s)throw o;return n}u.setItem=function(e,t,r,a,i){y(n,arguments,i)},u.getItem=function(e,t,r,a){return y(i,arguments,a)},u.removeItem=function(e,t,r,a){y(p,arguments,a)},u.clearItems=function(e,t,r){y(l,arguments,r)},u.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;t=t.exec(e),t=null===t?null:{full:e,scheme:t[1],host:t[2],port:t[3],path:t[4]};return t&&(t.fullHost=t.host,t.port?(80!==t.port&&"http"===t.scheme||443!==t.port&&"https"===t.scheme)&&(t.fullHost+=":"+t.port):"http"===t.scheme?t.port=80:"https"===t.scheme&&(t.port=443),t.full=t.scheme+"://"+t.fullHost),t};var f=null;u.getQueryVariables=function(e){function t(e){for(var t={},r=e.split("&"),a=0;a<r.length;a++){var i,n=r[a].indexOf("="),n=0<n?(i=r[a].substring(0,n),r[a].substring(n+1)):(i=r[a],null);i in t||(t[i]=[]),i in Object.prototype||null===n||t[i].push(unescape(n))}return t}e=void 0===e?f=null===f?"undefined"==typeof window?{}:t(window.location.search.substring(1)):f:t(e);return e},u.parseFragment=function(e){var t=e,r="",a=e.indexOf("?");0<a&&(t=e.substring(0,a),r=e.substring(a+1));a=t.split("/");return 0<a.length&&""===a[0]&&a.shift(),{pathString:t,queryString:r,path:a,query:""===r?{}:u.getQueryVariables(r)}},u.makeRequest=function(e){var a=u.parseFragment(e),r={path:a.pathString,query:a.queryString,getPath:function(e){return void 0===e?a.path:a.path[e]},getQuery:function(e,t){var r;return void 0===e?r=a.query:(r=a.query[e])&&void 0!==t&&(r=r[t]),r},getQueryLast:function(e,t){e=r.getQuery(e),t=e?e[e.length-1]:t;return t}};return r},u.makeLink=function(e,t,r){e=jQuery.isArray(e)?e.join("/"):e;t=jQuery.param(t||{});return e+(0<t.length?"?"+t:"")+(0<(r=r||"").length?"#"+r:"")},u.setPath=function(e,t,r){if("object"==typeof e&&null!==e)for(var a=0,i=t.length;a<i;){var n,s=t[a++];a==i?e[s]=r:((!(n=s in e)||n&&"object"!=typeof e[s]||n&&null===e[s])&&(e[s]={}),e=e[s])}},u.getPath=function(e,t,r){for(var a=0,i=t.length,n=!0;n&&a<i&&"object"==typeof e&&null!==e;){var s=t[a++];(n=s in e)&&(e=e[s])}return n?e:r},u.deletePath=function(e,t){if("object"==typeof e&&null!==e)for(var r=0,a=t.length;r<a;){var i=t[r++];if(r==a)delete e[i];else{if(!(i in e)||"object"!=typeof e[i]||null===e[i])break;e=e[i]}}},u.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},u.format=function(e){for(var t,r,a=/%./g,i=0,n=[],s=0;t=a.exec(e);){0<(r=e.substring(s,a.lastIndex-2)).length&&n.push(r);var s=a.lastIndex,o=t[0][1];switch(o){case"s":case"o":i<arguments.length?n.push(arguments[1+i++]):n.push("<?>");break;case"%":n.push("%");break;default:n.push("<%"+o+"?>")}}return n.push(e.substring(s)),n.join("")},u.formatNumber=function(e,t,r,a){var i=e,n=isNaN(t=Math.abs(t))?2:t,s=void 0===r?",":r,e=void 0===a?".":a,t=i<0?"-":"",r=parseInt(i=Math.abs(+i||0).toFixed(n),10)+"",a=3<r.length?r.length%3:0;return t+(a?r.substr(0,a)+e:"")+r.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+e)+(n?s+Math.abs(i-r).toFixed(n).slice(2):"")},u.formatSize=function(e){return e=1073741824<=e?u.formatNumber(e/1073741824,2,".","")+" GiB":1048576<=e?u.formatNumber(e/1048576,2,".","")+" MiB":1024<=e?u.formatNumber(e/1024,0)+" KiB":u.formatNumber(e,0)+" bytes"},u.bytesFromIP=function(e){return-1!==e.indexOf(".")?u.bytesFromIPv4(e):-1!==e.indexOf(":")?u.bytesFromIPv6(e):null},u.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=u.createBuffer(),r=0;r<e.length;++r){var a=parseInt(e[r],10);if(isNaN(a))return null;t.putByte(a)}return t.getBytes()},u.bytesFromIPv6=function(e){for(var t,r=0,a=2*(8-(e=e.split(":").filter(function(e){return 0===e.length&&++r,!0})).length+r),i=u.createBuffer(),n=0;n<8;++n)e[n]&&0!==e[n].length?((t=u.hexToBytes(e[n])).length<2&&i.putByte(0),i.putBytes(t)):(i.fillWithByte(0,a),a=0);return i.getBytes()},u.bytesToIP=function(e){return 4===e.length?u.bytesToIPv4(e):16===e.length?u.bytesToIPv6(e):null},u.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t.join(".")},u.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t,r=[],a=[],i=0,n=0;n<e.length;n+=2){for(var s,o,c=u.bytesToHex(e[n]+e[n+1]);"0"===c[0]&&"0"!==c;)c=c.substr(1);"0"===c&&(s=a[a.length-1],o=r.length,s&&o===s.end+1?(s.end=o,s.end-s.start>a[i].end-a[i].start&&(i=a.length-1)):a.push({start:o,end:o})),r.push(c)}return 0<a.length&&(0<(t=a[i]).end-t.start&&(r.splice(t.start,t.end-t.start+1,""),0===t.start&&r.unshift(""),7===t.end&&r.push(""))),r.join(":")},u.estimateCores=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"cores"in u&&!e.update)return t(null,u.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&0<navigator.hardwareConcurrency)return u.cores=navigator.hardwareConcurrency,t(null,u.cores);if("undefined"==typeof Worker)return u.cores=1,t(null,u.cores);if("undefined"==typeof Blob)return u.cores=2,t(null,u.cores);var s=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(e){for(var t=Date.now(),r=t+4;Date.now()<r;);self.postMessage({st:t,et:r})})}.toString(),")()"],{type:"application/javascript"}));function o(r,a){for(var i=[],n=[],e=0;e<r;++e){var t=new Worker(s);t.addEventListener("message",function(e){if(n.push(e.data),n.length===r){for(var t=0;t<r;++t)i[t].terminate();a(null,n)}}),i.push(t)}for(e=0;e<r;++e)i[e].postMessage(e)}function c(e,t){for(var r=[],a=0;a<e;++a)for(var i,n=t[a],s=r[a]=[],o=0;o<e;++o)a!==o&&(i=t[o],(n.st>i.st&&n.st<i.et||i.st>n.st&&i.st<n.et)&&s.push(o));return r.reduce(function(e,t){return Math.max(e,t.length)},0)}!function r(a,i,n){if(0===i){var e=Math.floor(a.reduce(function(e,t){return e+t},0)/a.length);return u.cores=Math.max(1,e),URL.revokeObjectURL(s),t(null,u.cores)}o(n,function(e,t){a.push(c(n,t)),r(a,i-1,n)})}([],5,16)}}(),function(){function h(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pem")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var g=dreamsecurity,e=g.pem=g.pem||{};function n(e){function t(e,t){return" "+t}for(var r=e.name+": ",a=[],i=0;i<e.values.length;++i)a.push(e.values[i].replace(/^(\S+\r\n)/,t));r+=a.join(",")+"\r\n";for(var n,s=0,o=-1,i=0;i<r.length;++i,++s)65<s&&-1!==o?(r=","===(n=r[o])?(++o,r.substr(0,o)+"\r\n "+r.substr(o)):r.substr(0,o)+"\r\n"+n+r.substr(o+1),s=i-o-1,o=-1,++i):" "!==r[i]&&"\t"!==r[i]&&","!==r[i]||(o=i);return r}e.encode=function(e,t){h(),t=t||{};var r,a="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(a+=n(r={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(a+=n(r={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(r={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&r.values.push(e.dekInfo.parameters),a+=n(r)),e.headers)for(var i=0;i<e.headers.length;++i)a+=n(e.headers[i]);return e.procType&&(a+="\r\n"),a+=g.util.encode64(e.body,t.maxline||64)+"\r\n",a+="-----END "+e.type+"-----\r\n"},e.decode=function(e){h();for(var t,r=[],a=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,i=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,n=/\r?\n/;t=a.exec(e);){var s={type:t[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:g.util.decode64(t[3])};if(r.push(s),t[2]){for(var o=t[2].split(n),c=0;t&&c<o.length;){for(var u=o[c].replace(/\s+$/,""),d=c+1;d<o.length;++d){var p=o[d];if(!/\s/.test(p[0]))break;u+=p,c=d}if(t=u.match(i)){for(var l={name:t[1],values:[]},y=t[2].split(","),f=0;f<y.length;++f)l.values.push(y[f].replace(/^\s+/,""));if(s.procType)if(s.contentDomain||"Content-Domain"!==l.name)if(s.dekInfo||"DEK-Info"!==l.name)s.headers.push(l);else{if(0===l.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');s.dekInfo={algorithm:y[0],parameters:y[1]||null}}else s.contentDomain=y[0]||"";else{if("Proc-Type"!==l.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==l.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');s.procType={version:y[0],type:y[1]}}}++c}if("ENCRYPTED"===s.procType&&!s.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===r.length)throw new Error("Invalid PEM formatted message.");return r}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var e=dreamsecurity;e.pki=e.pki||{};e=e.pki.oids=e.oids=e.oids||{};e["1.2.840.113549.1.1.1"]="rsaEncryption",e.rsaEncryption="1.2.840.113549.1.1.1",e["1.2.840.113549.1.1.4"]="md5WithRSAEncryption",e.md5WithRSAEncryption="1.2.840.113549.1.1.4",e["1.2.840.113549.1.1.5"]="sha1WithRSAEncryption",e.sha1WithRSAEncryption="1.2.840.113549.1.1.5",e["1.2.840.113549.1.1.7"]="RSAES-OAEP",e.RSAES_OAEP="1.2.840.113549.1.1.7",e["1.2.840.113549.1.1.8"]="mgf1",e.mgf1="1.2.840.113549.1.1.8",e["1.2.840.113549.1.1.9"]="pSpecified",e.pSpecified="1.2.840.113549.1.1.9",e["1.2.840.113549.1.1.10"]="RSASSA_PSS",e.RSASSA_PSS="1.2.840.113549.1.1.10",e["1.2.840.113549.1.1.11"]="sha256WithRSAEncryption",e.sha256WithRSAEncryption="1.2.840.113549.1.1.11",e["1.2.840.113549.1.1.12"]="sha384WithRSAEncryption",e.sha384WithRSAEncryption="1.2.840.113549.1.1.12",e["1.2.840.113549.1.1.13"]="sha512WithRSAEncryption",e.sha512WithRSAEncryption="1.2.840.113549.1.1.13",e["1.2.410.200004.1.21"]="kcdsa1",e.kcdsa1="1.2.410.200004.1.21",e["1.2.410.200004.1.23"]="kcdsa1WithSHA1",e.kcdsa1WithSHA1="1.2.410.200004.1.23",e["1.2.410.200004.1.38"]="kcdsa1WithSHA256",e.kcdsa1WithSHA256="1.2.410.200004.1.38",e["1.2.840.10045.2.1"]="ecPublicKey",e.ecPublicKey="1.2.840.10045.2.1",e["1.2.840.10045.4.3.2"]="ecdsaWithSHA256",e.ecdsaWithSHA256="1.2.840.10045.4.3.2",e["1.2.840.10045.3.1.7"]="secp256r1",e.secp256r1="1.2.840.10045.3.1.7",e["1.3.14.3.2.7"]="desCBC",e.desCBC="1.3.14.3.2.7",e["1.3.14.3.2.26"]="sha1",e.sha1="1.3.14.3.2.26",e["2.16.840.1.101.3.4.2.1"]="sha256",e.sha256="2.16.840.1.101.3.4.2.1",e["2.16.840.1.101.3.4.2.2"]="sha384",e.sha384="2.16.840.1.101.3.4.2.2",e["2.16.840.1.101.3.4.2.3"]="sha512",e.sha512="2.16.840.1.101.3.4.2.3",e["1.2.840.113549.2.5"]="md5",e.md5="1.2.840.113549.2.5",e["1.2.840.113549.1.7.1"]="data",e.data="1.2.840.113549.1.7.1",e["1.2.840.113549.1.7.2"]="signedData",e.signedData="1.2.840.113549.1.7.2",e["1.2.840.113549.1.7.3"]="envelopedData",e.envelopedData="1.2.840.113549.1.7.3",e["1.2.840.113549.1.7.4"]="signedAndEnvelopedData",e.signedAndEnvelopedData="1.2.840.113549.1.7.4",e["1.2.840.113549.1.7.5"]="digestedData",e.digestedData="1.2.840.113549.1.7.5",e["1.2.840.113549.1.7.6"]="encryptedData",e.encryptedData="1.2.840.113549.1.7.6",e["1.2.840.113549.1.9.16.1.4"]="tstInfo",e.tstInfo="1.2.840.113549.1.9.16.1.4",e["1.2.840.113549.1.9.16.2.12"]="signingCertificate",e.signingCertificate="1.2.840.113549.1.9.16.2.12",e["1.2.840.113549.1.9.16.2.47"]="signingCertificateV2",e.signingCertificateV2="1.2.840.113549.1.9.16.2.47",e["1.2.410.200032.2.2"]="arcCertRes",e.arcCertRes="1.2.410.200032.2.2",e["1.2.410.200032.2.3.1"]="kiec_qualifications",e.kiec_qualifications="1.2.410.200032.2.3.1",e["1.2.410.200032.2.3.2"]="kiec_usageType",e.kiec_usageType="1.2.410.200032.2.3.2",e["1.2.410.200032.2.3.3"]="kiec_dateOfExpiration",e.kiec_dateOfExpiration="1.2.410.200032.2.3.3",e["1.2.410.200032.2.3.4"]="kiec_certifiedTime",e.kiec_certifiedTime="1.2.410.200032.2.3.4",e["1.2.410.200032.2.3.5"]="kiec_certUsage",e.kiec_certUsage="1.2.410.200032.2.3.5",e["1.2.410.200032.2.3.6"]="kiec_docContentInfoFlag",e.kiec_docContentInfoFlag="1.2.410.200032.2.3.6",e["1.2.410.200032.2.4.1"]="kiec_hashedIDNInfo",e.kiec_hashedIDNInfo="1.2.410.200032.2.4.1",e["1.2.840.113549.1.9.1"]="emailAddress",e.emailAddress="1.2.840.113549.1.9.1",e["1.2.840.113549.1.9.2"]="unstructuredName",e.unstructuredName="1.2.840.113549.1.9.2",e["1.2.840.113549.1.9.3"]="contentType",e.contentType="1.2.840.113549.1.9.3",e["1.2.840.113549.1.9.4"]="messageDigest",e.messageDigest="1.2.840.113549.1.9.4",e["1.2.840.113549.1.9.5"]="signingTime",e.signingTime="1.2.840.113549.1.9.5",e["1.2.840.113549.1.9.6"]="counterSignature",e.counterSignature="1.2.840.113549.1.9.6",e["1.2.840.113549.1.9.7"]="challengePassword",e.challengePassword="1.2.840.113549.1.9.7",e["1.2.840.113549.1.9.8"]="unstructuredAddress",e.unstructuredAddress="1.2.840.113549.1.9.8",e["1.2.840.113549.1.9.14"]="extensionRequest",e.extensionRequest="1.2.840.113549.1.9.14",e["1.2.840.113549.1.9.20"]="friendlyName",e.friendlyName="1.2.840.113549.1.9.20",e["1.2.840.113549.1.9.21"]="localKeyId",e.localKeyId="1.2.840.113549.1.9.21",e["1.2.840.113549.1.9.22.1"]="x509Certificate",e.x509Certificate="1.2.840.113549.1.9.22.1",e["1.2.840.113549.1.12.10.1.1"]="keyBag",e.keyBag="1.2.840.113549.1.12.10.1.1",e["1.2.840.113549.1.12.10.1.2"]="pkcs8ShroudedKeyBag",e.pkcs8ShroudedKeyBag="1.2.840.113549.1.12.10.1.2",e["1.2.840.113549.1.12.10.1.3"]="certBag",e.certBag="1.2.840.113549.1.12.10.1.3",e["1.2.840.113549.1.12.10.1.4"]="crlBag",e.crlBag="1.2.840.113549.1.12.10.1.4",e["1.2.840.113549.1.12.10.1.5"]="secretBag",e.secretBag="1.2.840.113549.1.12.10.1.5",e["1.2.840.113549.1.12.10.1.6"]="safeContentsBag",e.safeContentsBag="1.2.840.113549.1.12.10.1.6",e["1.2.840.113549.1.5.13"]="pkcs5PBES2",e.pkcs5PBES2="1.2.840.113549.1.5.13",e["1.2.840.113549.1.5.12"]="pkcs5PBKDF2",e.pkcs5PBKDF2="1.2.840.113549.1.5.12",e["1.2.840.113549.1.12.1.1"]="pbeWithSHAAnd128BitRC4",e.pbeWithSHAAnd128BitRC4="1.2.840.113549.1.12.1.1",e["1.2.840.113549.1.12.1.2"]="pbeWithSHAAnd40BitRC4",e.pbeWithSHAAnd40BitRC4="1.2.840.113549.1.12.1.2",e["1.2.840.113549.1.12.1.3"]="pbeWithSHAAnd3-KeyTripleDES-CBC",e["pbeWithSHAAnd3-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.3",e["1.2.840.113549.1.12.1.4"]="pbeWithSHAAnd2-KeyTripleDES-CBC",e["pbeWithSHAAnd2-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.4",e["1.2.840.113549.1.12.1.5"]="pbeWithSHAAnd128BitRC2-CBC",e["pbeWithSHAAnd128BitRC2-CBC"]="1.2.840.113549.1.12.1.5",e["1.2.840.113549.1.12.1.6"]="pbewithSHAAnd40BitRC2-CBC",e["pbewithSHAAnd40BitRC2-CBC"]="1.2.840.113549.1.12.1.6",e["1.2.840.113549.3.7"]="des-EDE3-CBC",e["des-EDE3-CBC"]="1.2.840.113549.3.7",e["2.16.840.1.101.3.4.1.2"]="aes128-CBC",e["aes128-CBC"]="2.16.840.1.101.3.4.1.2",e["2.16.840.1.101.3.4.1.22"]="aes192-CBC",e["aes192-CBC"]="2.16.840.1.101.3.4.1.22",e["2.16.840.1.101.3.4.1.42"]="aes256-CBC",e["aes256-CBC"]="2.16.840.1.101.3.4.1.42",e["1.2.410.200004.1.4"]="seedCBC",e.seedCBC="1.2.410.200004.1.4",e["1.2.410.200004.1.15"]="seedCBCWithSHA1",e.seedCBCWithSHA1="1.2.410.200004.1.15",e["1.2.410.100001.1.20"]="ariaCBC",e.ariaCBC="1.2.410.100001.1.20",e["1.2.410.200046.1.1.2"]="aria128-CBC",e["aria128-CBC"]="1.2.410.200046.1.1.2",e["1.2.410.200046.1.1.7"]="aria192-CBC",e["aria192-CBC"]="1.2.410.200046.1.1.7",e["1.2.410.200046.1.1.12"]="aria256-CBC",e["aria256-CBC"]="1.2.410.200046.1.1.12",e["1.2.410.100001.1.24"]="pbeWithSHA1AndARIA_CBC",e.pbeWithSHA1AndARIA_CBC="1.2.410.100001.1.24",e["2.5.4.3"]="commonName",e.commonName="2.5.4.3",e["2.5.4.5"]="serialName",e.serialName="2.5.4.5",e["2.5.4.6"]="countryName",e.countryName="2.5.4.6",e["2.5.4.7"]="localityName",e.localityName="2.5.4.7",e["2.5.4.8"]="stateOrProvinceName",e.stateOrProvinceName="2.5.4.8",e["2.5.4.10"]="organizationName",e.organizationName="2.5.4.10",e["2.5.4.11"]="organizationalUnitName",e.organizationalUnitName="2.5.4.11",e["2.16.840.1.113730.1.1"]="nsCertType",e.nsCertType="2.16.840.1.113730.1.1",e["2.5.29.9"]="subjectDirectoryAttributes",e["2.5.29.14"]="subjectKeyIdentifier",e.subjectKeyIdentifier="2.5.29.14",e["2.5.29.15"]="keyUsage",e.keyUsage="2.5.29.15",e["2.5.29.16"]="privateKeyUsagePeriod",e["2.5.29.17"]="subjectAltName",e.subjectAltName="2.5.29.17",e["2.5.29.18"]="issuerAltName",e.issuerAltName="2.5.29.18",e["2.5.29.19"]="basicConstraints",e.basicConstraints="2.5.29.19",e["2.5.29.20"]="cRLNumber",e.cRLNumber="2.5.29.20",e["2.5.29.21"]="cRLReason",e.cRLReason="2.5.29.21",e["2.5.29.22"]="expirationDate",e["2.5.29.23"]="instructionCode",e["2.5.29.24"]="invalidityDate",e.invalidityDate="2.5.29.24",e["2.5.29.27"]="deltaCRLIndicator",e["2.5.29.28"]="issuingDistributionPoint",e.issuingDistributionPoint="2.5.29.28",e["2.5.29.29"]="certificateIssuer",e["2.5.29.30"]="nameConstraints",e["2.5.29.31"]="cRLDistributionPoints",e.cRLDistributionPoints="2.5.29.31",e["2.5.29.32"]="certificatePolicies",e.certificatePolicies="2.5.29.32",e["2.5.29.33"]="policyMappings",e["2.5.29.35"]="authorityKeyIdentifier",e.authorityKeyIdentifier="2.5.29.35",e["2.5.29.36"]="policyConstraints",e.policyConstraints="2.5.29.36",e["2.5.29.37"]="extKeyUsage",e.extKeyUsage="2.5.29.37",e["2.5.29.46"]="freshestCRL",e["2.5.29.54"]="inhibitAnyPolicy",e["1.3.6.1.5.5.7.3.1"]="serverAuth",e.serverAuth="1.3.6.1.5.5.7.3.1",e["1.3.6.1.5.5.7.3.2"]="clientAuth",e.clientAuth="1.3.6.1.5.5.7.3.2",e["1.3.6.1.5.5.7.3.3"]="codeSigning",e.codeSigning="1.3.6.1.5.5.7.3.3",e["1.3.6.1.5.5.7.3.4"]="emailProtection",e.emailProtection="1.3.6.1.5.5.7.3.4",e["1.3.6.1.5.5.7.3.8"]="timeStamping",e.timeStamping="1.3.6.1.5.5.7.3.8",e["1.3.6.1.5.5.7.1.1"]="authorityInfoAccess",e.authorityInfoAccess="1.3.6.1.5.5.7.1.1",e["1.3.6.1.5.5.7.2.1"]="cps",e["1.3.6.1.5.5.7.2.2"]="unotice",e.cps="1.3.6.1.5.5.7.2.1",e.unotice="1.3.6.1.5.5.7.2.2",e["1.3.6.1.5.5.7.48.1"]="ad_ocsp",e.ad_ocsp="1.3.6.1.5.5.7.48.1",e["1.3.6.1.5.5.7.48.2"]="ad_caIssuers",e.ad_caIssuers="1.3.6.1.5.5.7.48.2",e["1.2.410.200004.10.1.1"]="kisa_identifyData",e.kisa_identifyData="1.2.410.200004.10.1.1",e["1.2.410.200004.10.1.1.1"]="VID",e.VID="1.2.410.200004.10.1.1.1",e["1.2.410.200004.10.1.1.3"]="randomNum",e.randomNum="1.2.410.200004.10.1.1.3"}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var a=dreamsecurity;a.cipher=a.cipher||{},a.cipher.algorithms=a.cipher.algorithms||{},a.cipher.createCipher=function(e,t){var r=e;if(r="string"==typeof r?(r=a.cipher.getAlgorithm(r))&&r():r)return new a.cipher.BlockCipher({algorithm:r,key:t,decrypt:!1});e=new Error("Unsupported algorithm: "+e);throw e.type=a.err.unsupported,e},a.cipher.createDecipher=function(e,t){var r=e;if(!(r="string"==typeof r?(r=a.cipher.getAlgorithm(r))&&r():r))throw new Error("Unsupported algorithm: "+e);return new a.cipher.BlockCipher({algorithm:r,key:t,decrypt:!0})},a.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),a.cipher.algorithms[e]=t},a.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in a.cipher.algorithms?a.cipher.algorithms[e]:null};var e=a.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};e.prototype.start=function(e){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"cipher")}();var t,r={};for(t in e=e||{})r[t]=e[t];r.decrypt=this._decrypt,this._finish=!1,this._input=a.util.createBuffer(),this.output=e.output||a.util.createBuffer(),this.mode.start(r)},e.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);return this._input.compact(),this.output},e.prototype.finish=function(t){!t||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(e){return t(this.blockSize,e,!1)},this.mode.unpad=function(e){return t(this.blockSize,e,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,e)))}}(),function(){function t(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"cipherModes")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var a=dreamsecurity;a.cipher=a.cipher||{};var e=a.cipher.modes=a.cipher.modes||{};function r(e){if("string"==typeof e&&(e=a.util.createBuffer(e)),a.util.isArray(e)&&4<e.length){var t=e;e=a.util.createBuffer();for(var r=0;r<e.length;++r)e.putByte(t[r])}return e=!a.util.isArray(e)?[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]:e}e.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=new Array(this._blocks),this._outBlock=new Array(this._blocks)},e.cbc.prototype.start=function(e){if(t(),null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=r(e.iv),this._prev=this._iv.slice(0)}},e.cbc.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&0<e.length()))return!0;for(var a=0;a<this._blocks;++a)this._inBlock[a]=this._prev[a]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(a=0;a<this._blocks;++a)t.putInt32(this._outBlock[a]);this._prev=this._outBlock},e.cbc.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&0<e.length()))return!0;for(var a=0;a<this._blocks;++a)this._inBlock[a]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(a=0;a<this._blocks;++a)t.putInt32(this._prev[a]^this._outBlock[a]);this._prev=this._inBlock.slice(0)},e.cbc.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},e.cbc.prototype.unpad=function(e,t){if(0<t.overflow)return!1;t=e.length(),t=e.at(t-1);return!(t>this.blockSize<<2)&&(e.truncate(t),!0)},e.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._blocks),this._partialOutput=a.util.createBuffer(),this._partialBytes=0},e.ctr.prototype.start=function(e){if(t(),!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=r(e.iv),this._inBlock=this._iv.slice(0),this._partialBytes=0},e.ctr.prototype.encrypt=function(e,t,r,a){var i=e.length();if(0===i)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&i>=this.blockSize)for(var n=0;n<this._blocks;++n)t.putInt32(e.getInt32()^this._outBlock[n]);else{var s=(this.blockSize-i)%this.blockSize;0<s&&(s=this.blockSize-s),this._partialOutput.clear();for(n=0;n<this._blocks;++n)this._partialOutput.putInt32(e.getInt32()^this._outBlock[n]);if(0<s&&(e.read-=this.blockSize),0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<s&&!r)return t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}(i=this._inBlock)[i.length-1]=i[i.length-1]+1&4294967295},e.ctr.prototype.decrypt=e.ctr.prototype.encrypt}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var d=dreamsecurity;(d.hmac=d.hmac||{}).create=function(){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"hmac")}();var s=null,o=null,c=null,u=null,e={start:function(e,t){if(null!==e)if("string"==typeof e){if(!((e=e.toLowerCase())in d.md.algorithms)){var r=new Error('Unknown hash algorithm "'+e+'"');throw r.type=d.err.unsupported,r}o=d.md.algorithms[e].create()}else o=e;if(null===t)t=s;else{if("string"==typeof t)t=d.util.createBuffer(t);else if(d.util.isArray(t)){var a=t;t=d.util.createBuffer();for(var i=0;i<a.length;++i)t.putByte(a[i])}(n=t.length())>o.blockLength&&(o.start(),o.update(t.bytes()),t=o.digest()),c=d.util.createBuffer(),u=d.util.createBuffer();for(var n=t.length(),i=0;i<n;++i){a=t.at(i);c.putByte(54^a),u.putByte(92^a)}if(n<o.blockLength)for(a=o.blockLength-n,i=0;i<a;++i)c.putByte(54),u.putByte(92);s=t,c=c.bytes(),u=u.bytes()}o.start(),o.update(c)},update:function(e){o.update(e)},getMac:function(){var e=o.digest().bytes();return o.start(),o.update(u),o.update(e),o.digest()}};return e.digest=e.getMac,e}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var s=dreamsecurity,e=s.sha1=s.sha1||{};s.md=s.md||{},s.md.algorithms=s.md.algorithms||{},(s.md.sha1=s.md.algorithms.sha1=e).create=function(){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"sha1")}(),t||(o=String.fromCharCode(128),o+=s.util.fillString(String.fromCharCode(0),64),t=!0);var r=null,a=s.util.createBuffer(),i=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,messageLength64:[0,0],start:function(){return n.messageLength=0,n.messageLength64=[0,0],a=s.util.createBuffer(),r={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n}};return n.start(),n.update=function(e,t){return"utf8"===t&&(e=s.util.encodeUtf8(e)),n.messageLength+=e.length,n.messageLength64[0]+=e.length/4294967296>>>0,n.messageLength64[1]+=e.length>>>0,a.putBytes(e),c(r,i,a),(2048<a.read||0===a.length())&&a.compact(),n},n.digest=function(){var e=s.util.createBuffer();e.putBytes(a.bytes()),e.putBytes(o.substr(0,64-(n.messageLength64[1]+8&63))),e.putInt32(n.messageLength64[0]<<3|n.messageLength64[0]>>>28),e.putInt32(n.messageLength64[1]<<3);var t={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4};c(t,i,e);e=s.util.createBuffer();return e.putInt32(t.h0),e.putInt32(t.h1),e.putInt32(t.h2),e.putInt32(t.h3),e.putInt32(t.h4),e},n};var o=null,t=!1;function c(e,t,r){for(var a,i,n,s,o,c,u,d=r.length();64<=d;){for(i=e.h0,n=e.h1,s=e.h2,o=e.h3,c=e.h4,u=0;u<16;++u)a=r.getInt32()>>>0,t[u]=a>>>0,a=(i<<5|i>>>27)+((o^n&(s^o))>>>0)+c+1518500249+a>>>0,c=o>>>0,o=s>>>0,s=(n<<30|n>>>2)>>>0,n=i>>>0,i=a>>>0;for(;u<20;++u)a=(t[u-3]^t[u-8]^t[u-14]^t[u-16])>>>0,a=(i<<5|i>>>27)+((o^n&(s^o))>>>0)+c+1518500249+(t[u]=a=(a<<1|a>>>31)>>>0)>>>0,c=o>>>0,o=s>>>0,s=(n<<30|n>>>2)>>>0,n=i>>>0,i=a>>>0;for(;u<32;++u)a=(t[u-3]^t[u-8]^t[u-14]^t[u-16])>>>0,t[u]=(a=(a<<1|a>>>31)>>>0)>>>0,a=(i<<5|i>>>27)+((n^s^o)>>>0)+c+1859775393+a>>>0,c=o>>>0,o=s>>>0,s=(n<<30|n>>>2)>>>0,n=i>>>0,i=a>>>0;for(;u<40;++u)a=(t[u-6]^t[u-16]^t[u-28]^t[u-32])>>>0,t[u]=(a=(a<<2|a>>>30)>>>0)>>>0,a=(i<<5|i>>>27)+((n^s^o)>>>0)+c+1859775393+a>>>0,c=o>>>0,o=s>>>0,s=(n<<30|n>>>2)>>>0,n=i>>>0,i=a>>>0;for(;u<60;++u)a=(t[u-6]^t[u-16]^t[u-28]^t[u-32])>>>0,t[u]=(a=(a<<2|a>>>30)>>>0)>>>0,a=(i<<5|i>>>27)+((n&s|o&(n^s))>>>0)+c+2400959708+a>>>0,c=o>>>0,o=s>>>0,s=(n<<30|n>>>2)>>>0,n=i>>>0,i=a>>>0;for(;u<80;++u)a=(t[u-6]^t[u-16]^t[u-28]^t[u-32])>>>0,t[u]=(a=(a<<2|a>>>30)>>>0)>>>0,a=(i<<5|i>>>27)+((n^s^o)>>>0)+c+3395469782+a>>>0,c=o>>>0,o=s>>>0,s=(n<<30|n>>>2)>>>0,n=i>>>0,i=a>>>0;e.h0=e.h0+i|0,e.h1=e.h1+n|0,e.h2=e.h2+s|0,e.h3=e.h3+o|0,e.h4=e.h4+c|0,d-=64}}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var s=dreamsecurity,e=s.sha256=s.sha256||{};s.md=s.md||{},s.md.algorithms=s.md.algorithms||{},(s.md.sha256=s.md.algorithms.sha256=e).create=function(){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"sha256")}(),t||(o=String.fromCharCode(128),o+=s.util.fillString(String.fromCharCode(0),64),g=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],t=!0);var r=null,a=s.util.createBuffer(),i=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,messageLength64:[0,0],start:function(){return n.messageLength=0,n.messageLength64=[0,0],a=s.util.createBuffer(),r={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n}};return n.start(),n.update=function(e,t){return"utf8"===t&&(e=s.util.encodeUtf8(e)),n.messageLength+=e.length,n.messageLength64[0]+=e.length/4294967296>>>0,n.messageLength64[1]+=e.length>>>0,a.putBytes(e),c(r,i,a),(2048<a.read||0===a.length())&&a.compact(),n},n.digest=function(){var e=s.util.createBuffer();e.putBytes(a.bytes()),e.putBytes(o.substr(0,64-(n.messageLength64[1]+8&63))),e.putInt32(n.messageLength64[0]<<3|n.messageLength64[0]>>>28),e.putInt32(n.messageLength64[1]<<3);var t={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4,h5:r.h5,h6:r.h6,h7:r.h7};c(t,i,e);e=s.util.createBuffer();return e.putInt32(t.h0),e.putInt32(t.h1),e.putInt32(t.h2),e.putInt32(t.h3),e.putInt32(t.h4),e.putInt32(t.h5),e.putInt32(t.h6),e.putInt32(t.h7),e},n};var o=null,t=!1,g=null;function c(e,t,r){for(var a,i,n,s,o,c,u,d,p,l,y,f,h=r.length();64<=h;){for(s=0;s<16;++s)t[s]=r.getInt32();for(;s<64;++s)a=t[s-2],i=t[s-15],t[s]=(a=(a>>>17|a<<15)^(a>>>19|a<<13)^a>>>10)+t[s-7]+(i=(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)+t[s-16]|0;for(o=e.h0,c=e.h1,u=e.h2,d=e.h3,p=e.h4,l=e.h5,y=e.h6,f=e.h7,s=0;s<64;++s)n=o&c|u&(o^c),a=f+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(y^p&(l^y))+g[s]+t[s],f=y,y=l,l=p,p=d+a|0,d=u,u=c,o=a+(i=(((c=o)>>>2|o<<30)^(o>>>13|o<<19)^(o>>>22|o<<10))+n)|0;e.h0=e.h0+o|0,e.h1=e.h1+c|0,e.h2=e.h2+u|0,e.h3=e.h3+d|0,e.h4=e.h4+p|0,e.h5=e.h5+l|0,e.h6=e.h6+y|0,e.h7=e.h7+f|0,h-=64}}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var p=dreamsecurity,e=p.sha512=p.sha512||{};p.md=p.md||{},p.md.algorithms=p.md.algorithms||{},p.md.sha512=p.md.algorithms.sha512=e;var t=p.sha384=p.sha512.sha384=p.sha512.sha384||{};t.create=function(){return e.create("SHA-384")},p.md.sha384=p.md.algorithms.sha384=t,p.sha512.sha256=p.sha512.sha256||{create:function(){return e.create("SHA-512/256")}},p.md["sha512/256"]=p.md.algorithms["sha512/256"]=p.sha512.sha256,p.sha512.sha224=p.sha512.sha224||{create:function(){return e.create("SHA-512/224")}},p.md["sha512/224"]=p.md.algorithms["sha512/224"]=p.sha512.sha224,e.create=function(s){if(!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"sha512")}(),r||(l=String.fromCharCode(128),l+=p.util.fillString(String.fromCharCode(0),128),k=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],a={"SHA-512":[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],"SHA-384":[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],"SHA-512/256":[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],"SHA-512/224":[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]]},r=!0),!((s=void 0===s?"SHA-512":s)in a))throw new Error("Invalid SHA-512 algorithm: "+s);for(var t=a[s],o=null,c=p.util.createBuffer(),u=new Array(80),e=0;e<80;++e)u[e]=new Array(2);var d={algorithm:s.replace("-","").toLowerCase(),blockLength:128,digestLength:64,messageLength:0,messageLength128:[0,0,0,0],start:function(){d.messageLength=0,d.messageLength128=[0,0,0,0],c=p.util.createBuffer(),o=new Array(t.length);for(var e=0;e<t.length;++e)o[e]=t[e].slice(0);return d}};return d.start(),d.update=function(e,t){"utf8"===t&&(e=p.util.encodeUtf8(e)),d.messageLength+=e.length;for(var r=[(r=e.length)/4294967296>>>0,r>>>0],a=3;0<=a;--a)d.messageLength128[a]+=r[1],r[1]=r[0]+(d.messageLength128[a]/4294967296>>>0),d.messageLength128[a]=d.messageLength128[a]>>>0,r[0]=r[1]/4294967296>>>0;return c.putBytes(e),y(o,u,c),(2048<c.read||0===c.length())&&c.compact(),d},d.digest=function(){var e=p.util.createBuffer();e.putBytes(c.bytes()),e.putBytes(l.substr(0,128-(d.messageLength128[3]+16&127)));for(var t=[],r=0;r<3;++r)t[r]=d.messageLength128[r]<<3|d.messageLength128[r-1]>>>28;t[3]=d.messageLength128[3]<<3,e.putInt32(t[0]),e.putInt32(t[1]),e.putInt32(t[2]),e.putInt32(t[3]);for(var a=new Array(o.length),r=0;r<o.length;++r)a[r]=o[r].slice(0);y(a,u,e);for(var i=p.util.createBuffer(),n="SHA-512"===s?a.length:"SHA-384"===s?a.length-2:a.length-4,r=0;r<n;++r)i.putInt32(a[r][0]),r===n-1&&"SHA-512/224"===s||i.putInt32(a[r][1]);return i},d};var l=null,r=!1,k=null,a=null;function y(e,t,r){for(var a,i,n,s,o,c,u,d,p,l,y,f,h,g,m,C,E,v,S,I,T,A,b,N,B,R=r.length();128<=R;){for(T=0;T<16;++T)t[T][0]=r.getInt32()>>>0,t[T][1]=r.getInt32()>>>0;for(;T<80;++T)a=(((A=(N=t[T-2])[0])>>>19|(b=N[1])<<13)^(b>>>29|A<<3)^A>>>6)>>>0,i=((A<<13|b>>>19)^(b<<3|A>>>29)^(A<<26|b>>>6))>>>0,n=(((A=(B=t[T-15])[0])>>>1|(b=B[1])<<31)^(A>>>8|b<<24)^A>>>7)>>>0,N=t[T-7],B=t[T-16],b=i+N[1]+(s=((A<<31|b>>>1)^(A<<24|b>>>8)^(A<<25|b>>>7))>>>0)+B[1],t[T][0]=a+N[0]+n+B[0]+(b/4294967296>>>0)>>>0,t[T][1]=b>>>0;for(o=e[0][0],c=e[0][1],u=e[1][0],d=e[1][1],p=e[2][0],l=e[2][1],y=e[3][0],f=e[3][1],h=e[4][0],g=e[4][1],m=e[5][0],C=e[5][1],E=e[6][0],v=e[6][1],S=e[7][0],I=e[7][1],T=0;T<80;++T)b=I+(((h<<18|g>>>14)^(h<<14|g>>>18)^(g<<23|h>>>9))>>>0)+((v^g&(C^v))>>>0)+k[T][1]+t[T][1],a=S+(((h>>>14|g<<18)^(h>>>18|g<<14)^(g>>>9|h<<23))>>>0)+((E^h&(m^E))>>>0)+k[T][0]+t[T][0]+(b/4294967296>>>0)>>>0,i=b>>>0,n=(((o>>>28|c<<4)^(c>>>2|o<<30)^(c>>>7|o<<25))>>>0)+((o&u|p&(o^u))>>>0)+((b=(((o<<4|c>>>28)^(c<<30|o>>>2)^(c<<25|o>>>7))>>>0)+((c&d|l&(c^d))>>>0))/4294967296>>>0)>>>0,s=b>>>0,S=E,I=v,E=m,v=C,m=h,C=g,h=y+a+((b=f+i)/4294967296>>>0)>>>0,g=b>>>0,y=p,f=l,p=u,l=d,u=o,d=c,o=a+n+((b=i+s)/4294967296>>>0)>>>0,c=b>>>0;b=e[0][1]+c,e[0][0]=e[0][0]+o+(b/4294967296>>>0)>>>0,e[0][1]=b>>>0,b=e[1][1]+d,e[1][0]=e[1][0]+u+(b/4294967296>>>0)>>>0,e[1][1]=b>>>0,b=e[2][1]+l,e[2][0]=e[2][0]+p+(b/4294967296>>>0)>>>0,e[2][1]=b>>>0,b=e[3][1]+f,e[3][0]=e[3][0]+y+(b/4294967296>>>0)>>>0,e[3][1]=b>>>0,b=e[4][1]+g,e[4][0]=e[4][0]+h+(b/4294967296>>>0)>>>0,e[4][1]=b>>>0,b=e[5][1]+C,e[5][0]=e[5][0]+m+(b/4294967296>>>0)>>>0,e[5][1]=b>>>0,b=e[6][1]+v,e[6][0]=e[6][0]+E+(b/4294967296>>>0)>>>0,e[6][1]=b>>>0,b=e[7][1]+I,e[7][0]=e[7][0]+S+(b/4294967296>>>0)>>>0,e[7][1]=b>>>0,R-=128}}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var p=dreamsecurity,e="undefined"!=typeof process&&process.versions&&process.versions.node,n=null;p.disableNativeCode||!e||process.versions["node-webkit"]||(n=require("crypto")),(p.prng=p.prng||{}).create=function(e){for(var u={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0},t=e.md,r=new Array(32),a=0;a<32;++a)r[a]=t.create();function d(r){if(32<=u.pools[0].messageLength)return o(),r();var e=32-u.pools[0].messageLength<<5;u.seedFile(e,function(e,t){return e?r(e):(u.collect(t),o(),void r())})}function o(){var e=u.plugin.md.create();e.update(u.pools[0].digest().getBytes()),u.pools[0].start();for(var t=1,r=1;r<32;++r)(t=31===t?2147483648:t<<2)%u.reseeds==0&&(e.update(u.pools[r].digest().getBytes()),u.pools[r].start());var a=e.digest().getBytes();e.start(),e.update(a);var i=e.digest().getBytes();u.key=u.plugin.formatKey(a),u.seed=u.plugin.formatSeed(i),u.reseeds=4294967295===u.reseeds?0:u.reseeds+1,u.generated=0}function i(e){var t,r=null;"undefined"==typeof window||(t=window.crypto||window.msCrypto)&&t.getRandomValues&&(r=function(e){return t.getRandomValues(e)});var a=p.util.createBuffer();if(r)for(;a.length()<e;){var i=Math.max(1,Math.min(e-a.length(),65536)/4),n=new Uint32Array(Math.floor(i));try{r(n);for(var s=0;s<n.length;++s)a.putInt32(n[s])}catch(e){if(!("undefined"!=typeof QuotaExceededError&&e instanceof QuotaExceededError))throw e}}if(a.length()<e)for(var o,c,u=Math.floor(65536*Math.random());a.length()<e;){d=16807*(65535&u),d+=(32767&(o=16807*(u>>16)))<<16;for(var d,u=4294967295&(d=(2147483647&(d+=o>>15))+(d>>31)),s=0;s<3;++s)c=u>>>(s<<3),c^=Math.floor(256*Math.random()),a.putByte(String.fromCharCode(255&c))}return a.getBytes(e)}return u.pools=r,u.pool=0,u.generate=function(r,a){if(!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"prng")}(),!a)return u.generateSync(r);var i=u.plugin.cipher,n=u.plugin.increment,s=u.plugin.formatKey,o=u.plugin.formatSeed,c=p.util.createBuffer();u.key=null,function e(t){if(t)return a(t);if(c.length()>=r)return a(null,c.getBytes(r));1048575<u.generated&&(u.key=null);if(null===u.key)return p.util.nextTick(function(){d(e)});t=i(u.key,u.seed);u.generated+=t.length;c.putBytes(t);u.key=s(i(u.key,n(u.seed)));u.seed=o(i(u.key,u.seed));p.util.setImmediate(e)}()},u.generateSync=function(e){var t=u.plugin.cipher,r=u.plugin.increment,a=u.plugin.formatKey,i=u.plugin.formatSeed;u.key=null;for(var n=p.util.createBuffer();n.length()<e;){1048575<u.generated&&(u.key=null),null===u.key&&function(){if(32<=u.pools[0].messageLength)return o();var e=32-u.pools[0].messageLength<<5;u.collect(u.seedFileSync(e)),o()}();var s=t(u.key,u.seed);u.generated+=s.length,n.putBytes(s),u.key=a(t(u.key,r(u.seed))),u.seed=i(t(u.key,u.seed))}return n.getBytes(e)},n?(u.seedFile=function(e,r){n.randomBytes(e,function(e,t){return e?r(e):void r(null,t.toString())})},u.seedFileSync=function(e){return n.randomBytes(e).toString()}):(u.seedFile=function(e,t){try{t(null,i(e))}catch(e){t(e)}},u.seedFileSync=i),u.collect=function(e){for(var t=e.length,r=0;r<t;++r)u.pools[u.pool].update(e.substr(r,1)),u.pool=31===u.pool?0:u.pool+1},u.collectInt=function(e,t){for(var r="",a=0;a<t;a+=8)r+=String.fromCharCode(e>>a&255);u.collect(r)},u.registerWorker=function(r){r===self?u.seedFile=function(e,r){self.addEventListener("message",function e(t){t=t.data;t._ds&&t._ds.prng&&(self.removeEventListener("message",e),r(t._ds.prng.err,t._ds.prng.bytes))}),self.postMessage({_ds:{prng:{needed:e}}})}:r.addEventListener("message",function(e){e=e.data;e._ds&&e._ds.prng&&u.seedFile(e._ds.prng.needed,function(e,t){r.postMessage({_ds:{prng:{err:e,bytes:t}}})})})},u}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var p=dreamsecurity;p.random&&p.random.getBytes||function(e){var t={},r=new Array(4),a=null;function i(){var r=p.prng.create(t);return r.getBytes=function(e,t){return r.generate(e,t)},r.getBytesSync=function(e){return function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"random")}(),r.generate(e)},r}t.formatKey=function(e){var t=p.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),p.aes._expandKey(e,!1)},t.formatSeed=function(e){var t=p.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},t.cipher=function(e,t){return p.aes._updateBlock(e,t,r,!1),(a=null==a?p.util.createBuffer():a).putInt32(r[0]),a.putInt32(r[1]),a.putInt32(r[2]),a.putInt32(r[3]),a.getBytes()},t.increment=function(e){return++e[3],e},t.md=p.md.sha256;var n,s=i(),o="undefined"!=typeof process&&process.versions&&process.versions.node,c=null;if("undefined"==typeof window||(n=window.crypto||window.msCrypto)&&n.getRandomValues&&(c=function(e){return n.getRandomValues(e)}),p.disableNativeCode||!o&&!c){if(s.collectInt(+new Date,32),"undefined"!=typeof navigator){var u="";for(d in navigator)try{"string"==typeof navigator[d]&&(u+=navigator[d])}catch(e){window&&window.console&&console.log(e);}s.collect(u),u=null}e&&(e().mousemove(function(e){s.collectInt(e.clientX,16),s.collectInt(e.clientY,16)}),e().keypress(function(e){s.collectInt(e.charCode,8)}))}if(p.random)for(var d in s)p.random[d]=s[d];else p.random=s;p.random.createInstance=i}("undefined"!=typeof jQuery?jQuery:null)}(),function(){function c(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"rsa")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var d,p=dreamsecurity;void 0===d&&(d=p.jsbn.BigInteger);var l=p.asn1;p.pki=p.pki||{},p.pki.rsa=p.rsa=p.rsa||{};function u(e){if(!(e.algorithm in f.oids)){var t=new Error("Unknown message digest algorithm.");throw t.algorithm=e.algorithm,t}var r=f.oids[e.algorithm],a=l.oidToDer(r).getBytes(),t=l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[]);return(r=l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[])).value.push(l.create(l.Class.UNIVERSAL,l.Type.OID,!1,a)),r.value.push(l.create(l.Class.UNIVERSAL,l.Type.NULL,!1,"")),e=l.create(l.Class.UNIVERSAL,l.Type.OCTETSTRING,!1,e.digest().getBytes()),t.value.push(r),t.value.push(e),l.toDer(t).getBytes()}function y(e,t,r){if(r)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var a;for(t.dP||(t.dP=t.d.mod(t.p.subtract(d.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(d.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));(a=new d(p.util.bytesToHex(p.random.getBytes(t.n.bitLength()/8)),16).mod(t.n)).equals(d.ZERO););for(var i=(e=e.multiply(a.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),n=e.mod(t.q).modPow(t.dQ,t.q);i.compareTo(n)<0;)i=i.add(t.p);return i.subtract(n).multiply(t.qInv).mod(t.p).multiply(t.q).add(n).multiply(a.modInverse(t.n)).mod(t.n)}var f=p.pki,h=[6,4,2,4,2,4,6,2],g={name:"RSAPrivateKey",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},i={name:"RSAPublicKey",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]};function m(e,t,r){var a=p.util.createBuffer(),i=Math.ceil(t.n.bitLength()/8);if(e.length>i-11){t=new Error("Message is too long for PKCS#1 v1.5 padding.");throw t.length=e.length,t.max=i-11,t}a.putByte(0),a.putByte(r);var n=i-3-e.length;if(0===r||1===r)for(var s=0===r?0:255,o=0;o<n;++o)a.putByte(s);else for(;0<n;){for(var c=0,u=p.random.getBytes(n),o=0;o<n;++o)0===(s=u.charCodeAt(o))?++c:a.putByte(s);n=c}return a.putByte(0),a.putBytes(e),a}function C(e,t,r,a){var i=Math.ceil(t.n.bitLength()/8),n=p.util.createBuffer(e),t=n.getByte(),e=n.getByte();if(0!==t||r&&0!==e&&1!==e||!r&&2!=e||r&&0===e&&void 0===a)throw new Error("Encryption block is invalid.");var s=0;if(0===e){for(var s=i-3-a,o=0;o<s;++o)if(0!==n.getByte())throw new Error("Encryption block is invalid.")}else if(1===e)for(s=0;1<n.length();){if(255!==n.getByte()){--n.read;break}++s}else if(2===e)for(s=0;1<n.length();){if(0===n.getByte()){--n.read;break}++s}if(0!==n.getByte()||s!==i-3-n.length())throw new Error("Encryption block is invalid.");return n.getBytes()}function t(e){e=e.toString(16);return"8"<=e[0]&&(e="00"+e),p.util.hexToBytes(e)}f.rsa.encrypt=function(e,t,r){c();var a=r,i=Math.ceil(t.n.bitLength()/8);!1!==r&&!0!==r?(a=2===r,n=m(e,t,r)):(n=p.util.createBuffer()).putBytes(e);for(var n=new d(n.toHex(),16),a=y(n,t,a).toString(16),s=p.util.createBuffer(),o=i-Math.ceil(a.length/2);0<o;)s.putByte(0),--o;return s.putBytes(p.util.hexToBytes(a)),s.getBytes()},f.rsa.decrypt=function(e,t,r,a){!p.gf&&p.vi.filter&&c();var i=Math.ceil(t.n.bitLength()/8);if(e.length!==i){var n=new Error("Encrypted message length is invalid.");throw n.length=e.length,n.expected=i,n}e=new d(p.util.createBuffer(e).toHex(),16);if(0<=e.compareTo(t.n))throw new Error("Encrypted message is invalid.");for(var e=y(e,t,r).toString(16),s=p.util.createBuffer(),o=i-Math.ceil(e.length/2);0<o;)s.putByte(0),--o;return s.putBytes(p.util.hexToBytes(e)),!1!==a?C(s.getBytes(),t,r):s.getBytes()},f.rsa.createKeyPairGenerationState=function(e,t,r){e=(e="string"==typeof e?parseInt(e,10):e)||2048;var a=(r=r||{}).prng||p.random,i={nextBytes:function(e){for(var t=a.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},r=r.algorithm||"PRIMEINC";if("PRIMEINC"!==r)throw new Error("Invalid key generation algorithm: "+r);return(e={algorithm:r,state:0,bits:e,rng:i,eInt:t||65537,e:new d(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(e.eInt),e},f.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new d(null);r.fromInt(30);function a(e,t){return e|t}for(var i,n,s,o=0,c=+new Date,u=0;null===e.keys&&(t<=0||u<t);)0===e.state?(i=(s=null===e.p?e.pBits:e.qBits)-1,0===e.pqState?(e.num=new d(s,e.rng),e.num.testBit(i)||e.num.bitwiseTo(d.ONE.shiftLeft(i),a,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),o=0,++e.pqState):1===e.pqState?e.num.bitLength()>s?e.pqState=0:e.num.isProbablePrime((s=e.num.bitLength())<=100?27:s<=150?18:s<=200?15:s<=250?12:s<=300?9:s<=350?8:s<=400?7:s<=500?6:s<=600?5:s<=800?4:s<=1250?3:2)?++e.pqState:e.num.dAddOffset(h[o++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(d.ONE).gcd(e.e).compareTo(d.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)):1===e.state?(e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state):2===e.state?(e.p1=e.p.subtract(d.ONE),e.q1=e.q.subtract(d.ONE),e.phi=e.p1.multiply(e.q1),++e.state):3===e.state?0===e.phi.gcd(e.e).compareTo(d.ONE)?++e.state:(e.p=null,e.q=null,e.state=0):4===e.state?(e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0)):5===e.state&&(n=e.e.modInverse(e.phi),e.keys={privateKey:f.rsa.setPrivateKey(e.n,e.e,n,e.p,e.q,n.mod(e.p1),n.mod(e.q1),e.q.modInverse(e.p)),publicKey:f.rsa.setPublicKey(e.n,e.e)}),u+=(n=+new Date)-c,c=n;return null!==e.keys},f.rsa.generateKeyPair=function(e,t,r,a){1===arguments.length?"object"==typeof e?(r=e,e=void 0):"function"==typeof e&&(a=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof t?(a=t,t=void 0):"number"!=typeof t&&(r=t,t=void 0):(r=e,a=t,t=e=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof r&&(a=r,r=void 0):(a=r,r=t,t=void 0)),r=r||{},void 0===e&&(e=r.bits||2048),void 0===t&&(t=r.e||65537);var i=f.rsa.createKeyPairGenerationState(e,t,r);if(!a)return f.rsa.stepKeyPairGenerationState(i,0),i.keys;!function(a,e,i){"function"==typeof e&&(i=e,e={});var r={algorithm:{name:(e=e||{}).algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(r.prng=e.prng);function n(){s(a.pBits,function(e,t){return e?i(e):(a.p=t,null!==a.q?o(e,a.q):void s(a.qBits,o))})}function s(e,t){p.prime.generateProbablePrime(e,r,t)}function o(e,t){if(e)return i(e);if(a.q=t,a.p.compareTo(a.q)<0&&(r=a.p,a.p=a.q,a.q=r),0!==a.p.subtract(d.ONE).gcd(a.e).compareTo(d.ONE))return a.p=null,void n();if(0!==a.q.subtract(d.ONE).gcd(a.e).compareTo(d.ONE))return a.q=null,void s(a.qBits,o);if(a.p1=a.p.subtract(d.ONE),a.q1=a.q.subtract(d.ONE),a.phi=a.p1.multiply(a.q1),0!==a.phi.gcd(a.e).compareTo(d.ONE))return a.p=a.q=null,void n();if(a.n=a.p.multiply(a.q),a.n.bitLength()!==a.bits)return a.q=null,void s(a.qBits,o);var r=a.e.modInverse(a.phi);a.keys={privateKey:f.rsa.setPrivateKey(a.n,a.e,r,a.p,a.q,r.mod(a.p1),r.mod(a.q1),a.q.modInverse(a.p)),publicKey:f.rsa.setPublicKey(a.n,a.e)},i(null,a.keys)}n()}(i,r,a)},f.setRsaPublicKey=f.rsa.setPublicKey=function(e,t){var a={n:e,e:t,encrypt:function(e,t,r){if("string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,r){return m(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return p.pkcs1.encode_rsa_oaep(t,e,r)}};else if(-1!==p.util.arrayIndexOf(["RAW","NONE","NULL",null],t))t={encode:function(e){return e}};else if("string"==typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');e=t.encode(e,a,!0);return f.rsa.encrypt(e,a,!0)},verify:function(e,t,r){"string"==typeof r?r=r.toUpperCase():void 0===r&&(r="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===r?r={verify:function(e,t){return t=C(t,a,!0),e===l.fromDer(t).value[1].value}}:"NONE"!==r&&"NULL"!==r&&null!==r||(r={verify:function(e,t){return e===(t=C(t,a,!0))}});t=f.rsa.decrypt(t,a,!0,!1);return r.verify(e,t,a.n.bitLength())}};return a},f.setRsaPrivateKey=f.rsa.setPrivateKey=function(e,t,r,a,i,n,s,o){var c={n:e,e:t,d:r,p:a,q:i,dP:n,dQ:s,qInv:o,decrypt:function(e,t,r){"string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");e=f.rsa.decrypt(e,c,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:C};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return p.pkcs1.decode_rsa_oaep(t,e,r)}};else{if(-1===p.util.arrayIndexOf(["RAW","NONE","NULL",null],t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(e,c,!1)},sign:function(e,t){var r=!1;void 0===(t="string"==typeof t?t.toUpperCase():t)||"RSASSA-PKCS1-V1_5"===t?(t={encode:u},r=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},r=1);t=t.encode(e,c.n.bitLength());return f.rsa.encrypt(t,c,r)}};return c},f.wrapRsaPrivateKey=function(e){return l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,l.integerToDer(0).getBytes()),l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OID,!1,l.oidToDer(f.oids.rsaEncryption).getBytes()),l.create(l.Class.UNIVERSAL,l.Type.NULL,!1,"")]),l.create(l.Class.UNIVERSAL,l.Type.OCTETSTRING,!1,l.toDer(e).getBytes())])},f.rsa.privateKeyFromAsn1=function(e){var t,r,a,i,n,s,o={},c=[];if(l.validate(e,g,o,c))return t=p.util.createBuffer(o.privateKeyModulus).toHex(),r=p.util.createBuffer(o.privateKeyPublicExponent).toHex(),a=p.util.createBuffer(o.privateKeyPrivateExponent).toHex(),i=p.util.createBuffer(o.privateKeyPrime1).toHex(),n=p.util.createBuffer(o.privateKeyPrime2).toHex(),s=p.util.createBuffer(o.privateKeyExponent1).toHex(),e=p.util.createBuffer(o.privateKeyExponent2).toHex(),u=p.util.createBuffer(o.privateKeyCoefficient).toHex(),f.setRsaPrivateKey(new d(t,16),new d(r,16),new d(a,16),new d(i,16),new d(n,16),new d(s,16),new d(e,16),new d(u,16));var u=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw u.errors=c,u.type=p.err.unsupported,u},f.privateKeyToAsn1=f.privateKeyToRSAPrivateKey=function(e){return l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,l.integerToDer(0).getBytes()),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.n)),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.e)),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.d)),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.p)),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.q)),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.dP)),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.dQ)),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.qInv))])},f.rsa.publicKeyFromAsn1=function(e){var t={},r=[];if(!l.validate(e,i,t,r)){var a=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw a.errors=r,a}a=p.util.createBuffer(t.publicKeyModulus).toHex(),t=p.util.createBuffer(t.publicKeyExponent).toHex();return f.setRsaPublicKey(new d(a,16),new d(t,16))},f.publicKeyToRSAPublicKey=function(e){return l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.n)),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,t(e.e))])}}(),function(){function l(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"kcdsa")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var y,f=dreamsecurity;void 0===y&&(y=f.jsbn.BigInteger);var h=f.asn1;f.pki=f.pki||{},f.pki.kcdsa=f.kcdsa=f.kcdsa||{};var d=f.pki,m=[6,4,2,4,2,4,6,2],n={name:"KCDSAPrivateKey.exponent",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"privateKeyExponent"},s={name:"KCDSAPublicKey.public",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"publicKey"},C={name:"KCDSASignature",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,value:[{name:"KCDSASignature.R",tagClass:h.Class.UNIVERSAL,type:h.Type.BITSTRING,constructed:!1,capture:"r"},{name:"KCDSASignature.S",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"s"}]},a={name:"KCDSAParameters",tagClass:h.Class.UNIVERSAL,type:h.Type.SEQUENCE,constructed:!0,value:[{name:"P",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"p"},{name:"Q",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"q"},{name:"G",tagClass:h.Class.UNIVERSAL,type:h.Type.INTEGER,constructed:!1,capture:"g"}]};function E(e){e=e.toString(16);return"8"<=e[0]&&(e="00"+e),f.util.hexToBytes(e)}function E(e){e=e.toString(16);return"8"<=e[0]&&(e="00"+e),f.util.hexToBytes(e)}d.kcdsa.createKeyPairGenerationState=function(e,t,r){e=(e="string"==typeof e?parseInt(e,10):e)||2048;var a=(r=r||{}).prng||f.random,i={nextBytes:function(e){for(var t=a.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},r=r.algorithm||"PRIMEINC";if("PRIMEINC"!==r)throw new Error("Invalid key generation algorithm: "+r);return(e={algorithm:r,state:0,bits:e,rng:i,eInt:t||65537,e:new y(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(e.eInt),e},d.kcdsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new y(null);r.fromInt(30);function a(e,t){return e|t}for(var i,n,s,o=0,c=+new Date,u=0;null===e.keys&&(t<=0||u<t);)0===e.state?(i=(s=null===e.p?e.pBits:e.qBits)-1,0===e.pqState?(e.num=new y(s,e.rng),e.num.testBit(i)||e.num.bitwiseTo(y.ONE.shiftLeft(i),a,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),o=0,++e.pqState):1===e.pqState?e.num.bitLength()>s?e.pqState=0:e.num.isProbablePrime((s=e.num.bitLength())<=100?27:s<=150?18:s<=200?15:s<=250?12:s<=300?9:s<=350?8:s<=400?7:s<=500?6:s<=600?5:s<=800?4:s<=1250?3:2)?++e.pqState:e.num.dAddOffset(m[o++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(y.ONE).gcd(e.e).compareTo(y.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)):1===e.state?(e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state):2===e.state?(e.p1=e.p.subtract(y.ONE),e.q1=e.q.subtract(y.ONE),e.phi=e.p1.multiply(e.q1),++e.state):3===e.state?0===e.phi.gcd(e.e).compareTo(y.ONE)?++e.state:(e.p=null,e.q=null,e.state=0):4===e.state?(e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0)):5===e.state&&(n=e.e.modInverse(e.phi),e.keys={privateKey:d.kcdsa.setPrivateKey(e.n,e.e,n,e.p,e.q,n.mod(e.p1),n.mod(e.q1),e.q.modInverse(e.p)),publicKey:d.kcdsa.setPublicKey(e.n,e.e)}),u+=(n=+new Date)-c,c=n;return null!==e.keys},d.kcdsa.generateKeyPair=function(e,t,r,a){1===arguments.length?"object"==typeof e?(r=e,e=void 0):"function"==typeof e&&(a=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof t?(a=t,t=void 0):"number"!=typeof t&&(r=t,t=void 0):(r=e,a=t,t=e=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof r&&(a=r,r=void 0):(a=r,r=t,t=void 0)),r=r||{},void 0===e&&(e=r.bits||2048),void 0===t&&(t=r.e||65537);var i=d.kcdsa.createKeyPairGenerationState(e,t,r);if(!a)return d.kcdsa.stepKeyPairGenerationState(i,0),i.keys;!function(a,e,i){"function"==typeof e&&(i=e,e={});var r={algorithm:{name:(e=e||{}).algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(r.prng=e.prng);function n(){s(a.pBits,function(e,t){return e?i(e):(a.p=t,null!==a.q?o(e,a.q):void s(a.qBits,o))})}function s(e,t){f.prime.generateProbablePrime(e,r,t)}function o(e,t){if(e)return i(e);if(a.q=t,a.p.compareTo(a.q)<0&&(r=a.p,a.p=a.q,a.q=r),0!==a.p.subtract(y.ONE).gcd(a.e).compareTo(y.ONE))return a.p=null,void n();if(0!==a.q.subtract(y.ONE).gcd(a.e).compareTo(y.ONE))return a.q=null,void s(a.qBits,o);if(a.p1=a.p.subtract(y.ONE),a.q1=a.q.subtract(y.ONE),a.phi=a.p1.multiply(a.q1),0!==a.phi.gcd(a.e).compareTo(y.ONE))return a.p=a.q=null,void n();if(a.n=a.p.multiply(a.q),a.n.bitLength()!==a.bits)return a.q=null,void s(a.qBits,o);var r=a.e.modInverse(a.phi);a.keys={privateKey:d.kcdsa.setPrivateKey(a.n,a.e,r,a.p,a.q,r.mod(a.p1),r.mod(a.q1),a.q.modInverse(a.p)),publicKey:d.kcdsa.setPublicKey(a.n,a.e)},i(null,a.keys)}n()}(i,r,a)},d.setKcdsaPublicKey=d.kcdsa.setPublicKey=function(e,t,r,a){var p={p:e,q:t,g:r,y:a,verify:function(e,t,r,a){l();var n=(n=f.util.createBuffer(E(p.y)).toHex()).substr(n.length-128,128);n=f.util.hexToBytes(n);var s=f.md.algorithms[t].create();s.update(n),s.update(e);n=h.fromDer(r),e={},r=[];if(!h.validate(n,C,e,r)){var o=new Error("Cannot read KCDSA Signature. ");throw o.errors=r,o}var o=f.util.createBuffer(e.r).toHex(),e=f.util.createBuffer(e.s).toHex(),o=new y(o,16),e=new y(e,16),s=s.digest(),s=new y(s.toHex(),16),s=(s=o.xor(s)).mod(p.q),c=p.y.modPow(e,p.p),s=p.g.modPow(s,p.p),s=c.multiply(s).mod(p.p),u=p.p.toByteArray().length;if(u%128==1&&--u,(c=f.util.createBuffer(E(s)).toHex()).length>2*u)c=c.substr(c.length-2*u,2*u);else if(c.length<2*u){var d="";for(i=0;i<2*u-c.length;i++)d+="0";c=d+c}c=f.util.hexToBytes(c);t=f.md.algorithms[t].create();t.update(c);t=t.digest();return o.equals(new y(t.toHex(),16))}};return p},d.setKcdsaPrivateKey=d.kcdsa.setPrivateKey=function(e,t,r,a,n){var c={p:e,q:t,g:r,x:a,y:n,sign:function(e,t,r){l();var a=(a=f.util.createBuffer(E(r)).toHex()).substr(a.length-128,128);a=f.util.hexToBytes(a);r=f.md.algorithms[t].create();r.update(a),r.update(e);var a=f.random.getBytesSync(r.digestLength),e=(e=new y(f.util.createBuffer(a).toHex(),16)).mod(c.q),a=c.g.modPow(e,c.p),n=c.p.toByteArray().length;if(n%128==1&&--n,(o=f.util.createBuffer(E(a)).toHex()).length>2*n)o=o.substr(o.length-2*n,2*n);else if(o.length<2*n){var s="";for(i=0;i<2*n-o.length;i++)s+="0";o=s+o}var o=f.util.hexToBytes(o),a=f.md.algorithms[t].create();a.update(o);t=a.digest(),a=new y(t.toHex(),16),r=r.digest(),r=new y(r.toHex(),16),r=(r=a.xor(r)).mod(c.q),e=e.subtract(r);0!=e.s&&e.add(c.q);r=(r=c.x.multiply(e)).mod(c.q),e=h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[]),t=h.create(h.Class.UNIVERSAL,h.Type.BITSTRING,!1,String.fromCharCode(0)+t.getBytes()),r=h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,E(r));return e.value.push(t),e.value.push(r),h.toDer(e).getBytes()}};return c},d.kcdsa.domainParamFromAsn1=function(e){var t={},r=[];if(h.validate(e,a,t,r))return p=f.util.createBuffer(t.p).toHex(),q=f.util.createBuffer(t.q).toHex(),g=f.util.createBuffer(t.g).toHex(),{p:new y(p,16),q:new y(q,16),g:new y(g,16)};t=new Error("Cannot read kcdsaParam.");throw t.errors=r,t.type=f.err.process,t},d.kcdsa.privateKeyFromAsn1=function(e,t){var r={},a=[];if(!h.validate(e,n,r,a)){e=new Error("Cannot read kcdsaPrivateKey.");throw e.errors=a,e.type=f.err.process,e}r=f.util.createBuffer(r.privateKeyExponent).toHex(),t=d.kcdsa.domainParamFromAsn1(t);return d.setKcdsaPrivateKey(t.p,t.q,t.g,new y(r,16))},d.privateKeyToKCDSAPrivateKey=function(e){return h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,E(e.x))},d.toKCDSAParam=function(e){return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,E(e.p)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,E(e.q)),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,E(e.g))])},d.kcdsa.publicKeyFromAsn1=function(e,t){var r={},a=[];if(!h.validate(e,s,r,a)){e=new Error("Cannot read kcdsaPublicKey.");throw e.errors=a,e.type=f.err.process,e}r=f.util.createBuffer(r.publicKey).toHex(),t=d.kcdsa.domainParamFromAsn1(t);return d.setKcdsaPublicKey(t.p,t.q,t.g,new y(r,16))},d.publicKeyToKCDSAPublicKey=function(e){return h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,E(e.y))}}(),function(){function f(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"ecc")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var v,a,h=dreamsecurity;void 0===v&&(v=h.jsbn.BigInteger),void 0===a&&(a=h.jsbn.Barrett);var g=h.asn1;h.pki=h.pki||{},h.pki.ecc=h.ecc=h.ecc||{};var n=h.pki;function t(e,t){this.x=t,this.q=e}function l(e,t,r,a){this.curve=e,this.x=t,this.y=r,this.z=null==a?v.ONE:a,this.zinv=null}function y(e,t,r,a,i,n){var s,o,c=a.subtract(t).mod(n.curve.q);return c=c.square().mod(n.curve.q),t=t.multiply(c).mod(n.curve.q),a=a.multiply(c).mod(n.curve.q),c=i.add(r),i=i.subtract(r).mod(n.curve.q),s=a.subtract(t).mod(n.curve.q),r=r.multiply(s).mod(n.curve.q),s=a.add(t),a=(a=i.square().mod(n.curve.q)).subtract(s).mod(n.curve.q),o=t.subtract(a).mod(n.curve.q),i=(i=i.multiply(o).mod(n.curve.q)).subtract(r).mod(n.curve.q),s=(s=(s=(o=(o=c.square().mod(n.curve.q)).subtract(s).mod(n.curve.q)).subtract(t).mod(n.curve.q)).multiply(c).mod(n.curve.q)).subtract(r).mod(n.curve.q),1==e?{Rx1:o,Ry1:s,Rx0:a,Ry0:i}:{Rx0:o,Ry0:s,Rx1:a,Ry1:i}}function m(e,t,r,a,i,n){var s=a.subtract(t).mod(n.curve.q);return s=s.square().mod(n.curve.q),t=t.multiply(s).mod(n.curve.q),a=a.multiply(s).mod(n.curve.q),s=(s=(s=(i=i.subtract(r).mod(n.curve.q)).square().mod(n.curve.q)).subtract(t).mod(n.curve.q)).subtract(a).mod(n.curve.q),a=a.subtract(t).mod(n.curve.q),r=r.multiply(a).mod(n.curve.q),a=t.subtract(s).mod(n.curve.q),i=(i=i.multiply(a).mod(n.curve.q)).subtract(r).mod(n.curve.q),1==e?{Rx0:t,Ry0:r,Rx1:s,Ry1:i}:{Rx1:t,Ry1:r,Rx0:s,Ry0:i}}function S(e,t,r){this.q=e,this.a=this.fromBigInteger(t),this.b=this.fromBigInteger(r),this.infinity=new l(this,null,null),this.reducer=new a(this.q)}function I(e,t,r,a){this.curve=e,this.g=t,this.n=r,this.h=a}function T(e){return new v(e,16)}function C(e){return"secp256r1"==e?(h=T("FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF"),g=T("FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC"),m=T("5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B"),C=T("FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551"),E=v.ONE,m=(g=new S(h,g,m)).decodePointHex("046B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C2964FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5"),new I(g,m,C,E)):"secp224r1"==e?(E=T("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001"),p=T("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE"),l=T("B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4"),y=T("FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D"),f=v.ONE,l=(p=new S(E,p,l)).decodePointHex("04B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34"),new I(p,l,y,f)):"secp192r1"==e?(p=T("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF"),l=T("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC"),y=T("64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1"),f=T("FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831"),d=v.ONE,y=(l=new S(p,l,y)).decodePointHex("04188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF101207192B95FFC8DA78631011ED6B24CDD573F977A11E794811"),new I(l,y,f,d)):"secp192k1"==e?(d=T("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37"),s=v.ZERO,o=T("3"),c=T("FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D"),u=v.ONE,o=(s=new S(d,s,o)).decodePointHex("04DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D"),new I(s,o,c,u)):"secp160r1"==e?(s=T("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF"),o=T("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC"),c=T("1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45"),u=T("0100000000000000000001F4C8F927AED3CA752257"),n=v.ONE,c=(o=new S(s,o,c)).decodePointHex("044A96B5688EF573284664698968C38BB913CBFC8223A628553168947D59DCC912042351377AC5FB32"),new I(o,c,u,n)):"secp160k1"==e?(n=T("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73"),t=v.ZERO,r=T("7"),a=T("0100000000000000000001B8FA16DFAB9ACA16B6B3"),i=v.ONE,r=(t=new S(n,t,r)).decodePointHex("043B4C382CE37AA192A4019E763036F4F5DD4D7EBB938CF935318FDCED6BC28286531733C3F03C4FEE"),new I(t,r,a,i)):"secp128r1"==e?(t=T("FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF"),r=T("FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC"),a=T("E87579C11079F43DD824993C2CEE5ED3"),i=T("FFFFFFFE0000000075A30D1B9038A115"),e=v.ONE,a=(r=new S(t,r,a)).decodePointHex("04161FF7528B899B2D0C28607CA52C5B86CF5AC8395BAFEB13C02DA292DDED7A83"),new I(r,a,i,e)):null;var t,r,a,i,n,s,o,c,u,d,p,l,y,f,h,g,m,C,E}t.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},t.prototype.toBigInteger=function(){return this.x},t.prototype.negate=function(){return new t(this.q,this.x.negate().mod(this.q))},t.prototype.add=function(e){return new t(this.q,this.x.add(e.toBigInteger()).mod(this.q))},t.prototype.subtract=function(e){return new t(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},t.prototype.multiply=function(e){return new t(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},t.prototype.square=function(){return new t(this.q,this.x.square().mod(this.q))},t.prototype.divide=function(e){return new t(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},l.prototype.getX=function(){null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q));var e=this.x.toBigInteger().multiply(this.zinv);return this.curve.reduce(e),this.curve.fromBigInteger(e)},l.prototype.getY=function(){null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q));var e=this.y.toBigInteger().multiply(this.zinv);return this.curve.reduce(e),this.curve.fromBigInteger(e)},l.prototype.equals=function(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(v.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(v.ZERO))},l.prototype.isInfinity=function(){return null==this.x&&null==this.y||this.z.equals(v.ZERO)&&!this.y.toBigInteger().equals(v.ZERO)},l.prototype.negate=function(){return new l(this.curve,this.x,this.y.negate(),this.z)},l.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),r=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(v.ZERO.equals(r))return v.ZERO.equals(t)?this.twice():this.curve.getInfinity();var a=new v("3"),i=this.x.toBigInteger(),n=this.y.toBigInteger(),s=(e.x.toBigInteger(),e.y.toBigInteger(),r.square()),o=s.multiply(r),i=i.multiply(s),r=(s=t.square().multiply(this.z)).subtract(i.shiftLeft(1)).multiply(e.z).subtract(o).multiply(r).mod(this.curve.q),t=i.multiply(a).multiply(t).subtract(n.multiply(o)).subtract(s.multiply(t)).multiply(e.z).add(t.multiply(o)).mod(this.curve.q),e=o.multiply(this.z).multiply(e.z).mod(this.curve.q);return new l(this.curve,this.curve.fromBigInteger(r),this.curve.fromBigInteger(t),e)},l.prototype.twice=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=new v("3"),t=this.x.toBigInteger(),r=this.y.toBigInteger(),a=(n=r.multiply(this.z)).multiply(r).mod(this.curve.q),i=this.curve.a.toBigInteger(),r=t.square().multiply(e),i=(r=(r=!v.ZERO.equals(i)?r.add(this.z.square().multiply(i)):r).mod(this.curve.q)).square().subtract(t.shiftLeft(3).multiply(a)).shiftLeft(1).multiply(n).mod(this.curve.q),r=r.multiply(e).multiply(t).subtract(a.shiftLeft(1)).shiftLeft(2).multiply(a).subtract(r.square().multiply(r)).mod(this.curve.q),n=n.square().multiply(n).shiftLeft(3).mod(this.curve.q);return new l(this.curve,this.curve.fromBigInteger(i),this.curve.fromBigInteger(r),n)},l.prototype.multiply=function(e){var t,r,a,n,s,o,c,u,d=e.bitLength(),p=this;for(s=(a=p).getX().toBigInteger(),o=a.getY().toBigInteger(),c=s.square().mod(a.curve.q),u=c.add(c),c=(c=c.add(u)).add(a.curve.a.x),n=(n=(u=(u=o.square().mod(a.curve.q)).add(u)).add(u)).multiply(s).mod(a.curve.q),o=(o=(o=c.square().mod(a.curve.q)).subtract(n).mod(a.curve.q)).subtract(n).mod(a.curve.q),s=(s=n.subtract(o).mod(a.curve.q)).multiply(c).mod(a.curve.q),c=(c=u.square().mod(a.curve.q)).add(c),t={Rx1:o,Ry1:s=s.subtract(c).mod(a.curve.q),Rx0:n,Ry0:c},i=d-2;0<i;i--)t=e.testBit(i)?m(1,(t=y(1,t.Rx1,t.Ry1,t.Rx0,t.Ry0,p)).Rx0,t.Ry0,t.Rx1,t.Ry1,p):m(0,(t=y(0,t.Rx0,t.Ry0,t.Rx1,t.Ry1,p)).Rx1,t.Ry1,t.Rx0,t.Ry0,p);return t=e.testBit(0)?(r=(r=(r=(r=(r=(r=(t=y(1,t.Rx1,t.Ry1,t.Rx0,t.Ry0,p)).Rx1.subtract(t.Rx0).mod(this.curve.q)).multiply(t.Ry1).mod(this.curve.q)).multiply(p.x.toBigInteger()).mod(this.curve.q)).modInverse(this.curve.q)).multiply(p.y.toBigInteger()).mod(this.curve.q)).multiply(t.Rx1).mod(this.curve.q),m(1,t.Rx0,t.Ry0,t.Rx1,t.Ry1,p)):(r=(r=(r=(r=(r=(r=(t=y(0,t.Rx0,t.Ry0,t.Rx1,t.Ry1,p)).Rx1.subtract(t.Rx0).mod(this.curve.q)).multiply(t.Ry0).mod(this.curve.q)).multiply(p.x.toBigInteger()).mod(this.curve.q)).modInverse(this.curve.q)).multiply(p.y.toBigInteger()).mod(this.curve.q)).multiply(t.Rx0).mod(this.curve.q),m(0,t.Rx1,t.Ry1,t.Rx0,t.Ry0,p)),c=r.square().mod(this.curve.q),d=t.Rx0.multiply(c).mod(this.curve.q),c=c.multiply(r).mod(this.curve.q),c=t.Ry0.multiply(c).mod(this.curve.q),new l(this.curve,this.curve.fromBigInteger(d),this.curve.fromBigInteger(c),this.z)},l.prototype.multiplyTwo=function(e,t,r){for(var a=e.bitLength()>r.bitLength()?e.bitLength()-1:r.bitLength()-1,i=this.curve.getInfinity(),n=this.add(t);0<=a;)i=i.twice(),e.testBit(a)?i=r.testBit(a)?i.add(n):i.add(this):r.testBit(a)&&(i=i.add(t)),--a;return i},l.prototype.toHex=function(){if(this.isInfinity())return"00";var e=this.getX().toBigInteger().toString(16),t=this.getY().toBigInteger().toString(16),r=this.curve.getQ().toString(16).length;for(r%2!=0&&r++;e.length<r;)e="0"+e;for(;t.length<r;)t="0"+t;return"04"+e+t},S.prototype.getQ=function(){return this.q},S.prototype.getA=function(){return this.a},S.prototype.getB=function(){return this.b},S.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},S.prototype.getInfinity=function(){return this.infinity},S.prototype.fromBigInteger=function(e){return new t(this.q,e)},S.prototype.reduce=function(e){this.reducer.reduce(e)},S.prototype.decodePointHex=function(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var t=(e.length-2)/2,r=e.substr(2,t),t=e.substr(2+t,t);return new l(this,this.fromBigInteger(new v(r,16)),this.fromBigInteger(new v(t,16)));default:return null}},I.prototype.getCurve=function(){return this.curve},I.prototype.getG=function(){return this.g},I.prototype.getN=function(){return this.n};var s={name:"ECPrivateKey",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"ECPrivateKey.version",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!(I.prototype.getH=function(){return this.h}),capture:"privateKeyVersion"},{name:"ECPrivateKey.privateKey",tagClass:g.Class.UNIVERSAL,type:g.Type.OCTETSTRING,constructed:!1,capture:"privateKey"},{name:"ECPrivateKey.parameters",tagClass:g.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"ECPrivateKey.parameters.namedCurve",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"curveName"}]},{name:"ECPrivateKey.publicKey",tagClass:g.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"ECPrivateKey.publicKey",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,capture:"publicKey"}]}]},d={name:"ECDSASignature",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"ECDSASignature.R",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!1,capture:"r"},{name:"ECDSASignature.S",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!1,capture:"s"}]},o={name:"ECParameters",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"namedCurve"};function E(){}function c(e){var t=new E,r=e.getN(),a=r.subtract(v.ONE),a=new v(r.bitLength(),t).mod(a).add(v.ONE);e.getCurve();return{q:a,Q:e.getG().multiply(a)}}function p(e,t,r){var a=C(r.curveName.toLowerCase()),i=null;if("hmacsha256"!==r.macAlgName.toLowerCase())throw new Error("The"+r.macAlgName+" algorithm is not supported.");var i=h.md.sha256.create(),n=c(a),s=n.Q.toHex();sharedKey=t.multiply(n.q);a=function(e,t){e.start();for(var r=e.digestLength,a=Math.ceil(48/r),i=0,n="",i=0;i<2;i++)n+=String.fromCharCode(384>>>8*(1-i)&255);var s=h.hmac.create();s.start(e,t);var o="";for(i=0;i<a;i++)s.start(null,null),s.update(h.util.int32ToBytes(i+1)),s.update(String.fromCharCode(0)),s.update(n),o+=i!=a-1?s.digest().getBytes():s.digest().getBytes(48-r*i);return o}(i,h.util.hexToBytes(sharedKey.getX().toBigInteger().toString(16))),t=a.slice(0,16),n=h.util.createBuffer(t),t=a.slice(16,48),a=h.util.createBuffer(t);r.out_cek=n.data;t=null;if("aria128-ctr"===r.symAlgName.toLowerCase())t=h.aria.createEncryptionCipher(n,"CTR");else{if("aria128-cbc"!==r.symAlgName.toLowerCase())throw new Error("The "+r.symAlgName+" algorithm is not supported.");t=h.aria.createEncryptionCipher(n,"CBC")}if(t.start(h.util.hexToBytes("00000000000000000000000000000000")),t.update(h.util.createBuffer(e)),!t.finish())return null;n=t.output,e=n.toHex();i.start();t=h.hmac.create();t.start(i,a),t.update(n.getBytes());t=t.digest().toHex();return h.util.hexToBytes(s+e+t)}function A(e){e=e.toString(16);return"8"<=e[0]&&(e="00"+e),h.util.hexToBytes(e)}n.ecc.ecParamFromAsn1=function(e){var t={},r=[];if(g.validate(e,o,t,r))return g.derToOid(t.namedCurve)===n.oids.secp256r1?"secp256r1":"";t=new Error("Cannot read ecParam.");throw t.errors=r,t.type=h.err.process,t},n.ecc.publicKeyFromAsn1=function(e,t){65<e.length&&(e=e.substring(2,e.length));e=h.util.createBuffer(e).toHex(),t=n.ecc.ecParamFromAsn1(t),e=C(t).getCurve().decodePointHex(e);return n.setEcPublicKey(t,e)},n.publicKeyToECPublicKey=function(e){return g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,h.util.hexToBytes(e.Q.toHex()))},n.toECParam=function(e){return g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(n.oids[e.curveName]).getBytes())},n.privateKeyToECPrivateKey=function(e){return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(1).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,h.util.hexToBytes(e.q.toString(16)))])},n.ecc.privateKeyFromAsn1=function(e,t){var r={},a=[];if(!g.validate(e,s,r,a)){e=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw e.errors=a,e.type=h.err.unsupported,e}r=h.util.createBuffer(r.privateKey).toHex(),t=n.ecc.ecParamFromAsn1(t),C(t);return n.setEcPrivateKey(t,r)},E.prototype.nextBytes=function(e){for(var t=0,r=h.random.getBytes(e.length),t=0;t<e.length;++t)e[t]=r.charCodeAt(t)},n.ecc.generateKeyPair=function(e){f();var t=c(C(e.curve));return{privateKey:n.setEcPrivateKey(e.curve,t.q),publicKey:n.setEcPublicKey(e.curve,t.Q)}},n.setEcPrivateKey=n.ecc.setPrivateKey=function(e,t){var y={curveName:e,q:t,sign:function(e,t){f();var r=C(y.curveName.toLowerCase()),a=h.md.algorithms[t].create();a.update(e);for(var i=a.digest(),n=new E,s=r.getN(),o=(s.subtract(v.ONE),r.getCurve(),r.getG());;){for(;;){var c=new v(s.bitLength(),n);if(!(c=c.mod(s)).equals(v.ZERO)){var u=(l=o.multiply(c)).getX().toBigInteger().mod(s);if(!u.equals(v.ZERO))break}}var d=new v(i.toHex(),16);s.bitLength()<8*a.digestLength&&(d=d.shiftRight(8*a.digestLength-s.bitLength())),c=c.modInverse(s);var d=u.multiply(y.q).add(d),p=c.multiply(d);if(!(p=p.mod(s)).equals(v.ZERO))break}var e=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]),l=g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,A(u)),r=g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,A(p));return e.value.push(l),e.value.push(r),g.toDer(e).getBytes()},decrypt:function(e,t,r){}};return y},n.setEcPublicKey=n.ecc.setPublicKey=function(e,c){var u={curveName:e,Q:c,verify:function(e,t,r){f();var a=C(u.curveName.toLowerCase()),i=h.md.algorithms[t].create();i.update(e);var n=i.digest(),s=a.getN(),t=(s.subtract(v.ONE),a.getCurve(),a.getG()),e=g.fromDer(r),a={},r=[];if(!g.validate(e,d,a,r))throw(o=new Error("Cannot read ECDSA Signature. ")).errors=r,o;e=h.util.createBuffer(a.r).toHex(),a=h.util.createBuffer(a.s).toHex(),e=new v(e,16),a=new v(a,16);if(e.equals(v.ZERO)||a.equals(v.ZERO)||0<e.compareTo(s)||0<a.compareTo(s))throw(o=new Error("Cannot read ECDSA Signature. ")).errors=r,o;n=new v(n.toHex(),16);s.bitLength()<8*i.digestLength&&(n=n.shiftRight(8*i.digestLength-s.bitLength()));var o,a=a.modInverse(s),n=a.multiply(n).mod(s),a=a.multiply(e).mod(s),n=t.multiply(n),a=c.multiply(a),a=n.add(a);if(a.isInfinity())throw(o=new Error("Cannot read ECDSA Signature. ")).errors=r,o;return a.getX().toBigInteger().mod(s).equals(e)},encrypt:function(e,t,r){if("ECIES"==(t="string"==typeof t?t.toUpperCase():t))return p(e,c,r);throw new Error("The"+t.macAlgName+" scheme is not supported.")}};return u}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var e=dreamsecurity;e.mgf=e.mgf||{},e.mgf.mgf1=e.mgf1}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var o=dreamsecurity;o.mgf=o.mgf||{},(o.mgf.mgf1=o.mgf1=o.mgf1||{}).create=function(s){return{generate:function(e,t){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"mgf1")}();for(var r=new o.util.ByteBuffer,a=Math.ceil(t/s.digestLength),i=0;i<a;i++){var n=new o.util.ByteBuffer;n.putInt32(i),s.start(),s.update(e+n.getBytes()),r.putBuffer(s.digest())}return r.truncate(r.length()-t),r.getBytes()},name:"mgf1",md:s.algorithm}}}(),function(){function g(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pss")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var m=dreamsecurity;(m.pss=m.pss||{}).create=function(e){g();var d,p=(e=3===arguments.length?{md:arguments[0],mgf:arguments[1],saltLength:arguments[2]}:e).md,l=e.mgf,y=p.digestLength,f=e.salt||null;if("string"==typeof f&&(f=m.util.createBuffer(f)),"saltLength"in e)d=e.saltLength;else{if(null===f)throw new Error("Salt length not specified or specific salt not given.");d=f.length()}if(null!==f&&f.length()!==d)throw new Error("Given salt length does not match length of given salt.");var h=e.prng||m.random,t={};return t.md=p.algorithm,t.mgf=l.name+"-"+l.md,t.saltLength=d,t.encode=function(e,t){g();var r=t-1,a=Math.ceil(r/8),i=e.digest().getBytes();if(a<y+d+2)throw new Error("Message is too long to encrypt.");t=null===f?h.getBytesSync(d):f.bytes(),e=new m.util.ByteBuffer;e.fillWithByte(0,8),e.putBytes(i),e.putBytes(t),p.start(),p.update(e.getBytes());i=p.digest().getBytes(),e=new m.util.ByteBuffer;e.fillWithByte(0,a-d-y-2),e.putByte(1),e.putBytes(t);for(var n=e.getBytes(),s=a-y-1,o=l.generate(i,s),c="",u=0;u<s;u++)c+=String.fromCharCode(n.charCodeAt(u)^o.charCodeAt(u));r=65280>>8*a-r&255;return(c=String.fromCharCode(c.charCodeAt(0)&~r)+c.substr(1))+i+String.fromCharCode(188)},t.verify=function(e,t,r){g();var a=r-1,r=Math.ceil(a/8);if(t=t.substr(t.length-r,r),r<y+d+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==t.charCodeAt(r-1))throw new Error("Encoded message does not end in 0xBC.");var i=r-y-1,n=t.substr(0,i),t=t.substr(i,y),a=65280>>8*r-a&255;if(0!=(n.charCodeAt(0)&a))throw new Error("Bits beyond keysize not zero as expected.");for(var s=l.generate(t,i),o="",c=0;c<i;c++)o+=String.fromCharCode(n.charCodeAt(c)^s.charCodeAt(c));var o=String.fromCharCode(o.charCodeAt(0)&~a)+o.substr(1),u=r-y-d-2;for(c=0;c<u;c++)if(0!==o.charCodeAt(c))throw new Error("Leftmost octets not zero as expected");if(1!==o.charCodeAt(u))throw new Error("Inconsistent PSS signature, 0x01 marker not found");a=o.substr(o.length-d,d),r=new m.util.ByteBuffer;return r.fillWithByte(0,8),r.putBytes(e),r.putBytes(a),p.start(),p.update(r.getBytes()),t===p.digest().getBytes()},t}}(),function(){function E(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pkcs1")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var v=dreamsecurity,e=v.pkcs1=v.pkcs1||{},t=v.asn1;function S(e,t,r){r=r||v.md.sha1.create();for(var a="",i=Math.ceil(t/r.digestLength),n=0;n<i;++n){var s=String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,255&n);r.start(),r.update(e+s),a+=r.digest().getBytes()}return a.substring(0,t)}(v.pkcs1.asn1=v.pkcs1.asn1||{}).rsaoaepParamValidator={name:"RSAES_OAEP_params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAES_OAEP_params.ctx0",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"RSAES_OAEP_params.hashAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"hashAlgorithm"}]},{name:"RSAES_OAEP_params.ctx1",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"RSAES_OAEP_params.maskGenAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAES_OAEP_params.maskGenAlgorithm.mgf",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"mgf"},{name:"RSAES_OAEP_params.maskGenAlgorithm.param",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"mgfHashAlg"}]}]}]},e.encode_rsa_oaep=function(e,t,r){var a,i;E(),"string"==typeof r?(c=r,a=arguments[3]||void 0,i=arguments[4]||void 0):r&&(c=r.label||void 0,a=r.seed||void 0,i=r.md||void 0,r.mgf1&&r.mgf1.md&&(n=r.mgf1.md)),i?i.start():i=v.md.sha1.create();var n=n||i,s=Math.ceil(e.n.bitLength()/8),o=s-2*i.digestLength-2;if(t.length>o)throw(l=new Error("RSAES-OAEP input message length is too long.")).length=t.length,l.maxLength=o,l;i.update(c=c||"","raw");for(var c=i.digest(),u="",d=o-t.length,p=0;p<d;p++)u+="\0";var l,c=c.getBytes()+u+v.util.hexToBytes("01")+t;if(a){if(a.length!==i.digestLength)throw(l=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=a.length,l.digestLength=i.digestLength,l}else a=v.random.getBytes(i.digestLength);s=S(a,s-i.digestLength-1,n),c=v.util.xorBytes(c,s,c.length),n=S(c,i.digestLength,n);return"\0"+v.util.xorBytes(a,n,a.length)+c},e.decode_rsa_oaep=function(e,t,r){var a;E(),"string"==typeof r?(u=r,a=arguments[3]||void 0):r&&(u=r.label||void 0,a=r.md||void 0,r.mgf1&&r.mgf1.md&&(d=r.mgf1.md));var i=Math.ceil(e.n.bitLength()/8);if(t.length!==i)throw(y=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,y.expectedLength=i,y;if(void 0===a?a=v.md.sha1.create():a.start(),d=d||a,i<2*a.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");a.update(u=u||"","raw");for(var n=a.digest().getBytes(),s=t.charAt(0),o=t.substring(1,a.digestLength+1),c=t.substring(1+a.digestLength),u=S(c,a.digestLength,d),d=S(v.util.xorBytes(o,u,o.length),i-a.digestLength-1,d),p=v.util.xorBytes(c,d,c.length),l=p.substring(0,a.digestLength),y="\0"!==s,f=0;f<a.digestLength;++f)y|=n.charAt(f)!==l.charAt(f);for(var h=1,g=a.digestLength,m=a.digestLength;m<p.length;m++){var C=p.charCodeAt(m);y|=C&(h?65534:0),g+=h&=1&C^1}if(y||1!==p.charCodeAt(g))throw new Error("Invalid RSAES-OAEP padding.");return p.substring(g+1)}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var s=dreamsecurity;function e(e,t){s.cipher.registerAlgorithm(e,function(){return new s.aes.Algorithm(e,t)})}s.aes=s.aes||{},s.aes.startEncrypting=function(e,t,r,a){a=n({key:e,output:r,decrypt:!1,mode:a});return a.start(t),a},s.aes.createEncryptionCipher=function(e,t){return n({key:e,output:null,decrypt:!1,mode:t})},s.aes.startDecrypting=function(e,t,r,a){a=n({key:e,output:r,decrypt:!0,mode:a});return a.start(t),a},s.aes.createDecryptionCipher=function(e,t){return n({key:e,output:null,decrypt:!0,mode:t})},s.aes.Algorithm=function(e,t){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"aes")}(),p||a();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return i(r._w,e,t,!1)},decrypt:function(e,t){return i(r._w,e,t,!0)}}}),r._init=!1},s.aes.Algorithm.prototype.initialize=function(e){if(!this._init){if("string"==typeof(r=e.key)){if(16!==r.length&&24!==r.length&&32!==r.length)throw new Error("The "+r.length+" bytes key length is not valid for aes algorithm.");r=s.util.createBuffer(r)}else if(s.util.isArray(r)){if(16!==r.length&&24!==r.length&&32!==r.length)throw new Error("The "+r.length+" bytes key length is not valid for aes algorithm.");for(var t=r,r=s.util.createBuffer(),a=0;a<t.length;++a)r.putByte(t[a])}if(!s.util.isArray(r)){t=r,r=[];var i=t.length();if(16===i||24===i||32===i){i>>>=2;for(a=0;a<i;++a)r.push(t.getInt32())}}if(!s.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var n=this.mode.name,n=-1!==s.util.arrayIndexOf(["CFB","OFB","CTR","GCM"],n);this._w=o(r,e.decrypt&&!n),this._init=!0}},s.aes._expandKey=function(e,t){return p||a(),o(e,t)},s.aes._updateBlock=i,e("AES-CBC",s.cipher.modes.cbc),e("AES-CFB",s.cipher.modes.cfb),e("AES-OFB",s.cipher.modes.ofb),e("AES-CTR",s.cipher.modes.ctr),e("AES-GCM",s.cipher.modes.gcm);var E,v,g,S,I,p=!1,m=4;function a(){p=!0,g=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;E=new Array(256),v=new Array(256),S=new Array(4),I=new Array(4);for(t=0;t<4;++t)S[t]=new Array(256),I[t]=new Array(256);for(var r,a=0,i=0,t=0;t<256;++t){E[a]=r=(r=i^i<<1^i<<2^i<<3^i<<4)>>8^255&r^99,v[r]=a;for(var n,s,o,c=(o=e[r])<<24^r<<16^r<<8^r^o,u=((n=e[a])^(s=e[n])^(o=e[s]))<<24^(a^o)<<16^(a^s^o)<<8^a^n^o,d=0;d<4;++d)c=(S[d][a]=c)<<24|c>>>8,u=(I[d][r]=u)<<24|u>>>8;0===a?a=i=1:(a=n^e[e[e[n^o]]],i^=e[e[i]])}}function o(e,t){for(var r,a=e.slice(0),i=1,n=a.length,s=m*(n+6+1),o=n;o<s;++o)r=a[o-1],o%n==0?(r=E[r>>>16&255]<<24^E[r>>>8&255]<<16^E[255&r]<<8^E[r>>>24]^g[i]<<24,i++):6<n&&o%n==4&&(r=E[r>>>24]<<24^E[r>>>16&255]<<16^E[r>>>8&255]<<8^E[255&r]),a[o]=a[o-n]^r;if(t){for(var c,u=I[0],d=I[1],p=I[2],l=I[3],y=a.slice(0),o=0,f=(s=a.length)-m;o<s;o+=m,f-=m)if(0===o||o===s-m)y[o]=a[f],y[o+1]=a[f+3],y[o+2]=a[f+2],y[o+3]=a[f+1];else for(var h=0;h<m;++h)c=a[f+h],y[o+(3&-h)]=u[E[c>>>24]]^d[E[c>>>16&255]]^p[E[c>>>8&255]]^l[E[255&c]];a=y}return a}function i(e,t,r,a){for(var i,n,s,o,c,u,d,p=e.length/4-1,l=a?(i=I[0],n=I[1],s=I[2],o=I[3],v):(i=S[0],n=S[1],s=S[2],o=S[3],E),y=t[0]^e[0],f=t[a?3:1]^e[1],h=t[2]^e[2],g=t[a?1:3]^e[3],m=3,C=1;C<p;++C)c=i[y>>>24]^n[f>>>16&255]^s[h>>>8&255]^o[255&g]^e[++m],u=i[f>>>24]^n[h>>>16&255]^s[g>>>8&255]^o[255&y]^e[++m],d=i[h>>>24]^n[g>>>16&255]^s[y>>>8&255]^o[255&f]^e[++m],g=i[g>>>24]^n[y>>>16&255]^s[f>>>8&255]^o[255&h]^e[++m],y=c,f=u,h=d;r[0]=l[y>>>24]<<24^l[f>>>16&255]<<16^l[h>>>8&255]<<8^l[255&g]^e[++m],r[a?3:1]=l[f>>>24]<<24^l[h>>>16&255]<<16^l[g>>>8&255]<<8^l[255&y]^e[++m],r[2]=l[h>>>24]<<24^l[g>>>16&255]<<16^l[y>>>8&255]<<8^l[255&f]^e[++m],r[a?1:3]=l[g>>>24]<<24^l[y>>>16&255]<<16^l[f>>>8&255]<<8^l[255&h]^e[++m]}function n(e){var t="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),a=e.decrypt?s.cipher.createDecipher(t,e.key):s.cipher.createCipher(t,e.key),i=a.start;return a.start=function(e,t){var r=null;t instanceof s.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,i.call(a,t)},a}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var n=dreamsecurity;function e(e,t){n.cipher.registerAlgorithm(e,function(){return new n.seed.Algorithm(e,t)})}n.seed=n.seed||{},n.seed.startEncrypting=function(e,t,r,a){a=i({key:e,output:r,decrypt:!1,mode:a||(null===t?"ECB":"CBC")});return a.start(t),a},n.seed.createEncryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!1,mode:t})},n.seed.startDecrypting=function(e,t,r,a){a=i({key:e,output:r,decrypt:!0,mode:a||(null===t?"ECB":"CBC")});return a.start(t),a},n.seed.createDecryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!0,mode:t})},n.seed.Algorithm=function(e,t){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"seed")}();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return a(r._keys,e,t,!1)},decrypt:function(e,t){return a(r._keys,e,t,!0)}}}),r._init=!1},n.seed.Algorithm.prototype.initialize=function(e){if(!this._init){e=n.util.createBuffer(e.key);if(0===this.name.indexOf("SEED")&&16!==e.length())throw new Error("Invalid SEED key size: "+8*e.length());this._keys=function(e){var t,r=new Array(1),a=new Array(1),i=new Array(1),n=new Array(1),s=new Array(2),o=2,c=[];r[0]=e.getInt32(),a[0]=e.getInt32(),i[0]=e.getInt32(),n[0]=e.getInt32(),f||(r[0]=C(r[0]),a[0]=C(a[0]),i[0]=C(i[0]),n[0]=C(n[0]));return t=r[0]+i[0]-y[0],e=a[0]-n[0]+y[0],c[0]=u[255&t]^d[h(t)]^p[g(t)]^l[m(t)],c[1]=u[255&e]^d[h(e)]^p[g(e)]^l[m(e)],E(s,r,a,i,n,1),c[o++]=s[0],c[o++]=s[1],v(s,r,a,i,n,2),c[o++]=s[0],c[o++]=s[1],E(s,r,a,i,n,3),c[o++]=s[0],c[o++]=s[1],v(s,r,a,i,n,4),c[o++]=s[0],c[o++]=s[1],E(s,r,a,i,n,5),c[o++]=s[0],c[o++]=s[1],v(s,r,a,i,n,6),c[o++]=s[0],c[o++]=s[1],E(s,r,a,i,n,7),c[o++]=s[0],c[o++]=s[1],v(s,r,a,i,n,8),c[o++]=s[0],c[o++]=s[1],E(s,r,a,i,n,9),c[o++]=s[0],c[o++]=s[1],v(s,r,a,i,n,10),c[o++]=s[0],c[o++]=s[1],E(s,r,a,i,n,11),c[o++]=s[0],c[o++]=s[1],v(s,r,a,i,n,12),c[o++]=s[0],c[o++]=s[1],E(s,r,a,i,n,13),c[o++]=s[0],c[o++]=s[1],v(s,r,a,i,n,14),c[o++]=s[0],c[o++]=s[1],E(s,r,a,i,n,15),c[o++]=s[0],c[31]=s[1],c}(e),this._init=!0}},e("SEED-CBC",n.cipher.modes.cbc),e("SEED-ECB",n.cipher.modes.ecb);var u=[696885672,92635524,382128852,331600848,340021332,487395612,747413676,621093156,491606364,54739776,403181592,504238620,289493328,1020063996,181060296,591618912,671621160,71581764,536879136,495817116,549511392,583197408,147374280,386339604,629514660,261063564,50529024,994800504,999011256,318968592,314757840,785310444,809529456,210534540,1057960764,680042664,839004720,500027868,919007988,876900468,751624428,361075092,185271048,390550356,474763356,457921368,1032696252,16843008,604250148,470552604,860058480,411603096,268439568,214745292,851636976,432656856,738992172,667411428,843215472,58950528,462132120,297914832,109478532,164217288,541089888,272650320,595829664,734782440,218956044,914797236,512660124,256852812,931640244,441078360,113689284,944271480,646357668,302125584,797942700,365285844,557932896,63161280,881111220,21053760,306336336,1028485500,227377548,134742024,521081628,428446104,0,420024600,67371012,323179344,935850996,566354400,1036907004,910586484,789521196,654779172,813740208,193692552,235799052,730571688,578986656,776888940,327390096,223166796,692674920,1011642492,151585032,168428040,1066382268,802153452,868479984,96846276,126321540,335810580,1053750012,608460900,516870876,772678188,189481800,436867608,101057028,553722144,726360936,642146916,33686016,902164980,310547088,176849544,202113036,864269232,1045328508,281071824,977957496,122110788,377918100,633725412,637936164,8421504,764256684,533713884,562143648,805318704,923218740,781099692,906375732,352653588,570565152,940060728,885321972,663200676,88424772,206323788,25264512,701096424,75792516,394761108,889532724,197903304,248431308,1007431740,826372464,285282576,130532292,160006536,893743476,1003222008,449499864,952692984,344232084,424235352,42107520,80003268,1070593020,155795784,956903736,658989924,12632256,265274316,398971860,948482232,252642060,244220556,37896768,587408160,293704080,743202924,466342872,612671652,872689716,834793968,138952776,46318272,793731948,1024274748,755835180,4210752,1049539260,1041117756,1015853244,29475264,713728680,982168248,240009804,356864340,990589752,483184860,675831912,1062171516,478974108,415813848,172638792,373707348,927429492,545300640,768467436,105267780,897954228,722150184,625303908,986379e3,600040416,965325240,830583216,529503132,508449372,969535992,650568420,847426224,822161712,717939432,760045932,525292380,616882404,817950960,231588300,143163528,369496596,973746744,407392344,348442836,574775904,688464168,117900036,855847728,684253416,453710616,84214020,961114488,276861072,709517928,705307176,445289112],d=[943196208,3894986976,741149985,2753988258,3423588291,3693006546,2956166067,3090712752,2888798115,1612726368,1410680145,3288844227,1141130304,1815039843,1747667811,1478183763,3221472195,1612857954,808649523,3023406513,673777953,2686484640,3760374498,2754054051,3490956243,2417066385,269549841,67503618,471600144,3158084784,875955762,1208699715,3962556387,2282260608,1814842464,2821228704,337053459,3288646848,336987666,4097098992,3221406402,1141196097,3760308705,3558262482,1010765619,1010634033,2349764226,2551744656,673712160,1276005954,4097230578,1010699826,2753922465,4164536817,202181889,3693072339,3625502928,673909539,1680229986,2017086066,606537507,741281571,4029792753,1882342002,1073889858,3558130896,1073824065,3221274816,1882407795,1680295779,2888600736,2282457987,4097296371,2888666529,2147516544,471797523,3356150466,741084192,2821360290,875824176,3490890450,134941443,3962490594,3895052769,1545424209,2484372624,404228112,4164471024,1410811731,2888732322,134744064,3288712641,269681427,3423456705,2215020162,3090778545,4232040435,2084392305,3221340609,808517937,4097164785,2282392194,1747602018,2956034481,3490824657,538968096,3558328275,131586,539099682,67372032,1747470432,1882276209,67569411,3625700307,2619182481,2551810449,1612792161,3158216370,3827746530,1478052177,3692940753,1343308113,2417000592,3692874960,2551876242,2686682019,2821426083,3490758864,2147582337,202313475,1141327683,404359698,3760440291,3962359008,2349698433,3158282163,2484504210,2017151859,1545358416,2686616226,2686550433,1612923747,539165475,1275940161,3356018880,2619248274,2619116688,943327794,202116096,741215778,3090844338,1814974050,2619314067,1478117970,4029858546,2417132178,4029924339,1208568129,2016954480,3423390912,336921873,4164668403,1882210416,1949648241,2084523891,875889969,269484048,197379,1680098400,1814908257,3288778434,1949582448,3558196689,3023340720,3895118562,134809857,1949714034,404293905,4231974642,1073758272,269615634,3760242912,3158150577,67437825,4164602610,65793,4029726960,673843746,1545490002,2821294497,1410745938,1073955651,2214954369,336856080,2282326401,2551942035,2955968688,3827680737,1208502336,2017020273,2484570003,4231843056,471731730,2147648130,539033889,2349632640,404425491,1545555795,1949779827,1410614352,2956100274,471665937,606405921,1276071747,0,1141261890,3962424801,1477986384,1343373906,3895184355,2084458098,3625634514,3356084673,4231908849,808452144,2484438417,1680164193,1010568240,3023472306,3827614944,3090910131,2084326512,202247682,1343242320,943262001,606471714,808583730,2214888576,1747536225,2417197971,876021555,3827812323,606340128,2753856672,3356216259,1343439699,134875650,2215085955,3625568721,1275874368,2147713923,2349830019,3423522498,943393587,1208633922,3023538099],p=[2712152457,2172913029,3537114822,3553629123,1347687492,287055117,2695638156,556016901,1364991309,1128268611,270014472,303832590,1364201793,4043062476,3267889866,1667244867,539502600,1078199364,538976256,2442927501,3772784832,3806339778,3234334920,320083719,2711889285,2206994319,50332419,1937259339,3015195531,319820547,3536851650,3807129294,1886400576,2156661900,859586319,2695374984,842019330,3520863693,4076091078,1886663748,3773574348,2442401157,50858763,1398019911,1348213836,1398283083,2981903757,16777473,539239428,270277644,1936732995,2425886856,269488128,3234598092,4075827906,3520600521,539765772,3823380423,1919955522,2206204803,2476219275,3520074177,2189690502,3251112393,1616912448,1347424320,2745181059,3823643595,17566989,2998154886,2459704974,1129058127,3014932359,1381505610,3267626694,1886926920,2728666758,303043074,2745970575,3520337349,1633689921,3284140995,2964599940,1094713665,1380979266,1903967565,2173439373,526344,320610063,2442664329,0,286791945,263172,1397756739,4092868551,3789562305,4059839949,1920218694,590098191,589571847,2964336768,2206731147,34344462,2745707403,2728403586,1651256910,2475692931,1095503181,1634216265,1887190092,17303817,34081290,3015458703,3823906767,4092605379,3250849221,2206467975,269751300,4076617422,1617175620,3537641166,573320718,1128794955,303569418,33818118,555753729,1667771211,1650730566,33554946,4059313605,2458915458,2189953674,789516,3014669187,1920745038,3503296704,1920481866,1128531783,2459178630,3789825477,572794374,2155872384,2712415629,3554418639,2711626113,808464384,859059975,2729193102,842282502,286528773,572531202,808990728,4042536132,2745444231,1094976837,1078725708,2172649857,3790088649,2156135556,2475956103,825505029,3284667339,3268153038,809253900,1903178049,286265601,3284404167,2173176201,1903441221,4093131723,3537377994,4042799304,2425623684,1364728137,2189427330,3234071748,4093394895,1095240009,825768201,1667508039,3233808576,3284930511,3553892295,2964863112,51121935,2190216846,1111491138,589308675,2442137985,1617701964,3554155467,2695111812,808727556,4059050433,1078462536,3267363522,1668034383,826031373,556543245,1077936192,2998681230,842808846,2965126284,3250586049,2728929930,2998418058,1112280654,1364464965,859323147,3504086220,1617438792,1937522511,2426150028,3503823048,1112017482,1381242438,1936996167,2694848640,3790351821,1111754310,2981377413,589835019,1633953093,4076354250,3823117251,2981640585,2981114241,2476482447,1381768782,4059576777,3806602950,2997891714,825241857,3806866122,1634479437,1398546255,3773048004,4042272960,3251375565,2156398728,303306246,842545674,1347950664,3503559876,1650467394,556280073,50595591,858796803,3773311176,320346891,17040645,1903704393,2425360512,1650993738,573057546,2459441802],l=[137377848,3370182696,220277805,2258805798,3485715471,3469925406,2209591347,2293282872,2409868335,1080057888,1162957845,3351495687,1145062404,1331915823,1264805931,1263753243,3284385795,1113743394,53686323,2243015733,153167913,2158010400,3269648418,2275648551,3285438483,2173800465,17895441,100795398,202382364,2360392764,103953462,1262700555,3487820847,2290124808,1281387564,2292230184,118690839,3300967428,101848086,3304125492,3267543042,1161905157,3252805665,3335705622,255015999,221330493,2390920206,2291177496,136325160,1312967694,3337810998,238173246,2241963045,3388078137,218172429,3486768159,3369130008,186853419,1180853286,1249015866,119743527,253963311,3253858353,1114796082,1111638018,3302020116,1094795265,3233857536,1131638835,1197696039,2359340076,2340653067,3354653751,2376182829,2155905024,252910623,3401762826,203435052,2325915690,70267956,3268595730,184748043,3470978094,3387025449,1297177629,2224067604,135272472,3371235384,1196643351,2393025582,134219784,3317810181,51580947,3452029965,2256700422,2310125625,3488873535,1299283005,3250700289,20000817,3320968245,2323810314,1247963178,2175905841,3251752977,2105376,3352548375,33685506,35790882,67109892,1214277672,1097953329,117638151,3419658267,2375130141,2308020249,1096900641,2394078270,3336758310,1230067737,3453082653,1095847953,2156957712,3436239900,2324863002,2208538659,2342758443,3234910224,2172747777,251857935,1195590663,168957978,3286491171,3437292588,2374077453,2410921023,2257753110,1265858619,1280334876,2191695906,2174853153,1130586147,52633635,1296124941,3368077320,2391972894,2358287388,171063354,201329676,237120558,2326968378,1315073070,2408815647,1246910490,3270701106,2190643218,3287543859,1229015049,1215330360,3435187212,85005333,3421763643,1081110576,1165063221,1332968511,87110709,1052688,50528259,1147167780,1298230317,3334652934,1148220468,3318862869,2226172980,3403868202,151062537,1181905974,152115225,3472030782,1077952512,34738194,3235962912,2377235517,83952645,3404920890,16842753,3237015600,170010666,1314020382,2309072937,1179800598,1128480771,2239857669,68162580,2306967561,2341705755,2159063088,3319915557,1212172296,1232173113,2274595863,3438345276,236067870,2189590530,18948129,2357234700,185800731,1330863135,1198748727,1146115092,2192748594,219225117,86058021,1329810447,0,1178747910,3454135341,1213224984,1112690706,3420710955,1316125758,3402815514,3384920073,3455188029,3158064,2240910357,1164010533,204487740,2259858486,3303072804,2343811131,1282440252,235015182,1079005200,154220601,102900774,36843570,2223014916,1231120425,2207485971,120796215,3353601063,69215268,2225120292,3418605579,1129533459,167905290,2273543175,3385972761,1279282188,2206433283,2407762959,3468872718,187906107,1245857802,2276701239],y=[2654435769,1013904243,2027808486,4055616972,3816266649,3337566003,2380164711,465362127,930724254,1861448508,3722897016,3150826737,2006686179,4013372358,3731777421,3168587547],f=1;function h(e){return 255&e>>>8}function g(e){return 255&e>>>16}function m(e){return 255&e>>>24}function C(e){e[0]=e[0]>>>24|e[0]<<24|e[0]<<8&16711680|e[0]>>>8&65280}function C(e){return e>>>24|e<<24|e<<8&16711680|e>>>8&65280}function E(e,t,r,a,i,n){var s=t[0];t[0]=t[0]>>>8^r[0]<<24,r[0]=r[0]>>>8^s<<24,a=t[0]+a[0]-y[n],i=r[0]+y[n]-i[0],e[0]=u[255&a]^d[h(a)]^p[g(a)]^l[m(a)],e[1]=u[255&i]^d[h(i)]^p[g(i)]^l[m(i)]}function v(e,t,r,a,i,n){var s=a[0];a[0]=a[0]<<8^i[0]>>>24,i[0]=i[0]<<8^s>>>24,a=t[0]+a[0]-y[n],i=r[0]+y[n]-i[0],e[0]=u[255&a]^d[h(a)]^p[g(a)]^l[m(a)],e[1]=u[255&i]^d[h(i)]^p[g(i)]^l[m(i)]}function S(e,t,r,a,i){var n,r=r[0]^i[0],i=a[0]^i[1],s=r<0?2147483647&r|2147483648:r;i=u[255&(i^=r)]^d[h(i)]^p[g(i)]^l[m(i)],r=u[255&(s+=n=i<0?2147483647&i|2147483648:i)]^d[h(s)]^p[g(s)]^l[m(s)],i=u[255&(n+=s=r<0?2147483647&r|2147483648:r)]^d[h(n)]^p[g(n)]^l[m(n)],e[0]^=s+=n=i<0?2147483647&i|2147483648:i,t[0]^=n}function a(e,t,r,a){var i,n,s,o,c,u,d=new Array(1),p=new Array(1),l=new Array(1),y=new Array(1);d[0]=t[0],p[0]=t[1],l[0]=t[2],y[0]=t[3],a?(i=e,s=d,o=p,c=l,u=y,n=new Array(2),a=31,f||(C(s),C(o),C(c),C(u)),n[1]=i[a--],n[0]=i[a--],S(s,o,c,u,n),n[1]=i[a--],n[0]=i[a--],S(c,u,s,o,n),n[1]=i[a--],n[0]=i[a--],S(s,o,c,u,n),n[1]=i[a--],n[0]=i[a--],S(c,u,s,o,n),n[1]=i[a--],n[0]=i[a--],S(s,o,c,u,n),n[1]=i[a--],n[0]=i[a--],S(c,u,s,o,n),n[1]=i[a--],n[0]=i[a--],S(s,o,c,u,n),n[1]=i[a--],n[0]=i[a--],S(c,u,s,o,n),n[1]=i[a--],n[0]=i[a--],S(s,o,c,u,n),n[1]=i[a--],n[0]=i[a--],S(c,u,s,o,n),n[1]=i[a--],n[0]=i[a--],S(s,o,c,u,n),n[1]=i[a--],n[0]=i[a--],S(c,u,s,o,n),n[1]=i[a--],n[0]=i[a--],S(s,o,c,u,n),n[1]=i[a--],n[0]=i[a--],S(c,u,s,o,n),n[1]=i[a--],n[0]=i[a--],S(s,o,c,u,n),n[1]=i[+a],n[0]=i[0],S(c,u,s,o,n),f||(C(s),C(o),C(c),C(u))):(i=e,n=d,s=p,o=l,c=y,u=new Array(2),f||(C(n),C(s),C(o),C(c)),u[e=0]=i[e++],u[1]=i[e++],S(n,s,o,c,u),u[0]=i[e++],u[1]=i[e++],S(o,c,n,s,u),u[0]=i[e++],u[1]=i[e++],S(n,s,o,c,u),u[0]=i[e++],u[1]=i[e++],S(o,c,n,s,u),u[0]=i[e++],u[1]=i[e++],S(n,s,o,c,u),u[0]=i[e++],u[1]=i[e++],S(o,c,n,s,u),u[0]=i[e++],u[1]=i[e++],S(n,s,o,c,u),u[0]=i[e++],u[1]=i[e++],S(o,c,n,s,u),u[0]=i[e++],u[1]=i[e++],S(n,s,o,c,u),u[0]=i[e++],u[1]=i[e++],S(o,c,n,s,u),u[0]=i[e++],u[1]=i[e++],S(n,s,o,c,u),u[0]=i[e++],u[1]=i[e++],S(o,c,n,s,u),u[0]=i[e++],u[1]=i[e++],S(n,s,o,c,u),u[0]=i[e++],u[1]=i[e++],S(o,c,n,s,u),u[0]=i[e++],u[1]=i[e++],S(n,s,o,c,u),u[0]=i[+e],u[1]=i[31],S(o,c,n,s,u),f||(C(n),C(s),C(o),C(c))),r[0]=l[0],r[1]=y[0],r[2]=d[0],r[3]=p[0]}function i(e){var t="SEED-"+((e=e||{}).mode||"CBC").toUpperCase(),a=e.decrypt?n.cipher.createDecipher(t,e.key):n.cipher.createCipher(t,e.key),i=a.start;return a.start=function(e,t){var r=null;t instanceof n.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,i.call(a,t)},a}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var S,l=dreamsecurity;function e(e,t){l.cipher.registerAlgorithm(e,function(){return new l.aria.Algorithm(e,t)})}l.aria=l.aria||{},l.aria.startEncrypting=function(e,t,r,a){a=i({key:e,output:r,decrypt:!1,mode:a});return a.start(t),a},l.aria.createEncryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!1,mode:t})},l.aria.startDecrypting=function(e,t,r,a){a=i({key:e,output:r,decrypt:!0,mode:a});return a.start(t),a},l.aria.createDecryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!0,mode:t})},l.aria.Algorithm=function(e,t){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"aria")}();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return a(r._w,e,t)},decrypt:function(e,t){return a(r._w,e,t)}}}),r._init=!1},l.aria.Algorithm.prototype.initialize=function(e){if(!this._init){if("string"==typeof(r=e.key)){if(16!==r.length&&24!==r.length&&32!==r.length)throw new Error("The "+r.length+" bytes key length is not valid for aria algorithm.");r=l.util.createBuffer(r)}else if(l.util.isArray(r)){if(16!==r.length&&24!==r.length&&32!==r.length)throw new Error("The "+r.length+" bytes key length is not valid for aria algorithm.");for(var t=r,r=l.util.createBuffer(),a=0;a<t.length;++a)r.putByte(t[a])}if(!l.util.isArray(r)){t=r,r=[];var i=t.length();if(16===i||24===i||32===i){i>>>=2;for(a=0;a<i;++a)r.push(t.getInt32())}}if(!l.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var n=this.mode.name,n=-1!==l.util.arrayIndexOf(["CFB","OFB","CTR","GCM"],n);this._w=s(r,e.decrypt&&!n),this._init=!0}},l.aria._expandKey=s,l.aria._updateBlock=a,e("ARIA-ECB",l.cipher.modes.ecb),e("ARIA-CBC",l.cipher.modes.cbc),e("ARIA-CFB",l.cipher.modes.cfb),e("ARIA-OFB",l.cipher.modes.ofb),e("ARIA-CTR",l.cipher.modes.ctr),e("ARIA-GCM",l.cipher.modes.gcm);var I=[[1367130551,656542356,4262702056,4204424928],[1840335564,2653014048,4280857045,4015907504],[3683792669,556198256,52729717,82364686]],y=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],f=[226,78,84,252,148,194,74,204,98,13,106,70,60,77,139,209,94,250,100,203,180,151,190,43,188,119,46,3,211,25,89,193,29,6,65,107,85,240,153,105,234,156,24,174,99,223,231,187,0,115,102,251,150,76,133,228,58,9,69,170,15,238,16,235,45,127,244,41,172,207,173,145,141,120,200,149,249,47,206,205,8,122,136,56,92,131,42,40,71,219,184,199,147,164,18,83,255,135,14,49,54,33,88,72,1,142,55,116,50,202,233,177,183,171,12,215,196,86,66,38,7,152,96,217,182,185,17,64,236,32,140,189,160,201,132,4,73,35,241,79,80,31,19,220,216,192,158,87,227,195,123,101,59,2,143,62,232,37,146,229,21,221,253,23,169,191,212,154,126,197,57,103,254,118,157,67,167,225,208,245,104,242,27,52,112,5,163,138,213,121,134,168,48,198,81,75,30,166,39,246,53,210,110,36,22,130,95,218,230,117,162,239,44,178,28,159,93,111,128,10,114,68,155,108,144,11,91,51,125,90,82,243,97,161,247,176,214,63,124,109,237,20,224,165,61,34,179,248,137,222,113,26,175,186,181,129],h=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],g=[48,104,153,27,135,185,33,120,80,57,219,225,114,9,98,60,62,126,94,142,241,160,204,163,42,29,251,182,214,32,196,141,129,101,245,137,203,157,119,198,87,67,86,23,212,64,26,77,192,99,108,227,183,200,100,106,83,170,56,152,12,244,155,237,127,34,118,175,221,58,11,88,103,136,6,195,53,13,1,139,140,194,230,95,2,36,117,147,102,30,229,226,84,216,16,206,122,232,8,44,18,151,50,171,180,39,10,35,223,239,202,217,184,250,220,49,107,209,173,25,73,189,81,150,238,228,168,65,218,255,205,85,134,54,190,97,82,248,187,14,130,72,105,154,224,71,158,92,4,75,52,21,121,38,167,222,41,174,146,215,132,233,210,186,93,243,197,176,191,164,59,113,68,70,43,252,235,111,213,246,20,254,124,112,90,125,253,47,24,131,22,165,145,31,5,149,116,169,193,91,74,133,109,19,7,79,78,69,178,15,201,28,166,188,236,115,144,123,207,89,143,161,249,45,242,177,0,148,55,159,208,46,156,110,40,63,128,240,61,211,37,138,181,231,66,179,199,234,247,76,17,51,3,162,172,96],T=[6513507,8158332,7829367,8092539,15921906,7039851,7303023,12961221,3158064,65793,6776679,2829099,16711422,14145495,11250603,7763574,13290186,8553090,13224393,8224125,16448250,5855577,4671303,15790320,11382189,13948116,10658466,11513775,10263708,10790052,7500402,12632256,12040119,16645629,9671571,2500134,3552822,4144959,16250871,13421772,3421236,10855845,15066597,15856113,7434609,14211288,3223857,1381653,263172,13092807,2302755,12829635,1579032,9868950,328965,10132122,460551,1184274,8421504,14869218,15461355,2565927,11711154,7697781,592137,8618883,2894892,1710618,1776411,7237230,5921370,10526880,5395026,3881787,14079702,11776947,2697513,14935011,3092271,8684676,5460819,13750737,0,15592941,2105376,16579836,11645361,5987163,6974058,13355979,12500670,3750201,4868682,5000268,5789784,13619151,13684944,15724527,11184810,16514043,4408131,5066061,3355443,8750469,4539717,16382457,131586,8355711,5263440,3947580,10461087,11053224,5329233,10724259,4210752,9408399,9605778,10329501,3684408,16119285,12369084,11974326,14342874,2171169,1052688,16777215,15987699,13816530,13487565,789516,1250067,15527148,6250335,9934743,4473924,1513239,12895428,10987431,8289918,4013373,6579300,6118749,1644825,7566195,6316128,8487297,5197647,14474460,2236962,2763306,9474192,8947848,4605510,15658734,12105912,1315860,14606046,6184542,723723,14408667,14737632,3289650,3815994,657930,4802889,394758,2368548,6052956,12763842,13882323,11316396,6447714,9539985,9803157,15000804,7960953,15198183,13158600,3618615,7171437,9276813,14013909,5131854,11119017,7105644,5658198,16053492,15395562,6645093,8026746,11447982,526344,12237498,7895160,2434341,3026478,1842204,10921638,11842740,13027014,15263976,14540253,7631988,2039583,4934475,12434877,9145227,9079434,7368816,4079166,11908533,6710886,4737096,197379,16185078,921102,6381921,3487029,5723991,12171705,8816262,12698049,1907997,10395294,14803425,16316664,10000536,1118481,6908265,14277081,9342606,9737364,10197915,1973790,8882055,15329769,13553358,5592405,2631720,14671839,9211020,10592673,9013641,855309,12566463,15132390,4342338,6842472,4276545,10066329,2960685,986895,11579568,5526612,12303291,1447446],A=[3791708898,1308642894,1409307732,4227923196,2483066004,3254829762,1241533002,3422604492,1644192354,218107149,1778412138,1174423110,1006648380,1291865421,2332068747,3506491857,1577082462,4194368250,1677747300,3405827019,3019945140,2533398423,3187719870,721431339,3154164924,1996519287,771763758,50332419,3540046803,419436825,1493195097,3238052289,486546717,100664838,1090535745,1795189611,1426085205,4026593520,2566953369,1761634665,3925928682,2617285788,402659352,2919280302,1660969827,3741376479,3875596263,3137387451,0,1929409395,1711302246,4211145723,2516620950,1275087948,2231403909,3825263844,973093434,150997257,1157645637,2852170410,251662095,3993038574,268439568,3942706155,754986285,2130739071,4093703412,687876393,2885725356,3472936911,2902502829,2432733585,2365623693,2013296760,3355494600,2499843477,4177590777,788541231,3456159438,3439381965,134219784,2046851706,2281736328,939538488,1543527516,2197848963,704653866,671098920,1191200583,3674266587,3087055032,3338717127,2466288531,2751505572,301994514,1392530259,4278255615,2264958855,234884622,822096177,905983542,553656609,1476417624,1207978056,16777473,2382401166,922761015,1946186868,838873650,3389049546,3909151209,2969612721,3070277559,2868947883,201329676,3607156695,3288384708,1442862678,1107313218,637543974,117442311,2550175896,1610637408,3640711641,3053500086,3103832505,285217041,1073758272,3959483628,536879136,2348846220,3170942397,2684395680,3372272073,2214626436,67109892,1224755529,587211555,4043370993,1325420367,1342197840,520101663,318771987,3691044060,3623934168,3221274816,2650840734,1459640151,3808486371,3271607235,2063629179,1694524773,989870907,33554946,2399178639,1040203326,3892373736,620766501,2449511058,3842041317,352326933,3707821533,4244700669,385881879,2835392937,3204497343,3556824276,2583730842,2113961598,3305162181,956315961,1728079719,4261478142,1979741814,2634063261,1124090691,2801837991,3774931425,3489714384,4110480885,1744857192,4060148466,452991771,872428596,1879076976,83887365,2734728099,2315291274,3573601749,2030074233,2248181382,2818615464,805318704,3321939654,1358975313,1258310475,503324190,2785060518,654321447,4127258358,889206069,3523269330,1845522030,603989028,369104406,2181071490,1593859935,3657489114,3858818790,1962964341,2717950626,4009816047,738208812,2986390194,469769244,2667618207,1560304989,1862299503,2147516544,167774730,1912631922,1140868164,2600508315,1811967084,2415956112,184552203,1526750043,855651123,2097184125,1509972570,1375752786,4076925939,1627414881,2701173153,4144035831,2952835248,3590379222,1056980799,2080406652,1828744557,3976261101,335549460,3758153952,2768283045,1023425853,570434082,3003167667,4160813304,2298513801,3724599006,1895854449,436214298,2936057775,3120609978,3036722613,2164294017],b=[1381105746,151584777,1785331818,3587506389,808452144,909508662,2779054245,943194168,3216965823,1077936192,2745368739,2661154974,2172715137,4092788979,3621191895,4227531003,2088501372,3823304931,960036921,2189557890,2610626715,791609391,4294902015,2273771655,875823156,2391670926,1128464451,1145307204,3301179588,3739091166,3924361449,3419078859,1414791252,2071658619,2492727444,842137650,2795896998,3267494082,589496355,1027407933,4008575214,1280049228,2509570197,185270283,1111621698,4210688250,3284336835,1313734734,134742024,774766638,2711683233,1717960806,673710120,3654877401,606339108,2998010034,1987444854,1532690523,2728525986,1229520969,1835860077,2341142667,3520135377,623181861,1920073842,4177002744,4143317238,1684275300,2256928902,1751646312,2560098456,370540566,3570663636,2762211492,1549533276,3435921612,1566376029,1701118053,3065381046,2459041938,1819017324,1886388336,1212678216,1347420240,4261216509,3991732461,3115909305,3671720154,1583218782,353697813,1178992710,1465319511,2812739751,2374828173,2644312221,2223243396,2425356432,3638034648,2880110763,0,2357985420,3166437564,3553820883,168427530,4160159991,3840147684,1482162264,84213765,3099066552,3014852787,1162149957,101056518,3503292624,741081132,505282590,2408513679,3402236106,1061093439,252641295,33685506,3250651329,2947481775,3183280317,50528259,16842753,320012307,2324299914,1802174571,976879674,2442199185,286326801,1094778945,1330577487,1734803559,3705405660,3941204202,2543255703,4075946226,3486449871,3469607118,4042260720,3031695540,3873833190,1936916595,2526412950,2896953516,1953759348,572653602,3890675943,2913796269,892665909,2240086149,3806462178,4193845497,926351415,3907518696,471597084,1970602101,3755933919,1852702830,1195835463,4059103473,437911578,1903231089,488439837,690552873,3318022341,2307457161,1869545583,3082223799,1650589794,235798542,2863268010,404226072,3200123070,454754331,4244373756,1448476758,1044250686,1263206475,3334865094,3536978130,2037973113,538968096,2593783962,3688562907,3233808576,4278059262,2021130360,3452764365,1515847770,4109631732,522125343,3722248413,2829582504,858980403,2290614408,117899271,3351707847,825294897,2981167281,303169554,269484048,1499005017,656867367,2155872384,3974889708,1600061535,1616904288,1364262993,2139029631,2846425257,421068825,3048538293,1246363722,218955789,757923885,3856990437,2054815866,2677997727,2475884691,3385393353,2627469468,4025417967,2694840480,3772776672,993722427,1296891981,2930639022,707395626,4126474485,2964324528,3368550600,3958046955,3149594811,1010565180,2206400643,1397948499,2576941209,1633747041,387383319,724238379,67371012,2122186878,3132752058,2004287607,3604349142,640024614,3789619425,1768489065,336855060,1667432547,1431634005,555810849,202113036,2105344125],N=[808464384,1751672832,2576980224,454761216,2273806080,3115956480,555819264,2021160960,1347440640,960051456,3688618752,3789676800,1920102912,151587072,1650614784,1010580480,1044266496,2122219008,1583242752,2391707136,4059164928,2694881280,3435973632,2745410304,707406336,488447232,4227595008,3065427456,3604403712,538976256,3301229568,2374864128,2172748032,1701143808,4126536960,2307492096,3419130624,2644352256,2004317952,3334915584,1465341696,1128481536,1448498688,387389184,3570717696,1077952512,437918208,1296911616,3233857536,1667457792,1819044864,3823362816,3082270464,3368601600,1684300800,1785358848,1397969664,2863311360,943208448,2560137216,202116096,4109693952,2610666240,3991792896,2139062016,572662272,1987474944,2947526400,3722304768,976894464,185273088,1482184704,1734829824,2290649088,101058048,3284386560,892679424,218959104,16843008,2341178112,2358021120,3267543552,3873891840,1600085760,33686016,606348288,1970631936,2475922176,1717986816,505290240,3857048832,3806519808,1414812672,3638089728,269488128,3469659648,2054846976,3907577856,134744064,741092352,303174144,2543294208,842150400,2880154368,3031741440,656877312,168430080,589505280,3755990784,4025478912,3402287616,3654932736,3099113472,4210752e3,3705461760,825307392,1802201856,3520188672,2913840384,421075200,1229539584,3183328512,1364283648,2526451200,4008635904,3840205824,2829625344,1094795520,3671775744,4294967040,3452816640,1431655680,2256963072,909522432,3200171520,1633771776,1381126656,4177065984,3149642496,235802112,2189591040,1212696576,1768515840,2593823232,3772833792,1195853568,2661195264,1549556736,67372032,1263225600,875836416,353703168,2038003968,640034304,2812782336,3739147776,690563328,2930683392,2459079168,3621246720,2223277056,3924420864,3537031680,3132799488,1566399744,4092850944,3318072576,2964369408,3217014528,2762253312,993737472,1903259904,1145324544,1179010560,724249344,4244438016,3958106880,1869573888,3587560704,4143379968,336860160,4278124032,2088532992,1886416896,1515870720,2105376e3,4261281024,791621376,404232192,2206434048,370546176,2779096320,2442236160,522133248,84215040,2509608192,1953788928,2846468352,3250700544,1532713728,1246382592,2240120064,1835887872,320017152,117901056,1330597632,1313754624,1162167552,2998055424,252645120,3385444608,471604224,2795939328,3166485504,3974949888,1936945920,2425393152,2071689984,3486502656,1499027712,2408550144,2711724288,4193908992,757935360,4076007936,2981212416,0,2492765184,926365440,2678038272,3503345664,774778368,2627509248,1852730880,673720320,1061109504,2155905024,4042321920,1027423488,3553874688,623191296,2324335104,3048584448,3890734848,1111638528,3014898432,3351758592,3941263872,4160222976,1280068608,286331136,858993408,50529024,2728567296,2896997376,1616928768];function o(e){return 65793*(e>>>24&255)^16777473*(e>>>16&255)^16842753*(e>>>8&255)^16843008*(255&e)}function B(e){return e<<8&4278255360^e>>>8&16711935}function R(e){return e<<16&4294901760^e>>>16&65535}function k(e){return(255&e)<<24^(65280&e)<<8^(16711680&e)>>>8^(4278190080&e)>>>24}function w(e,t,r,a,i){var n=4-Math.floor(r/32),s=r%32,r=32-s;a[i]=e[0]^t[n%4]>>>s^t[(3+n)%4]<<r,a[i+1]=e[1]^t[(1+n)%4]>>>s^t[n%4]<<r,a[i+2]=e[2]^t[(2+n)%4]>>>s^t[(1+n)%4]<<r,a[i+3]=e[3]^t[(3+n)%4]>>>s^t[(2+n)%4]<<r}function D(e,t,r,a){var i=o(e[t]),n=o(e[t+1]),s=o(e[t+2]),t=o(e[t+3]);n^=s,s^=t,t^=n,n=B(n^=s^=i^=n),n^=s=R(s),s^=t=k(t),t^=n,n^=s^=i^=n,r[a]=i,r[a+1]=n,r[a+2]=s,r[a+3]=t}function s(e,t){var r=e.slice(0),a=32*e.length;S=8+e.length;var i,n,s,o,c,u,d,p,l=new Array(4*S),y=0,f=new Array(4),h=new Array(4),g=new Array(4),m=new Array(4);if(f[0]=r[0],f[1]=r[1],f[2]=r[2],f[3]=r[3],i=f[0]^I[o=(a-128)/64][0],n=f[1]^I[o][1],s=f[2]^I[o][2],e=f[3]^I[o][3],i=T[i>>>24&255]^A[i>>>16&255]^b[i>>>8&255]^N[255&i],n=T[n>>>24&255]^A[n>>>16&255]^b[n>>>8&255]^N[255&n],n^=s=T[s>>>24&255]^A[s>>>16&255]^b[s>>>8&255]^N[255&s],s^=e=T[e>>>24&255]^A[e>>>16&255]^b[e>>>8&255]^N[255&e],e^=n,n=B(n^=s^=i^=n),n^=s=R(s),s^=e=k(e),e^=n,n^=s^=i^=n,128<a?(h[0]=r[4],h[1]=r[5],192<a?(h[2]=r[6],h[3]=r[7]):h[2]=h[3]=0):h[0]=h[1]=h[2]=h[3]=0,h[0]^=i,h[1]^=n,h[2]^=s,h[3]^=e,i=h[0],n=h[1],s=h[2],e=h[3],i^=I[o=2==o?0:o+1][0],n^=I[o][1],s^=I[o][2],e^=I[o][3],i=b[i>>>24&255]^N[i>>>16&255]^T[i>>>8&255]^A[255&i],n=b[n>>>24&255]^N[n>>>16&255]^T[n>>>8&255]^A[255&n],n^=s=b[s>>>24&255]^N[s>>>16&255]^T[s>>>8&255]^A[255&s],s^=e=b[e>>>24&255]^N[e>>>16&255]^T[e>>>8&255]^A[255&e],s^=i^=n,e=B(e^=n),i=R(i),n=k(n^=s),n^=s,s^=e,e^=n,n^=s^=i^=n,i^=f[0],n^=f[1],s^=f[2],e^=f[3],g[0]=i,g[1]=n,g[2]=s,g[3]=e,i^=I[o=2==o?0:o+1][0],n^=I[o][1],s^=I[o][2],e^=I[o][3],i=T[i>>>24&255]^A[i>>>16&255]^b[i>>>8&255]^N[255&i],n=T[n>>>24&255]^A[n>>>16&255]^b[n>>>8&255]^N[255&n],n^=s=T[s>>>24&255]^A[s>>>16&255]^b[s>>>8&255]^N[255&s],s^=e=T[e>>>24&255]^A[e>>>16&255]^b[e>>>8&255]^N[255&e],e^=n,n=B(n^=s^=i^=n),n^=s=R(s),s^=e=k(e),e^=n,n^=s^=i^=n,m[0]=i^h[0],m[1]=n^h[1],m[2]=s^h[2],m[3]=e^h[3],w(f,h,19,l,y),w(h,g,19,l,y+=4),w(g,m,19,l,y+=4),w(m,f,19,l,y+=4),w(f,h,31,l,y+=4),w(h,g,31,l,y+=4),w(g,m,31,l,y+=4),w(m,f,31,l,y+=4),w(f,h,67,l,y+=4),w(h,g,67,l,y+=4),w(g,m,67,l,y+=4),w(m,f,67,l,y+=4),w(f,h,97,l,y+=4),y+=4,128<a&&(w(h,g,97,l,y),w(g,m,97,l,y+=4),y+=4),192<a&&(w(m,f,97,l,y),w(f,h,109,l,y+=4)),t){var C=0,E=new Array(4),v=32+a/8;for(function(e,t,r){for(var a,i=0;i<4;i++)a=e[t+i],e[t+i]=e[r+i],e[r+i]=a}(l,0,v),C+=4,v-=4;C<v;C+=4,v-=4)d=v,D(c=l,u=C,p=E,0),D(c,d,c,u),c[d]=p[0],c[d+1]=p[1],c[d+2]=p[2],c[d+3]=p[3];D(l,C,E,0),l[C]=E[0],l[C+1]=E[1],l[C+2]=E[2],l[C+3]=E[3]}return r=l}function a(e,t,r,a){for(var i=0,n=new Array(16),s=e.slice(0),o=t[0],c=t[1],u=t[2],d=t[3],p=1;p<S/2;p++)o^=s[i++],c^=s[i++],u^=s[i++],d^=s[i++],o=T[o>>>24&255]^A[o>>>16&255]^b[o>>>8&255]^N[255&o],c=T[c>>>24&255]^A[c>>>16&255]^b[c>>>8&255]^N[255&c],c^=u=T[u>>>24&255]^A[u>>>16&255]^b[u>>>8&255]^N[255&u],u^=d=T[d>>>24&255]^A[d>>>16&255]^b[d>>>8&255]^N[255&d],d^=c,c=B(c^=u^=o^=c),c^=u=R(u),u^=d=k(d),d^=c,c^=u^=o^=c,o^=s[i++],c^=s[i++],u^=s[i++],d^=s[i++],o=b[o>>>24&255]^N[o>>>16&255]^T[o>>>8&255]^A[255&o],c=b[c>>>24&255]^N[c>>>16&255]^T[c>>>8&255]^A[255&c],c^=u=b[u>>>24&255]^N[u>>>16&255]^T[u>>>8&255]^A[255&u],u^=d=b[d>>>24&255]^N[d>>>16&255]^T[d>>>8&255]^A[255&d],u^=o^=c,d=B(d^=c),o=R(o),c=k(c^=u),c^=u,u^=d,d^=c,c^=u^=o^=c;o^=s[i++],c^=s[i++],u^=s[i++],d^=s[i++],o=T[o>>>24&255]^A[o>>>16&255]^b[o>>>8&255]^N[255&o],c=T[c>>>24&255]^A[c>>>16&255]^b[c>>>8&255]^N[255&c],c^=u=T[u>>>24&255]^A[u>>>16&255]^b[u>>>8&255]^N[255&u],u^=d=T[d>>>24&255]^A[d>>>16&255]^b[d>>>8&255]^N[255&d],d^=c,c=B(c^=u^=o^=c),c^=u=R(u),u^=d=k(d),d^=c,c^=u^=o^=c,o^=s[i++],c^=s[i++],u^=s[i++],d^=s[i++],(n=l.util.createBuffer()).putByte(255&(h[255&o>>>24]^s[i]>>>24)),n.putByte(255&(g[255&o>>>16]^s[i]>>>16)),n.putByte(255&(y[255&o>>>8]^s[i]>>>8)),n.putByte(255&(f[255&o]^s[i])),n.putByte(255&(h[255&c>>>24]^s[i+1]>>>24)),n.putByte(255&(g[255&c>>>16]^s[i+1]>>>16)),n.putByte(255&(y[255&c>>>8]^s[i+1]>>>8)),n.putByte(255&(f[255&c]^s[i+1])),n.putByte(255&(h[255&u>>>24]^s[i+2]>>>24)),n.putByte(255&(g[255&u>>>16]^s[i+2]>>>16)),n.putByte(255&(y[255&u>>>8]^s[i+2]>>>8)),n.putByte(255&(f[255&u]^s[i+2])),n.putByte(255&(h[255&d>>>24]^s[i+3]>>>24)),n.putByte(255&(g[255&d>>>16]^s[i+3]>>>16)),n.putByte(255&(y[255&d>>>8]^s[i+3]>>>8)),n.putByte(255&(f[255&d]^s[i+3])),r[0]=n.getInt32(),r[1]=n.getInt32(),r[2]=n.getInt32(),r[3]=n.getInt32()}function i(e){var t="ARIA-"+((e=e||{}).mode||"CBC").toUpperCase(),a=e.decrypt?l.cipher.createDecipher(t,e.key):l.cipher.createCipher(t,e.key),i=a.start;return a.start=function(e,t){var r=null;t instanceof l.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,i.call(a,t)},a}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var n=dreamsecurity;function e(e,t){n.cipher.registerAlgorithm(e,function(){return new n.des.Algorithm(e,t)})}n.des=n.des||{},n.des.startEncrypting=function(e,t,r,a){a=i({key:e,output:r,decrypt:!1,mode:a||(null===t?"ECB":"CBC")});return a.start(t),a},n.des.createEncryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!1,mode:t})},n.des.startDecrypting=function(e,t,r,a){a=i({key:e,output:r,decrypt:!0,mode:a||(null===t?"ECB":"CBC")});return a.start(t),a},n.des.createDecryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!0,mode:t})},n.des.Algorithm=function(e,t){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"des")}();var r=this;r.name=e,r.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return a(r._keys,e,t,!1)},decrypt:function(e,t){return a(r._keys,e,t,!0)}}}),r._init=!1},n.des.Algorithm.prototype.initialize=function(e){if(!this._init){e=n.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==e.length())throw new Error("Invalid Triple-DES key size: "+8*e.length());this._keys=function(e){for(var t,r=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],a=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],i=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],n=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],c=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],u=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],d=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],p=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],l=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],y=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],f=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],h=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=8<e.length()?3:1,m=[],C=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],E=0,v=0;v<g;v++){var S=e.getInt32(),I=e.getInt32();S^=(t=252645135&(S>>>4^I))<<4,S^=t=65535&((I^=t)>>>-16^S),S^=(t=858993459&(S>>>2^(I^=t<<-16)))<<2,S^=t=65535&((I^=t)>>>-16^S),S^=(t=1431655765&(S>>>1^(I^=t<<-16)))<<1,S^=t=16711935&((I^=t)>>>8^S),t=(S^=(t=1431655765&(S>>>1^(I^=t<<8)))<<1)<<8|(I^=t)>>>20&240,S=I<<24|I<<8&16711680|I>>>8&65280|I>>>24&240,I=t;for(var T=0;T<C.length;++T){I=C[T]?(S=S<<2|S>>>26,I<<2|I>>>26):(S=S<<1|S>>>27,I<<1|I>>>27);var A=r[(S&=-15)>>>28]|a[S>>>24&15]|i[S>>>20&15]|n[S>>>16&15]|s[S>>>12&15]|o[S>>>8&15]|c[S>>>4&15],b=u[(I&=-15)>>>28]|d[I>>>24&15]|p[I>>>20&15]|l[I>>>16&15]|y[I>>>12&15]|f[I>>>8&15]|h[I>>>4&15];t=65535&(b>>>16^A),m[E++]=A^t,m[E++]=b^t<<16}}return m}(e),this._init=!0}},e("DES-ECB",n.cipher.modes.ecb),e("DES-CBC",n.cipher.modes.cbc),e("DES-CFB",n.cipher.modes.cfb),e("DES-OFB",n.cipher.modes.ofb),e("DES-CTR",n.cipher.modes.ctr),e("3DES-ECB",n.cipher.modes.ecb),e("3DES-CBC",n.cipher.modes.cbc),e("3DES-CFB",n.cipher.modes.cfb),e("3DES-OFB",n.cipher.modes.ofb),e("3DES-CTR",n.cipher.modes.ctr);var h=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],g=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],m=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],C=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],E=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],v=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],S=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],I=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function a(e,t,r,a){var i=32===e.length?3:9,n=3==i?a?[30,-2,-2]:[0,32,2]:a?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2],s=t[0];s^=(y=252645135&(s>>>4^(f=t[1])))<<4,s^=(y=65535&(s>>>16^(f^=y)))<<16,s^=y=858993459&((f^=y)>>>2^s),s^=y=16711935&((f^=y<<2)>>>8^s),s=(s^=(y=1431655765&(s>>>1^(f^=y<<8)))<<1)<<1|s>>>31,f=(f^=y)<<1|f>>>31;for(var o=0;o<i;o+=3){for(var c=n[o+1],u=n[o+2],d=n[o];d!=c;d+=u)var p=f^e[d],l=(f>>>4|f<<28)^e[d+1],y=s,s=f,f=y^(g[p>>>24&63]|C[p>>>16&63]|v[p>>>8&63]|I[63&p]|h[l>>>24&63]|m[l>>>16&63]|E[l>>>8&63]|S[63&l]);y=s,s=f,f=y}f=f>>>1|f<<31,f^=y=1431655765&((s=s>>>1|s<<31)>>>1^f),f^=(y=16711935&(f>>>8^(s^=y<<1)))<<8,f^=(y=858993459&(f>>>2^(s^=y)))<<2,f^=y=65535&((s^=y)>>>16^f),f^=y=252645135&((s^=y<<16)>>>4^f),r[0]=s^=y<<4,r[1]=f}function i(e){var t=((e=e||{}).mode||"CBC").toUpperCase(),r=24==e.key.length?"3DES-":"DES-";r+=t;var a,i=(a=e.decrypt?n.cipher.createDecipher(r,e.key):n.cipher.createCipher(r,e.key)).start;return a.start=function(e,t){var r=null;t instanceof n.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,i.call(a,t)},a}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var y=dreamsecurity,s=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],f=[1,2,3,5];y.rc2=y.rc2||{},y.rc2.expandKey=function(e,t){t=t||128;for(var r=e="string"==typeof e?y.util.createBuffer(e):e,a=e.length(),t=t,i=Math.ceil(t/8),t=255>>(7&t),n=a;n<128;n++)r.putByte(s[r.at(n-1)+r.at(n-a)&255]);for(r.setAt(128-i,s[r.at(128-i)&t]),n=127-i;0<=n;n--)r.setAt(n,s[r.at(n+1)^r.at(n+i)]);return r};function r(e,t,n){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"rc2")}();var r,s,o,a=!1,c=null,u=null,d=null,i=[];for(e=y.rc2.expandKey(e,t),s=0;s<64;s++)i.push(e.getInt16Le());var p=n?(r=function(e){for(s=0;s<4;s++)e[s]+=i[o]+(e[(s+3)%4]&e[(s+2)%4])+(~e[(s+3)%4]&e[(s+1)%4]),e[s]=(t=e[s])<<(r=f[s])&65535|(65535&t)>>16-r,o++;var t,r},function(e){for(s=0;s<4;s++)e[s]+=i[63&e[(s+3)%4]]}):(r=function(e){for(s=3;0<=s;s--)e[s]=(65535&(t=e[s]))>>(r=f[s])|t<<16-r&65535,e[s]-=i[o]+(e[(s+3)%4]&e[(s+2)%4])+(~e[(s+3)%4]&e[(s+1)%4]),o--;var t,r},function(e){for(s=3;0<=s;s--)e[s]-=i[63&e[(s+3)%4]]}),l=null;return l={start:function(e,t){e&&"string"==typeof e&&(e=y.util.createBuffer(e)),a=!1,c=y.util.createBuffer(),u=t||new y.util.createBuffer,d=e,l.output=u},update:function(e){for(a||c.putBuffer(e);8<=c.length();)!function(e){var t=[];for(s=0;s<4;s++){var r=c.getInt16Le();null!==d&&(n?r^=d.getInt16Le():d.putInt16Le(r)),t.push(65535&r)}o=n?0:63;for(var a=0;a<e.length;a++)for(var i=0;i<e[a][0];i++)e[a][1](t);for(s=0;s<4;s++)null!==d&&(n?d.putInt16Le(t[s]):t[s]^=d.getInt16Le()),u.putInt16Le(t[s])}([[5,r],[1,p],[6,r],[1,p],[5,r]])},finish:function(e){var t,r=!0;return n&&(e?r=e(8,c,!n):(t=8===c.length()?8:8-c.length(),c.fillWithByte(t,t))),r&&(a=!0,l.update()),n||(r=0===c.length())&&(e?r=e(8,u,!n):(e=u.length())<(e=u.at(e-1))?r=!1:u.truncate(e)),r}}}y.rc2.startEncrypting=function(e,t,r){e=y.rc2.createEncryptionCipher(e,128);return e.start(t,r),e},y.rc2.createEncryptionCipher=function(e,t){return r(e,t,!0)},y.rc2.startDecrypting=function(e,t,r){e=y.rc2.createDecryptionCipher(e,128);return e.start(t,r),e},y.rc2.createDecryptionCipher=function(e,t){return r(e,t,!1)}}(),function(){function u(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pki")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var T=dreamsecurity;T.chkIntegrity=function(e,t){var r=T.vi;r.na=new Date(1636172424390);var a=null;a=(a=e.toString()).replace(/ |\t|\r\n|;/gm,"");a=dreamsecurity.util.bytesToHex(T.intg.create(a));try{!function(e,t,r){{if(!e.gf){if(!e.filter){if(!e.s)throw Error("2");var a=parseInt(e.s.substr(0,2),16),i=20*a+2+20;if(e.s.length!=i)throw Error("3");for(var n=2,s="",o=[],c=0;c<a;c++)o.push(e.s.substr(n,20)),n+=20;s=e.s.substr(0,n),i=e.s.substr(n,20);n+=20;s=dreamsecurity.util.bytesToHex(T.intg.create(s));if(i!=s.substr(0,20))throw Error("4");e.s="",e.filter=o;s=function(e){var t={msg:"",result:!1};{if(void 0===e)return t.msg="input value is null.",t;var r=null,a=null;try{var i=T.util.decode64(e),n="";if("0"==i[0]){var s=dreamsecurity.asn1.fromDer(i),o={};if(!A.validate(s,b,o,[]))return t.msg="Cannot read the license (1).",t;for(var c=s.value,u=0;u<c.length;u++)c[u].value!=o.signature&&("object"==typeof c[u].value?c[u].value[0].value!=o.warningMsg&&(n+=c[u].value[0].value):n+=c[u].value);if(Number(o.version)<6)return t.msg="Cannot read the license (2).",t;var d=T.md.sha1.create();d.start(),d.update(n);var p=T.pki.setRsaPublicKey(new dreamsecurity.jsbn.BigInteger("00A777A0A26CBDCACBC1203CA8F79A5A609FBC3F189D988A4ED725E3077A24C7D5B8F71CDA026AB8D3FD978D003ACAC0EA1E5776AF6C990AD23052218A396FCCE5",16),new dreamsecurity.jsbn.BigInteger("010001",16)),l=T.util.hexToBytes(o.signature);if(!p.verify(d.digest().getBytes(),l,"RSASSA-PKCS1-V1_5"))return t.msg="Invalid licenses",t;if("MagicJS"!=o.softwareName)return t.msg="Not magicJS License.",t;a=null!=o.validity&&""!=o.validity?(r="T0",o.validity):(r="R0",o.key)}else{p=T.pki.setRsaPublicKey(new T.jsbn.BigInteger("00c4665976b561cd82d1971e6512a4bddf65d82c035b81486f3b4756258dbd6d95a433db2d7d0daec20f3ddef14af5f504b52e72efc261e88bc5c867890acf52c5f9b96a2d2adc07091c3355415cb4141de608db0633adbb6b8019a03b8fdda447bc484e98b71dd2c1f570d4a3537ea87961c28436bac8393f5ffa11270a1adbea400f3b209a6b8b288d7069fa3623f9cd9c7b1fd8c52cc363587677f6ba82bc3a5d2fa44e78b605a57040e0317fd2f20c70775dcf61d2361832583a13fb6f778bf3271ab5aa605e84cbe5675fc55a49f5891ed17f4e3db1c920f9f46a87aa5cdb06f9cb8c39118c7f03d0466c0f8b60ccab62e35a0b8d947992c0dd1acd5bbebb",16),new T.jsbn.BigInteger("010001",16)),s=T.pki.rsa.decrypt(i,p,!0,!0);r=s.substr(0,2),a=s.substr(2,s.length-2)}if("R0"==r){for(var y=a.split(","),f=0;f<y.length;f++){var h=function(e){e=-1<e.indexOf("://")?e.split("/")[2]:e.split("/")[0];return e=e.split(":")[0]}(location.href);if(y[f]==h)return t.result=!0,t;var g=h.split("."),m=y[f].split(".");if(g.length==m.length)for(var C=!0,E=0;E<g.length;E++)if("*"!==m[E]&&g[E]!=m[E]){C=!1;break}}return C?t.result=!0:t.msg="The license is not for this domain!",t}if("T0"!=r)return t.msg="Error(100100)",t;var v=a.split("-"),S=new Date(Number(v[0]),Number(v[1])-1,Number(v[2])),I=new Date;if(S<I)return t.msg="The license expired!",t}catch(e){return console.log("license error : "+e),t.msg="Error(110110).",t.result=!1,t}}return t.result=!0,t}(e.l);if(1!=s.result)throw e.filter=[],new Error(s.msg)}for(var u=r.substr(0,20),c=0;c<e.filter.length;c++)if(e.filter[c]==u)return;throw new Error("5")}if(new Date>T.vi.na)throw Error("1");e.list||(e.list={},e.tbi={}),e.list[t]=r}}(r,t,a)}catch(e){a=new Error("It does not allow the use MagicJS. ("+e.message+")");throw a.type=T.err.license,a}};var A=T.asn1,d=T.pki=T.pki||{},p=d.oids,b={name:"MagicLicense",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"MagicLicense.version",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"version"},{name:"MagicLicense.softwareName",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"softwareName"},{name:"MagicLicense.companyName",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"companyName"},{name:"MagicLicense.serialNumber",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"serialNumber"},{name:"MagicLicense.HostIDInformation.hostID",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,optional:!0,capture:"hostID"},{name:"MagicLicense.HostIDInformation.hostIDSet",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,optional:!0,capture:"hostIDSet"},{name:"MagicLicense.ipInformation.ip",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,optional:!0,capture:"ip"},{name:"MagicLicense.ipInformation.ipSet",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,optional:!0,capture:"ipSet"},{name:"MagicLicense.validity",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"validity"},{name:"MagicLicense.ability",tagClass:A.Class.UNIVERSAL,type:A.Type.BITSTRING,constructed:!1,optional:!0,capture:"ability"},{name:"MagicLicense.signature",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"MagicLine.warningMsg",tagClass:A.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"MagicLine.warningMsg.msg",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"warningMsg"}]},{name:"MagicLine.contactAddress",tagClass:A.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"MagicLine.contactAddress.address",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"contactAddress"}]},{name:"MagicLine.macAddressSet",tagClass:A.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"MagicLine.macAddressSet.macAddress",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"macAddress"}]},{name:"MagicLine.macKey",tagClass:A.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,optional:!0,value:[{name:"MagicLine.macKey.key",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"key"}]},{name:"MagicLine.macValue",tagClass:A.Class.CONTEXT_SPECIFIC,type:4,constructed:!0,optional:!0,value:[{name:"MagicLine.macValue.value",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"macValue"}]},{name:"MagicLine.functionLimit",tagClass:A.Class.CONTEXT_SPECIFIC,type:5,constructed:!0,optional:!0,value:[{name:"MagicLine.functionLimit.limitString",tagClass:A.Class.UNIVERSAL,type:A.Type.BITSTRING,constructed:!1,capture:"functionLimit"}]},{name:"MagicLine.userCount",tagClass:A.Class.CONTEXT_SPECIFIC,type:6,constructed:!0,optional:!0,value:[{name:"MagicLine.userCount.count",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"userCount"}]}]};d.pemToDer=function(e){e=T.pem.decode(e)[0];if(e.procType&&"ENCRYPTED"===e.procType.type)throw new Error("Could not convert PEM to DER; PEM is encrypted.");return T.util.createBuffer(e.body)};var e=T.pki.algIdValidator=function(e,t,r,a,i){return{name:e,tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:t,tagClass:A.Class.UNIVERSAL,type:A.Type.OID,constructed:!1,capture:r},{name:a,tagClass:A.Class.UNIVERSAL,optional:!0,captureAsn1:i}]}},l={name:"PrivateKeyInfo",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:A.Class.UNIVERSAL,type:A.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},e("PrivateKeyInfo.privateKeyAlgorithm","AlgorithmIdentifier.algorithm","privateKeyOid","AlgorithmIdentifier.parameter","parameters"),{name:"PrivateKeyInfo",tagClass:A.Class.UNIVERSAL,type:A.Type.OCTETSTRING,constructed:!1,capture:"privateKey"},{name:"PrivateKeyInfo.attributes",tagClass:A.Class.CONTEXT_SPECIFIC,type:0,capture:"priKeyAttributes",optional:!0}]},s=T.pki.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:A.Class.UNIVERSAL,type:A.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[e("SubjectPublicKeyInfo.AlgorithmIdentifier","AlgorithmIdentifier.algorithm","publicKeyOid","AlgorithmIdentifier.parameter","parameters"),{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:A.Class.UNIVERSAL,type:A.Type.BITSTRING,constructed:!1,capture:"publicKey"}]};d.privateKeyFromPem=function(e){var t=T.pem.decode(e)[0];if("PRIVATE KEY"!==t.type&&"RSA PRIVATE KEY"!==t.type&&"KCDSA PRIVATE KEY"!==t.type){e=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY" or "KCDSA PRIVATE KEY".');throw e.headerType=t.type,e}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert private key from PEM; PEM is encrypted.");t=A.fromDer(t.body,!0);return d.privateKeyFromAsn1(t)},d.privateKeyFromAsn1=function(e){u();var t={},r=[];if(!A.validate(e,l,t,r))throw(a=new Error("Cannot read private key.")).errors=r,a;e=A.fromDer(T.util.createBuffer(t.privateKey));var a,i=A.derToOid(t.privateKeyOid),n=null;i===p.rsaEncryption?(n=d.rsa.privateKeyFromAsn1(e)).algName="rsa":i===p.kcdsa1?(n=d.kcdsa.privateKeyFromAsn1(e,t.parameters)).algName="kcdsa":i===p.ecPublicKey?(n=d.ecc.privateKeyFromAsn1(e,t.parameters)).algName="ecc":(a=new Error("Not supported key.key oid="+i)).errors=r,n.randomNum=null;var s=t.priKeyAttributes;if(null!=s)for(var o=0;o<s.length;++o){var c=T.pkcs7.attrFromAsn1(s[o]);if(c.oid===p.randomNum){if("string"!=typeof c.values[0].value){n.randomNum="";for(o=0;o<c.values[0].value.length;++o)n.randomNum+=A.toDer(c.values[0].value[o]).getBytes()}else n.randomNum=c.values[0].value.slice(1,c.values[0].value.length);break}}return n},d.publicKeyFromAsn1=function(e){u();var t={},r=[];if(!A.validate(e,s,t,r))throw(i=new Error("Cannot read public key.")).errors=r,i;var a=T.util.createBuffer(t.publicKey);++a.read,e=a.getBytes();var i,n=A.derToOid(t.publicKeyOid),a=null;return n===p.rsaEncryption?(a=d.rsa.publicKeyFromAsn1(A.fromDer(e))).algName="rsa":n===p.kcdsa1?(a=d.kcdsa.publicKeyFromAsn1(A.fromDer(e),t.parameters)).algName="kcdsa":n===p.ecPublicKey?(a=d.ecc.publicKeyFromAsn1(e,t.parameters)).algName="ecc":(i=new Error("Not supported key.key oid="+n)).errors=r,a},d.priKeyToPriKeyInfo=function(e){u();var t=null,r=null,a=null;"rsa"==e.algName?(t=T.pki.privateKeyToRSAPrivateKey(e),a=d.oids.rsaEncryption,r=A.create(A.Class.UNIVERSAL,A.Type.NULL,!1,"")):"kcdsa"==e.algName?(t=T.pki.privateKeyToKCDSAPrivateKey(e),a=d.oids.kcdsa1,r=T.pki.toKCDSAParam(e)):"ecc"==e.algName?(t=T.pki.privateKeyToECPrivateKey(e),a=d.oids.ecPublicKey,r=T.pki.toECParam(e)):new Error("Not supported key. ("+e.algName+")").errors=errors;var i=A.create(A.Class.UNIVERSAL,A.Type.INTEGER,!1,A.integerToDer(0).getBytes()),a=A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(a).getBytes()),r]),r=A.create(A.Class.UNIVERSAL,A.Type.OCTETSTRING,!1,A.toDer(t).getBytes()),t=null;return null!=e.randomNum&&null!=e.randomNum?(t=A.create(A.Class.CONTEXT_SPECIFIC,0,!0,[A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(d.oids.randomNum).getBytes()),A.create(A.Class.UNIVERSAL,A.Type.SET,!0,[A.create(A.Class.UNIVERSAL,A.Type.BITSTRING,!1,String.fromCharCode(0)+e.randomNum)])])]),A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[i,a,r,t])):A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[i,a,r])},d.publicKeyToAsn1=d.publicKeyToSubjectPublicKeyInfo=function(e){u();var t=null,r=null,a=null;return"rsa"==e.algName?(t=T.pki.publicKeyToRSAPublicKey(e),a=d.oids.rsaEncryption,r=A.create(A.Class.UNIVERSAL,A.Type.NULL,!1,"")):"kcdsa"==e.algName?(t=T.pki.publicKeyToKCDSAPublicKey(e),a=d.oids.kcdsa1,r=T.pki.toKCDSAParam(e)):"ecc"==e.algName?(t=T.pki.publicKeyToECPublicKey(e),a=d.oids.ecPublicKey,r=T.pki.toECParam(e)):new Error("Not supported key. ("+e.algName+")").errors=errors,A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.SEQUENCE,!0,[A.create(A.Class.UNIVERSAL,A.Type.OID,!1,A.oidToDer(a).getBytes()),r]),A.create(A.Class.UNIVERSAL,A.Type.BITSTRING,!1,[t])])},d.privateKeyToPem=function(e,t){e={type:"RSA PRIVATE KEY",body:A.toDer(d.privateKeyToAsn1(e)).getBytes()};return T.pem.encode(e,{maxline:t})},d.privateKeyInfoToPem=function(e,t){e={type:"PRIVATE KEY",body:A.toDer(e).getBytes()};return T.pem.encode(e,{maxline:t})}}(),function(){function E(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pbkdf2")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var v=dreamsecurity,e=v.pkcs5=v.pkcs5||{};v.pbkdf1=e.pbkdf1=function(e,t,r,a,i){E();var n=0;if(a>(i=null==i?v.md.sha1.create():i).digestLength)throw new Error("Derived key is too long.");i.start(),i.update(e),i.update(t);for(var s=i.digest(),n=1;n<r;n++)i.start(),i.update(s.getBytes()),s=i.digest();return s.getBytes(a)},v.pbkdf2=e.pbkdf2=function(e,t,r,a,i,n){E(),"function"==typeof i&&(n=i,i=null);var s=(i=null==i?v.md.sha1.create():i).digestLength;if(4294967295*s<a){var o=new Error("Derived key is too long.");if(n)return n(o);throw o}var c=Math.ceil(a/s),u=a-(c-1)*s,d=v.hmac.create();d.start(i,e);var p,l,y="";if(!n){for(var f=1;f<=c;++f){d.start(null,null),d.update(t),d.update(v.util.int32ToBytes(f));for(var h=l=d.digest().getBytes(),g=2;g<=r;++g)d.start(null,null),d.update(l),p=d.digest().getBytes(),h=v.util.xorBytes(h,p,s),l=p;y+=f<c?h:h.substr(0,u)}return y}f=1;function m(){if(c<f)return n(null,y);d.start(null,null),d.update(t),d.update(v.util.int32ToBytes(f)),h=l=d.digest().getBytes(),g=2,C()}function C(){if(g<=r)return d.start(null,null),d.update(l),p=d.digest().getBytes(),h=v.util.xorBytes(h,p,s),l=p,++g,v.util.setImmediate(C);y+=f<c?h:h.substr(0,u),++f,m()}m()}}(),function(){function c(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pbe")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var k=dreamsecurity,l=(k.jsbn.BigInteger,k.asn1),y=k.pki=k.pki||{};y.pbe=k.pbe=k.pbe||{};var p=y.oids,o={name:"EncryptedPrivateKeyInfo",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:l.Class.UNIVERSAL,type:l.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:l.Class.UNIVERSAL,type:l.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]};y.pbe.encryptedPrivateKeyValidator=o;var u={name:"PBES2Algorithms",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:l.Class.UNIVERSAL,type:l.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:l.Class.UNIVERSAL,type:l.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,onstructed:!0,capture:"kdfIterationCount"}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:l.Class.UNIVERSAL,type:l.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:l.Class.UNIVERSAL,type:l.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},f={name:"pkcs-12PbeParams",tagClass:l.Class.UNIVERSAL,type:l.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:l.Class.UNIVERSAL,type:l.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:l.Class.UNIVERSAL,type:l.Type.INTEGER,constructed:!1,capture:"iterations"}]};function d(e,t){return e.start().update(t).digest().getBytes()}y.pbe.getEncPriKeyInfoForPBES2=function(e,t,r){var a,i,n,s,o=k.random.getBytesSync(r.saltSize),c=r.count,u=l.integerToDer(c);switch(r.algorithm){case"aes128":i=a=16,n=p["aes128-CBC"],s=k.aes.createEncryptionCipher;break;case"aes192":a=24,i=16,n=p["aes192-CBC"],s=k.aes.createEncryptionCipher;break;case"aes256":a=32,i=16,n=p["aes256-CBC"],s=k.aes.createEncryptionCipher;break;case"des":i=a=8,n=p.desCBC,s=k.des.createEncryptionCipher;break;case"seed":i=a=16,n=p.seedCBC,s=k.seed.createEncryptionCipher;break;case"aria":case"aria128":i=a=16,n=p.ariaCBC,s=k.aria.createEncryptionCipher;break;case"aria192":a=24,i=16,n=p["aria192-CBC"],s=k.aria.createEncryptionCipher;break;case"aria256":a=32,i=16,n=p["aria256-CBC"],s=k.aria.createEncryptionCipher;break;case"des-EDE3":case"3des":a=24,i=8,n=p["des-EDE3-CBC"],s=k.des.createEncryptionCipher;break;default:var d=new Error("Cannot encrypt private key. Unsupported PKCS5 pbe2 encryption algorithm. : "+r.algorithm);throw d.type=k.err.unsupported,d.algorithm=r.algorithm,d}var t=k.pkcs5.pbkdf2(t,o,c,a),c=k.random.getBytesSync(i),t=s(t);return t.start(c),t.update(e),t.finish(),t=t.output.getBytes(),encryptionAlgorithm=l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OID,!1,l.oidToDer(p.pkcs5PBES2).getBytes()),l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OID,!1,l.oidToDer(p.pkcs5PBKDF2).getBytes()),l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OCTETSTRING,!1,o),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,u.getBytes())])]),l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OID,!1,l.oidToDer(n).getBytes()),l.create(l.Class.UNIVERSAL,l.Type.OCTETSTRING,!1,c)])])]),l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[encryptionAlgorithm,l.create(l.Class.UNIVERSAL,l.Type.OCTETSTRING,!1,t)])},y.pbe.getEncPriKeyInfoForPBES1=function(e,t,r){var a,i,n,s,o=k.random.getBytesSync(r.saltSize),c=r.count,u=l.integerToDer(c);if("seed"!==r.algorithm){var d=new Error("Cannot encrypt private key. Unsupported PKCS5 pbe encryption algorithm. : "+r.algorithm);throw d.type=k.err.unsupported,d.algorithm=r.algorithm,d}a=16,n=r.fixedIv?(i=0,y.oids.seedCBC):(i=16,y.oids.seedCBCWithSHA1),s=k.seed.createEncryptionCipher,md=k.md.sha1.create();var p="",d=null,r=null;r=a+i<=md.digestLength?(d=(p=k.pkcs5.pbkdf1(t,o,c,a+i,md)).substr(0,a),0<i?p.substr(a,i):"0123456789012345"):(d=(p=k.pkcs5.pbkdf1(t,o,c,md.digestLength,md)).substr(0,a),md.start(),md.update(p.substr(a,md.digestLength-i)),md.digest().getBytes(i));d=s(d);return d.start(r),d.update(e),d.finish(),d=d.output.getBytes(),encryptionAlgorithm=l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OID,!1,l.oidToDer(n).getBytes()),l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OCTETSTRING,!1,o),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,u.getBytes())])]),l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[encryptionAlgorithm,l.create(l.Class.UNIVERSAL,l.Type.OCTETSTRING,!1,d)])},_encryptForPKCS12PBE=function(e,t,r,a){if("3des"!==a.algorithm&&"des-EDE3"!==a.algorithm){var i=new Error("Cannot encrypt private key. Unsupported PKCS12 pbe algorithm. : "+a.algorithm);throw i.type=k.err.unsupported,i}i=a.count,a=new k.util.ByteBuffer(r),r=y.pbe.generatePkcs12Key(t,a,1,i,24),i=y.pbe.generatePkcs12Key(t,a,2,i,8),r=k.des.createEncryptionCipher(r);return r.start(i),r.update(e),r.finish(),r.output.getBytes()},_pkcs12PbeAlgToASN1=function(e,t){return l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OID,!1,l.oidToDer(p["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OCTETSTRING,!1,e),l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,l.integerToDer(t).getBytes())])])},y.pbe.getEncDataForPKCS12PBE=function(e,t,r){var a=k.random.getBytesSync(r.saltSize),t=_encryptForPKCS12PBE(e,t,a,r),t=l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OID,!1,l.oidToDer(y.oids.data).getBytes()),_pkcs12PbeAlgToASN1(a,r.count),l.create(l.Class.CONTEXT_SPECIFIC,0,!1,t)]);return l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.OID,!1,l.oidToDer(y.oids.encryptedData).getBytes()),l.create(l.Class.CONTEXT_SPECIFIC,0,!0,[l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[l.create(l.Class.UNIVERSAL,l.Type.INTEGER,!1,l.integerToDer(0).getBytes()),t])])])},y.pbe.getEncPriKeyInfoForPKCS12PBE=function(e,t,r){var a=k.random.getBytesSync(r.saltSize),t=_encryptForPKCS12PBE(e,t,a,r);return l.create(l.Class.UNIVERSAL,l.Type.SEQUENCE,!0,[_pkcs12PbeAlgToASN1(a,r.count),l.create(l.Class.UNIVERSAL,l.Type.OCTETSTRING,!1,t)])},y.encryptPrivateKeyInfo=function(e,t,r){(r=r||{}).version=r.version||20,r.saltSize=r.saltSize||8,r.count=r.count||20==r.version?2048:1024,r.algorithm=r.algorithm||"aes128";return void 0!==r.usePkcs12&&r.usePkcs12?y.pbe.getEncPriKeyInfoForPKCS12PBE(l.toDer(e),t,r):20==r.version?y.pbe.getEncPriKeyInfoForPBES2(l.toDer(e),t,r):y.pbe.getEncPriKeyInfoForPBES1(l.toDer(e),t,r)},y.encryptDataWithPBE=function(e,t,r){return r.saltSize=r.saltSize||8,r.count=r.count||20==r.version?2048:1024,r.algorithm=r.algorithm||"aes128",y.pbe.getEncDataForPKCS12PBE(l.toDer(e),t,r)},y.decryptPrivateKeyInfo=function(e,t,r){var a=null,i={},n=[];if(!l.validate(e,o,i,n)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=n,s.type=k.err.decode,s}e=null,n=!1,s=l.derToOid(i.encryptionOid);s==y.oids.pkcs5PBES2?e=20:(e=15,s==y.oids.seedCBC&&(n=!0));t=y.pbe.getCipher(s,i.encryptionParams,t),i=k.util.createBuffer(i.encryptedData);if(t.update(i),t.finish())try{a=l.fromDer(t.output,!0)}catch(e){throw e.type=k.err.wrongPasswd,e.message="Confirm password.",e}return null!=r&&1==r&&(a={privateKey:a,pbeAlg:"",pkcs5Version:e,fixedIv:n},"AES-CBC"==t.algorithm.name?a.pbeAlg="AES"+8*t.keySize+"-CBC":"ARIA-CBC"==t.algorithm.name?a.pbeAlg="ARIA"+8*t.keySize+"-CBC":a.pbeAlg=t.algorithm.name),a},y.encryptedPrivateKeyToPem=function(e,t){e={type:"ENCRYPTED PRIVATE KEY",body:l.toDer(e).getBytes()};return k.pem.encode(e,{maxline:t})},y.encryptedPrivateKeyFromPem=function(e){var t=k.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){e=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw e.headerType=t.type,e}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return l.fromDer(t.body)},y.encryptPrivateKey=function(e,t,r){if(c(),!(r=r||{}).legacy)return rval=y.encryptPrivateKeyInfo(e,t,r),l.toDer(rval);var a,i,n,s;switch(r.algorithm){case"aes128":a="AES-128-CBC",i=k.random.getBytesSync(n=16),s=k.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",n=24,i=k.random.getBytesSync(16),s=k.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",n=32,i=k.random.getBytesSync(16),s=k.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",n=24,i=k.random.getBytesSync(8),s=k.des.createEncryptionCipher;break;case"des":a="DES-CBC",i=k.random.getBytesSync(n=8),s=k.des.createEncryptionCipher;break;default:var o=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw o.algorithm=r.algorithm,o}t=s(k.pbe.opensslDeriveBytes(t,i.substr(0,8),n));t.start(i),t.update(l.toDer(y.privateKeyToAsn1(e))),t.finish();t={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:k.util.bytesToHex(i).toUpperCase()},body:t.output.getBytes()};return k.pem.encode(t)},y.decryptRsaPrivateKey=function(e,t){c();var r,a,i,n=null,s=k.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==s.type&&"PRIVATE KEY"!==s.type&&"RSA PRIVATE KEY"!==s.type)throw(i=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=i;if(s.procType&&"ENCRYPTED"===s.procType.type){switch(s.dekInfo.algorithm){case"DES-CBC":r=8,a=k.des.createDecryptionCipher;break;case"DES-EDE3-CBC":r=24,a=k.des.createDecryptionCipher;break;case"AES-128-CBC":r=16,a=k.aes.createDecryptionCipher;break;case"AES-192-CBC":r=24,a=k.aes.createDecryptionCipher;break;case"AES-256-CBC":r=32,a=k.aes.createDecryptionCipher;break;case"RC2-40-CBC":r=5,a=function(e){return k.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":r=8,a=function(e){return k.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":r=16,a=function(e){return k.rc2.createDecryptionCipher(e,128)};break;default:throw(i=new Error('Could not decrypt private key; unsupported encryption algorithm "'+s.dekInfo.algorithm+'".')).algorithm=s.dekInfo.algorithm,i}var o=k.util.hexToBytes(s.dekInfo.parameters),e=a(k.pbe.opensslDeriveBytes(t,o.substr(0,8),r));if(e.start(o),e.update(k.util.createBuffer(s.body)),!e.finish())return n;n=e.output.getBytes()}else n=s.body;return n=null!==(n="ENCRYPTED PRIVATE KEY"===s.type?y.decryptPrivateKeyInfo(l.fromDer(n),t):l.fromDer(n))?y.privateKeyFromAsn1(n):n},y.pbe.generatePkcs12Key=function(e,t,r,a,i,n){var s=(n=null==n?k.md.sha1.create():n).digestLength,o=n.blockLength,c=new k.util.ByteBuffer,u=new k.util.ByteBuffer;if(null!=e){if("string"!=typeof e)throw new Error("The password is not a string type.");for(R=0;R<e.length;R++)u.putInt16(e.charCodeAt(R));u.putInt16(0)}var d=u.length(),p=t.length(),l=new k.util.ByteBuffer;l.fillWithByte(r,o);var y=o*Math.ceil(p/o),f=new k.util.ByteBuffer;for(R=0;R<y;R++)f.putByte(t.at(R%p));var h=o*Math.ceil(d/o),g=new k.util.ByteBuffer;for(R=0;R<h;R++)g.putByte(u.at(R%d));var m=f;m.putBuffer(g);for(var C=Math.ceil(i/s),E=1;E<=C;E++){var v=new k.util.ByteBuffer;v.putBytes(l.bytes()),v.putBytes(m.bytes());for(var S=0;S<a;S++)n.start(),n.update(v.getBytes()),v=n.digest();var I=new k.util.ByteBuffer;for(R=0;R<o;R++)I.putByte(v.at(R%s));for(var T=Math.ceil(p/o)+Math.ceil(d/o),A=new k.util.ByteBuffer,b=0;b<T;b++){for(var N=new k.util.ByteBuffer(m.getBytes(o)),B=511,R=I.length()-1;0<=R;R--)B>>=8,B+=I.at(R)+N.at(R),N.setAt(R,255&B);A.putBuffer(N)}m=A,c.putBuffer(v)}return c.truncate(c.length()-i),c},y.pbe.getCipher=function(e,t,r){switch(e){case y.oids.pkcs5PBES2:return y.pbe.getDecCipherForPBES2(e,t,r);case y.oids.seedCBCWithSHA1:case y.oids.seedCBC:case y.oids.pbeWithSHA1AndARIA_CBC:return y.pbe.getDecCipherForPBES1(e,t,r);case y.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case y.oids["pbewithSHAAnd40BitRC2-CBC"]:return y.pbe.getDecCipherForPKCS12PBE(e,t,r);default:var a=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw a.oid=e,a.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","seedCBCWithSHA1","pbewithSHAAnd40BitRC2-CBC"],a}},y.pbe.getDecCipherForPBES2=function(e,t,r){var a={},i=[];if(!l.validate(t,u,a,i))throw(o=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=i,o;if((e=l.derToOid(a.kdfOid))!==y.oids.pkcs5PBKDF2)throw(o=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,o.supportedOids=["pkcs5PBKDF2"],o;e=l.derToOid(a.encOid);var n,s,i=a.kdfSalt,o=(o=k.util.createBuffer(a.kdfIterationCount)).getInt(o.length()<<3);switch(y.oids[e]){case"aes128-CBC":n=16,s=k.aes.createDecryptionCipher;break;case"aes192-CBC":n=24,s=k.aes.createDecryptionCipher;break;case"aes256-CBC":n=32,s=k.aes.createDecryptionCipher;break;case"des-EDE3-CBC":n=24,s=k.des.createDecryptionCipher;break;case"desCBC":n=8,s=k.des.createDecryptionCipher;break;case"seedCBC":n=16,s=k.seed.createDecryptionCipher;break;case"ariaCBC":case"aria128-CBC":n=16,s=k.aria.createDecryptionCipher;break;case"aria192-CBC":n=24,s=k.aria.createDecryptionCipher;break;case"aria256-CBC":n=32,s=k.aria.createDecryptionCipher;break;default:throw new Error("Cannot read encrypted private key. Unsupported encryption scheme OID. : "+e)}o=k.pkcs5.pbkdf2(r,i,o,n),a=a.encIv,o=s(o);return o.start(a),o.keySize=n,o},y.pbe.getDecCipherForPBES1=function(e,t,r){var a={},i=[];if(!l.validate(t,f,a,i))throw(c=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=i,c;var n,s,o,c,u=a.salt,d=(d=k.util.createBuffer(a.iterations)).getInt(d.length()<<3),p=null;switch(e){case y.oids.seedCBCWithSHA1:s=n=16,o=k.seed.startDecrypting,p=k.md.sha1.create();break;case y.oids.seedCBC:n=16,s=0,o=k.seed.startDecrypting,p=k.md.sha1.create();break;case y.oids.pbeWithSHA1AndARIA_CBC:s=n=16,o=k.aria.startDecrypting,p=k.md.sha1.create();break;default:throw(c=new Error("Cannot read PBES1 data block. Unsupported OID.")).oid=e,c}t="",i=null,a=null;return a=n+s<=p.digestLength?(i=(t=k.pkcs5.pbkdf1(r,u,d,n+s,p)).substr(0,n),0<s?t.substr(n,s):"0123456789012345"):(i=(t=k.pkcs5.pbkdf1(r,u,d,p.digestLength,p)).substr(0,n),p.start(),p.update(t.substr(n,p.digestLength-n)),p.digest().getBytes(s)),o(i,a)},y.pbe.getDecCipherForPKCS12PBE=function(e,t,r){var a={},i=[];if(!l.validate(t,f,a,i))throw(c=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=i,c;var n,s,o,c,i=k.util.createBuffer(a.salt),a=(a=k.util.createBuffer(a.iterations)).getInt(a.length()<<3);switch(e){case y.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:n=24,s=8,o=k.des.startDecrypting;break;case y.oids.seedCBCWithSHA1:case y.oids.pbeWithSHA1AndARIA_CBC:s=n=16,o=k.seed.startDecrypting;break;case y.oids["pbewithSHAAnd40BitRC2-CBC"]:n=5,s=8,o=function(e,t){e=k.rc2.createDecryptionCipher(e,40);return e.start(t,null),e};break;default:throw(c=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,c}return o(y.pbe.generatePkcs12Key(r,i,1,a,n),y.pbe.generatePkcs12Key(r,i,2,a,s))},y.pbe.opensslDeriveBytes=function(e,t,r,a){for(var i=[d(a=null==a?k.md.md5.create():a,e+(t=null===t?"":t))],n=16,s=1;n<r;++s,n+=16)i.push(d(a,i[s-1]+e+t));return i.join("").substr(0,r)}}(),function(){function E(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"x509")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var v=dreamsecurity,f=v.asn1,S=v.pki=v.pki||{},h=S.oids,u={};u.CN=h.commonName,u.commonName="CN",u.C=h.countryName,u.countryName="C",u.L=h.localityName,u.localityName="L",u.ST=h.stateOrProvinceName,u.stateOrProvinceName="ST",u.O=h.organizationName,u.organizationName="O",u.OU=h.organizationalUnitName,u.organizationalUnitName="OU",u.E=h.emailAddress,u.emailAddress="E";var e=v.pki.publicKeyValidator,t=v.pki.algIdValidator,d={name:"Certificate",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:f.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},t("Certificate.TBSCertificate.signature","Certificate.TBSCertificate.signature.algorithm","certinfoSignatureOid","Certificate.TBSCertificate.signature.parameters","certinfoSignatureParams"),{name:"Certificate.TBSCertificate.issuer",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:f.Class.UNIVERSAL,type:f.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:f.Class.UNIVERSAL,type:f.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:f.Class.UNIVERSAL,type:f.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:f.Class.UNIVERSAL,type:f.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},e,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:f.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:f.Class.UNIVERSAL,type:f.Type.BITSTRING,constructed:!1,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:f.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:f.Class.UNIVERSAL,type:f.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:f.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},t("Certificate.signatureAlgorithm","Certificate.signatureAlgorithm.algorithm","certSignatureOid","Certificate.TBSCertificate.signature.parameters","certSignatureParams"),{name:"Certificate.signatureValue",tagClass:f.Class.UNIVERSAL,type:f.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},o={name:"CertificateList",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"CertificateList.TBSCertList",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertList",value:[{name:"CertificateList.TBSCertList.version",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,capture:"crlVersion"},t("CertificateList.TBSCertList.signature","CertificateList.TBSCertList.signature.algorithm","crlSignatureOid","CertificateList.TBSCertList.signature.parameters","crlSignatureParams"),{name:"CertificateList.TBSCertList.issuer",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"crlIssuer"},{name:"CertificateList.TBSCertList.thisTime (utc)",tagClass:f.Class.UNIVERSAL,type:f.Type.UTCTIME,constructed:!1,optional:!0,capture:"thisUpdate_utcTime"},{name:"CertificateList.TBSCertList.thisTime (generalizedTime)",tagClass:f.Class.UNIVERSAL,type:f.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"thisUpdate_generalizedTime"},{name:"CertificateList.TBSCertList.nextTime (utc)",tagClass:f.Class.UNIVERSAL,type:f.Type.UTCTIME,constructed:!1,optional:!0,capture:"nextUpdate_utcTime"},{name:"CertificateList.TBSCertList.nextTime (generalizedTime)",tagClass:f.Class.UNIVERSAL,type:f.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"nextUpdate_generalizedTime"},{name:"CertificateList.TBSCertList.revokedCertificates",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"revokedCertificates"},{name:"CertificateList.TBSCertList.extensions",tagClass:f.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"crlExtensions"}]},{name:"CertificateList.signatureAlgorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"CertificateList.signatureAlgorithm.algorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,capture:"crlSignatureOid"},{name:"CertificateList.signatureAlgorithm.parameters",tagClass:f.Class.UNIVERSAL,optional:!0,captureAsn1:"crlSignatureParams"}]},{name:"CertificateList.signatureValue",tagClass:f.Class.UNIVERSAL,type:f.Type.BITSTRING,constructed:!1,capture:"signatureValue"}]},s={name:"rsapss",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:f.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:f.Class.UNIVERSAL,type:f.Class.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:f.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:f.Class.UNIVERSAL,type:f.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:f.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:f.Class.UNIVERSAL,type:f.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:f.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:f.Class.UNIVERSAL,type:f.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},e={name:"CertificationRequestInfo",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},e,{name:"CertificationRequestInfo.attributes",tagClass:f.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:f.Class.UNIVERSAL,type:f.Type.SET,constructed:!0}]}]}]},p={name:"CertificationRequest",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[e,t("CertificationRequest.signatureAlgorithm","CertificationRequest.signatureAlgorithm.algorithm","csrSignatureOid","CertificationRequest.signatureAlgorithm.parameters","csrSignatureParams"),{name:"CertificationRequest.signature",tagClass:f.Class.UNIVERSAL,type:f.Type.BITSTRING,constructed:!1,capture:"csrSignature"}]};function l(e,t){"string"==typeof t&&(t={shortName:t});for(var r,a=null,i=0;null===a&&i<e.attributes.length;++i)r=e.attributes[i],(t.type&&t.type===r.type||t.name&&t.name===r.name||t.shortName&&t.shortName===r.shortName)&&(a=r);return a}function g(e){e.altNames=[];for(var t=f.fromDer(e.value),r=0;r<t.value.length;++r){var a,i={type:(a=t.value[r]).type,value:a.value};e.altNames.push(i),S.processGeneralName(a,i)}}function m(e){for(var t=f.fromDer(e.value),r=0;r<t.value.length;++r)switch(t.value[r].type){case 0:e.keyIdentifier=t.value[r].value;break;case 1:e.authorityCertIssuer={};var a=v.md.sha1.create();e.authorityCertIssuer.attributes=v.pki.RDNAttributesAsArray(t.value[r].value[0].value[0],a);break;case 2:e.authorityCertSerialNumber=t.value[r].value}}S.RDNAttributesAsArray=function(e,t){for(var r,a,i=[],n=0;n<e.value.length;++n)for(var s=e.value[n],o=0;o<s.value.length;++o)r=s.value[o],(a={}).type=f.derToOid(r.value[0].value),a.value=r.value[1].value,a.valueTagClass=r.value[1].type,a.type in h&&(a.name=h[a.type],a.name in u&&(a.shortName=u[a.name])),t&&(t.update(a.type),t.update(a.value)),i.push(a);return i},S.CRIAttributesAsArray=function(e){for(var t=[],r=0;r<e.length;++r)for(var a=e[r],i=f.derToOid(a.value[0].value),n=a.value[1].value,s=0;s<n.length;++s){var o={};if(o.type=i,o.value=n[s].value,o.valueTagClass=n[s].type,o.type in h&&(o.name=h[o.type],o.name in u&&(o.shortName=u[o.name])),o.type===h.extensionRequest){o.extensions=[];for(var c=0;c<o.value.length;++c)o.extensions.push(S.certificateExtensionFromAsn1(o.value[c]))}t.push(o)}return t},S.processGeneralName=function(e,t){switch(e.type){case 0:if(f.derToOid(e.value[0].value)==v.pki.oids.kisa_identifyData){t.otherName={};var r=e.value[1].value[0].value;if(t.otherName.realName=v.util.decodeUtf8(r[0].value),2==r.length)for(var a=0;a<r[1].value.length;a++){var i,n=r[1].value[a].value;f.derToOid(n[0].value)==v.pki.oids.VID?(i=n[1].value,t.otherName.vid={},t.otherName.vid.hashAlg=v.pki.oids[f.derToOid(i[0].value[0].value)],t.otherName.vid.value=v.util.createBuffer(i[1].value[0].value)):f.derToOid(n[0].value)==v.pki.oids.kiec_hashedIDNInfo&&(n=n[1].value,t.otherName.hashedIdn={},t.otherName.hashedIdn.hashAlg=v.pki.oids[f.derToOid(n[0].value[0].value)],t.otherName.hashedIdn.value=v.util.createBuffer(n[1].value))}}break;case 1:case 2:break;case 4:var s=v.md.sha1.create();t.dn={},t.dn.attributes=S.RDNAttributesAsArray(e.value[0],s),t.dn.hash=s.digest().toHex();break;case 6:t.uri=e.value;break;case 7:t.ip=v.util.bytesToIP(e.value);break;case 8:t.oid=f.derToOid(e.value)}},S.processCertPolicies=function(e){for(var t=[],r=0;r<e.value.length;++r){var a={},i=e.value[r].value;if(a.policyIdentifier=f.derToOid(i[0].value),2==i.length){a.policyQualifiers={};for(var n=i[1].value,s=0;s<n.length;s++){var o,c,u=n[s].value,d=f.derToOid(u[0].value);d===v.pki.oids.cps?a.cps=u[1].value:d===v.pki.oids.unotice&&(a.unotice={},(c=0)<(o=u[1].value.length)&&u[1].value[c].type===f.Type.SEQUENCE&&((d=u[1].value[c].value)[0].type===f.Type.UTF8?a.unotice.organization=v.util.decodeUtf8(d[0].value):a.unotice.organization=d[0].value,d.length,o--,c++),0<o&&((c=u[1].value[c]).type===f.Type.UTF8?a.unotice.explicitText=v.util.decodeUtf8(c.value):a.unotice.explicitText=c.value))}}return t.push(a),t}},S.readSignatureParameters=function(e,t,r){var a={},i={},n=[];if(e===h.RSASSA_PSS){if(r&&(a={hash:{algorithmOid:h.sha1},mgf:{algorithmOid:h.mgf1,hash:{algorithmOid:h.sha1}},saltLength:20}),!f.validate(t,s,i,n)){r=new Error("Cannot read RSASSA-PSS parameter block.");throw r.errors=n,r}void 0!==i.hashOid&&(a.hash=a.hash||{},a.hash.algorithmOid=f.derToOid(i.hashOid)),void 0!==i.maskGenOid&&(a.mgf=a.mgf||{},a.mgf.algorithmOid=f.derToOid(i.maskGenOid),a.mgf.hash=a.mgf.hash||{},a.mgf.hash.algorithmOid=f.derToOid(i.maskGenHashOid)),void 0!==i.saltLength&&(a.saltLength=i.saltLength.charCodeAt(0))}else e==h.kcdsa1&&(a.domainParam=S.kcdsa.domainParamFromAsn1(t));return a},S.verifySignature=function(e,t,r,a,i,n){var s;switch(e){case h.RSASSA_PSS:var o,c,u,d=h[t.mgf.hash.algorithmOid];if(void 0===d||void 0===v.md[d])throw(u=new Error("Unsupported MGF hash function.")).oid=t.mgf.hash.algorithmOid,u.name=d,u;if(void 0===(o=h[t.mgf.algorithmOid])||void 0===v.mgf[o])throw(u=new Error("Unsupported MGF function.")).oid=t.mgf.algorithmOid,u.name=o,u;if(o=v.mgf[o].create(v.md[d].create()),void 0===(d=h[t.hash.algorithmOid])||void 0===v.md[d])throw(u=new Error("Unsupported RSASSA-PSS hash function.")).oid=t.hash.algorithmOid,u.name=d,u;d=v.md[d].create(),20===(c=t.saltLength)&&(c=d.digestLength),s=v.pss.create(d,o,c);break;case h.sha1WithRSAEncryption:case h.sha256WithRSAEncryption:case h.sha384WithRSAEncryption:case h.sha512WithRSAEncryption:case h.rsaEncryption:case h.kcdsa1:case h.kcdsa1WithSHA1:case h.kcdsa1WithSHA256:break;default:throw(u=new Error("Unsupported signature algorithm.")).oid=e,u}return"rsa"==a.algName?(r.start(),r.update(i),a.verify(r.digest().getBytes(),n,s)):"kcdsa"==a.algName?a.verify(i,r.algorithm,n):void 0};function i(e){for(var t=f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[]),r=e.attributes,a=0;a<r.length;++a){var i,n=(i=r[a]).value,s=f.Type.PRINTABLESTRING;"valueTagClass"in i&&(s=i.valueTagClass)===f.Type.UTF8&&(n=v.util.encodeUtf8(n)),n=f.create(f.Class.UNIVERSAL,f.Type.SET,!0,[f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(i.type).getBytes()),f.create(f.Class.UNIVERSAL,s,!1,n)])]),t.value.push(n)}return t}function y(e){for(var t,r,a=0;a<e.length;++a){if(void 0===(t=e[a]).name&&(t.type&&t.type in S.oids?t.name=S.oids[t.type]:t.shortName&&t.shortName in u&&(t.name=S.oids[u[t.shortName]])),void 0===t.type){if(!(t.name&&t.name in S.oids))throw(r=new Error("Attribute type not specified.")).attribute=t,r;t.type=S.oids[t.name]}if(void 0===t.shortName&&t.name&&t.name in u&&(t.shortName=u[t.name]),t.type===h.extensionRequest&&(t.valueConstructed=!0,t.valueTagClass=f.Type.SEQUENCE,!t.value&&t.extensions)){t.value=[];for(var i=0;i<t.extensions.length;++i)t.value.push(S.certificateExtensionToAsn1(n(t.extensions[i])))}if(void 0===t.value)throw(r=new Error("Attribute value not specified.")).attribute=t,r}}function n(e,t){if(t=t||{},void 0===e.name&&e.id&&e.id in S.oids&&(e.name=S.oids[e.id]),void 0===e.id){if(!(e.name&&e.name in S.oids))throw(d=new Error("Extension ID not specified.")).extension=e,d;e.id=S.oids[e.name]}if(void 0===e.value){if("keyUsage"===e.name){var r=0,a=0,i=0;e.digitalSignature&&(a|=128,r=7),e.nonRepudiation&&(a|=64,r=6),e.keyEncipherment&&(a|=32,r=5),e.dataEncipherment&&(a|=16,r=4),e.keyAgreement&&(a|=8,r=3),e.keyCertSign&&(a|=4,r=2),e.cRLSign&&(a|=2,r=1),e.encipherOnly&&(a|=1,r=0),e.decipherOnly&&(i|=128,r=7);var n=String.fromCharCode(r);0!==i?n+=String.fromCharCode(a)+String.fromCharCode(i):0!==a&&(n+=String.fromCharCode(a)),e.value=f.create(f.Class.UNIVERSAL,f.Type.BITSTRING,!1,n)}else if("basicConstraints"===e.name)e.value=f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(f.create(f.Class.UNIVERSAL,f.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(f.create(f.Class.UNIVERSAL,f.Type.INTEGER,!1,f.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[]);var s,o=e.value.value;for(s in e)!0===e[s]&&(s in h?o.push(f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(h[s]).getBytes())):-1!==s.indexOf(".")&&o.push(f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(s).getBytes())))}else if("nsCertType"===e.name){r=0,a=0;e.client&&(a|=128,r=7),e.server&&(a|=64,r=6),e.email&&(a|=32,r=5),e.objsign&&(a|=16,r=4),e.reserved&&(a|=8,r=3),e.sslCA&&(a|=4,r=2),e.emailCA&&(a|=2,r=1),e.objCA&&(a|=1,r=0);n=String.fromCharCode(r);0!==a&&(n+=String.fromCharCode(a)),e.value=f.create(f.Class.UNIVERSAL,f.Type.BITSTRING,!1,n)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[]);for(var c=0;c<e.altNames.length;++c){var u,n=(u=e.altNames[c]).value;if(7===u.type&&u.ip){if(null===(n=v.util.bytesFromIP(u.ip)))throw(d=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,d}else 8===u.type&&(n=u.oid?f.oidToDer(f.oidToDer(u.oid)):f.oidToDer(n));e.value.value.push(f.create(f.Class.CONTEXT_SPECIFIC,u.type,!1,n))}}else"subjectKeyIdentifier"===e.name&&t.cert&&(t=t.cert.generateSubjectKeyIdentifier(),e.subjectKeyIdentifier=t.toHex(),e.value=f.create(f.Class.UNIVERSAL,f.Type.OCTETSTRING,!1,t.getBytes()));if(void 0!==e.value)return e;var d;throw(d=new Error("Extension value not specified.")).extension=e,d}}S.certificateFromPem=function(e,t,r){var a=v.pem.decode(e)[0];if("CERTIFICATE"!==a.type&&"X509 CERTIFICATE"!==a.type&&"TRUSTED CERTIFICATE"!==a.type){e=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw e.headerType=a.type,e}if(a.procType&&"ENCRYPTED"===a.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");r=f.fromDer(a.body,r);return S.certificateFromAsn1(r,t)},S.certificateToPem=function(e,t){e={type:"CERTIFICATE",body:f.toDer(S.certificateToAsn1(e)).getBytes()};return v.pem.encode(e,{maxline:t})},S.publicKeyFromPem=function(e){var t=v.pem.decode(e)[0];if("PUBLIC KEY"!==t.type&&"RSA PUBLIC KEY"!==t.type){e=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw e.headerType=t.type,e}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");t=f.fromDer(t.body);return S.publicKeyFromAsn1(t)},S.publicKeyToPem=function(e,t){e={type:"PUBLIC KEY",body:f.toDer(S.publicKeyToAsn1(e)).getBytes()};return v.pem.encode(e,{maxline:t})},S.publicKeyToRSAPublicKeyPem=function(e,t){e={type:"RSA PUBLIC KEY",body:f.toDer(S.publicKeyToRSAPublicKey(e)).getBytes()};return v.pem.encode(e,{maxline:t})},S.getPublicKeyFingerprint=function(e,t){var r,a=(t=t||{}).md||v.md.sha1.create();switch(t.type||"RSAPublicKey"){case"RSAPublicKey":r=f.toDer(S.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":r=f.toDer(S.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+t.type+'".')}a.start(),a.update(r);var i=a.digest();if("hex"===t.encoding){a=i.toHex();return t.delimiter?a.match(/.{2}/g).join(t.delimiter):a}if("binary"===t.encoding)return i.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return i},S.certificationRequestFromPem=function(e,t,r){var a=v.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==a.type){e=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw e.headerType=a.type,e}if(a.procType&&"ENCRYPTED"===a.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");r=f.fromDer(a.body,r);return S.certificationRequestFromAsn1(r,t)},S.certificationRequestToPem=function(e,t){e={type:"CERTIFICATE REQUEST",body:f.toDer(S.certificationRequestToAsn1(e)).getBytes()};return v.pem.encode(e,{maxline:t})},S.createCertificate=function(){var o={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return o.siginfo.algorithmOid=null,o.validity={},o.validity.notBefore=new Date,o.validity.notAfter=new Date,o.issuer={},o.issuer.getField=function(e){return l(o.issuer,e)},o.issuer.addField=function(e){y([e]),o.issuer.attributes.push(e)},o.issuer.attributes=[],o.issuer.hash=null,o.subject={},o.subject.getField=function(e){return l(o.subject,e)},o.subject.addField=function(e){y([e]),o.subject.attributes.push(e)},o.subject.attributes=[],o.subject.hash=null,o.extensions=[],o.publicKey=null,o.md=null,o.setSubject=function(e,t){y(e),o.subject.attributes=e,delete o.subject.uniqueId,t&&(o.subject.uniqueId=t),o.subject.hash=null},o.setIssuer=function(e,t){y(e),o.issuer.attributes=e,delete o.issuer.uniqueId,t&&(o.issuer.uniqueId=t),o.issuer.hash=null},o.setExtensions=function(e){for(var t=0;t<e.length;++t)n(e[t],{cert:o});o.extensions=e},o.getExtension=function(e){"string"==typeof e&&(e={name:e});for(var t,r=null,a=0;null===r&&a<o.extensions.length;++a)t=o.extensions[a],(e.id&&t.id===e.id||e.name&&t.name===e.name)&&(r=t);return r},o.sign=function(e,t){o.md=t||v.md.sha1.create();var r=h[o.md.algorithm+"WithRSAEncryption"];if(!r){t=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw t.algorithm=o.md.algorithm,t}o.signatureOid=o.siginfo.algorithmOid=r,o.tbsCertificate=S.getTBSCertificate(o);r=f.toDer(o.tbsCertificate);o.md.update(r.getBytes()),o.signature=e.sign(o.md)},o.verify=function(e){var t=!1;if(!o.issued(e)){var r=e.issuer,a=o.subject;throw(i=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.")).expectedIssuer=r.attributes,i.actualIssuer=a.attributes,i}var i,n=e.md;if(null===n){if(e.signatureOid in h)switch(h[e.signatureOid]){case"sha1WithRSAEncryption":n=v.md.sha1.create();break;case"md5WithRSAEncryption":n=v.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA_PSS":n=v.md.sha256.create()}if(null===n)throw(i=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=e.signatureOid,i;var s=e.tbsCertificate||S.getTBSCertificate(e)}return t=null!==n?S.verifySignature(e.signatureOid,e.signatureParameters,n,o.publicKey,f.toDer(s).getBytes(),e.signature):t},o.isIssuer=function(e){var t=!1,r=o.issuer,a=e.subject;if(r.hash&&a.hash)t=r.hash===a.hash;else if(r.attributes.length===a.attributes.length)for(var i,n,t=!0,s=0;t&&s<r.attributes.length;++s)i=r.attributes[s],n=a.attributes[s],i.type===n.type&&i.value===n.value||(t=!1);return t},o.issued=function(e){return e.isIssuer(o)},o.generateSubjectKeyIdentifier=function(){return S.getPublicKeyFingerprint(o.publicKey,{type:"RSAPublicKey"})},o.verifySubjectKeyIdentifier=function(){for(var e=h.subjectKeyIdentifier,t=0;t<o.extensions.length;++t){var r=o.extensions[t];if(r.id===e){var a=o.generateSubjectKeyIdentifier().getBytes();return v.util.hexToBytes(r.subjectKeyIdentifier)===a}}return!1},o},S.certificateFromAsn1=function(e,t){E();var r={},a=[];if(!f.validate(e,d,r,a))throw(o=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.")).errors=a,o;if("string"!=typeof r.certSignature){for(var i="\0",n=0;n<r.certSignature.length;++n)i+=f.toDer(r.certSignature[n]).getBytes();r.certSignature=i}e=f.derToOid(r.publicKeyOid);if(e!==S.oids.rsaEncryption&&e!==S.oids.kcdsa1&&e!==S.oids.ecPublicKey)throw new Error("Cannot read public key. OID is unknown.");var s=S.createCertificate();s.version=r.certVersion?r.certVersion.charCodeAt(0):0;a=v.util.createBuffer(r.certSerialNumber);s.serialNumber=a.toHex(),s.signatureOid=v.asn1.derToOid(r.certSignatureOid),s.signatureParameters=v.pki.readSignatureParameters(s.signatureOid,r.certSignatureParams,!0),s.siginfo.algorithmOid=v.asn1.derToOid(r.certinfoSignatureOid),s.siginfo.parameters=v.pki.readSignatureParameters(s.siginfo.algorithmOid,r.certinfoSignatureParams,!1);a=v.util.createBuffer(r.certSignature);++a.read,s.signature=a.getBytes();var o,a=[];if(void 0!==r.certValidity1UTCTime&&a.push(f.utcTimeToDate(r.certValidity1UTCTime)),void 0!==r.certValidity2GeneralizedTime&&a.push(f.generalizedTimeToDate(r.certValidity2GeneralizedTime)),void 0!==r.certValidity3UTCTime&&a.push(f.utcTimeToDate(r.certValidity3UTCTime)),void 0!==r.certValidity4GeneralizedTime&&a.push(f.generalizedTimeToDate(r.certValidity4GeneralizedTime)),2<a.length)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(a.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(s.validity.notBefore=a[0],s.validity.notAfter=a[1],s.tbsCertificate=r.tbsCertificate,t){if(s.md=null,s.signatureOid in h)switch(e=h[s.signatureOid]){case"sha1WithRSAEncryption":s.md=v.md.sha1.create();break;case"md5WithRSAEncryption":s.md=v.md.md5.create();break;case"sha256WithRSAEncryption":case"ecdsaWithSHA256":case"RSASSA_PSS":s.md=v.md.sha256.create()}if(null===s.md)throw(o=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=s.signatureOid,o;var c=f.toDer(s.tbsCertificate);s.md.update(c.getBytes())}c=v.md.sha1.create();s.issuer.getField=function(e){return l(s.issuer,e)},s.issuer.addField=function(e){y([e]),s.issuer.attributes.push(e)},s.issuer.attributes=S.RDNAttributesAsArray(r.certIssuer,c),r.certIssuerUniqueId&&(s.issuer.uniqueId=r.certIssuerUniqueId),s.issuer.hash=c.digest().toHex();c=v.md.sha1.create();return s.subject.getField=function(e){return l(s.subject,e)},s.subject.addField=function(e){y([e]),s.subject.attributes.push(e)},s.subject.attributes=S.RDNAttributesAsArray(r.certSubject,c),r.certSubjectUniqueId&&(s.subject.uniqueId=r.certSubjectUniqueId),s.subject.hash=c.digest().toHex(),r.certExtensions?s.extensions=S.certificateExtensionsFromAsn1(r.certExtensions):s.extensions=[],s.publicKey=S.publicKeyFromAsn1(r.subjectPublicKeyInfo),s},S.certificateExtensionsFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;++r)for(var a=e.value[r],i=0;i<a.value.length;++i)t.push(S.certificateExtensionFromAsn1(a.value[i]));return t},S.certificateExtensionFromAsn1=function(e){var t={};if(t.id=f.derToOid(e.value[0].value),t.critical=!1,e.value[1].type===f.Type.BOOLEAN?(t.critical=0!==e.value[1].value.charCodeAt(0),t.value=e.value[2].value):t.value=e.value[1].value,t.id in h)if(t.name=h[t.id],"keyUsage"===t.name){var r=0,a=0;1<(i=f.fromDer(t.value)).value.length&&(r=i.value.charCodeAt(1),a=2<i.value.length?i.value.charCodeAt(2):0),t.digitalSignature=128==(128&r),t.nonRepudiation=64==(64&r),t.keyEncipherment=32==(32&r),t.dataEncipherment=16==(16&r),t.keyAgreement=8==(8&r),t.keyCertSign=4==(4&r),t.cRLSign=2==(2&r),t.encipherOnly=1==(1&r),t.decipherOnly=128==(128&a)}else if("basicConstraints"===t.name){0<(i=f.fromDer(t.value)).value.length&&i.value[0].type===f.Type.BOOLEAN?t.cA=0!==i.value[0].value.charCodeAt(0):t.cA=!1;a=null;0<i.value.length&&i.value[0].type===f.Type.INTEGER?a=i.value[0].value:1<i.value.length&&(a=i.value[1].value),null!==a&&(t.pathLenConstraint=f.derToInteger(a))}else if("extKeyUsage"===t.name)for(var i=f.fromDer(t.value),n=0;n<i.value.length;++n){var s=f.derToOid(i.value[n].value);s in h?t[h[s]]=!0:t[s]=!0}else if("nsCertType"===t.name){r=0;1<(i=f.fromDer(t.value)).value.length&&(r=i.value.charCodeAt(1)),t.client=128==(128&r),t.server=64==(64&r),t.email=32==(32&r),t.objsign=16==(16&r),t.reserved=8==(8&r),t.sslCA=4==(4&r),t.emailCA=2==(2&r),t.objCA=1==(1&r)}else if("subjectAltName"===t.name||"issuerAltName"===t.name)g(t);else if("subjectKeyIdentifier"===t.name){i=f.fromDer(t.value);t.subjectKeyIdentifier=v.util.bytesToHex(i.value)}else if("authorityKeyIdentifier"===t.name)m(t);else if("certificatePolicies"===t.name)t.certificatePolicies=S.processCertPolicies(f.fromDer(t.value));else if("policyConstraints"===t.name){i=f.fromDer(t.value);t.policyConstraints={};for(var o=0;o<i.value.length;++o)switch(i.value[o].type){case 0:t.policyConstraints.requireExplicitPolicy=f.derToInteger(i.value[o].value);break;case 1:t.policyConstraints.inhibitPolicyMapping=f.derToInteger(i.value[o].value)}}else if("cRLDistributionPoints"===t.name){i=f.fromDer(t.value);t.cRLDistributionPoints=[];for(var c={},o=0;o<i.value.length;++o){for(var u,d=i.value[o].value,p=0;p<d.length;p++)0===d[p].type&&(c.distributionPoint=[],0==(u=d[p].value[0]).type&&(S.processGeneralName(u.value[0],u={}),c.distributionPoint.push(u)));t.cRLDistributionPoints.push(c)}}else if("authorityInfoAccess"===t.name){i=f.fromDer(t.value);t.authorityInfoAccess={};for(o=0;o<i.value.length;++o){var l=i.value[o],y=f.derToOid(l.value[0].value);y==v.pki.oids.ad_ocsp?(t.authorityInfoAccess.ocsp={},S.processGeneralName(l.value[1],t.authorityInfoAccess.ocsp)):y==v.pki.oids.ad_caIssuers&&(t.authorityInfoAccess.caIssuers={},S.processGeneralName(l.value[1],t.authorityInfoAccess.caIssuers))}}return t},S.certificateRevocationListFromPem=function(e,t){var r=v.pem.decode(e)[0];if("X509 CRL"!==r.type){e=new Error('Could not convert certificate revocation list from PEM; PEM header type is not "X509 CRL".');throw e.headerType=r.type,e}if(r.procType&&"ENCRYPTED"===r.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");r=f.fromDer(r.body);return S.certificateRevocationListFromAsn1(r,t)},S.createCertificateRevocationList=function(){var o={version:1,signatureOid:null,signatureParam:null,signature:null,thisUpdate:null,nextUpdate:null,issuer:{}};return o.issuer.attributes=[],o.issuer.hash=null,o.extensions=[],o.verify=function(e){if(!o.isIssuer(e)){var t=o.issuer,r=e.subject;throw(a=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.")).expectedIssuer=t.attributes,a.actualIssuer=r.attributes,a}md=function(e){switch(e){case h.sha1WithRSAEncryption:return v.md.sha1.create();case h.md5WithRSAEncryption:return v.md.md5.create();case h.sha256WithRSAEncryption:case h.RSASSA_PSS:return v.md.sha256.create()}var t=new Error("Unknown signature oid("+e+")");throw t.signatureOid=e,t}(o.signatureOid);var a,i=v.pki.verifySignature(o.signatureOid,o.signatureParam,md,e.publicKey,f.toDer(o.tbsCertList).getBytes(),o.signature),e=new Date;if(e>o.nextUpdate)throw(a=new Error("The crl has expired. current : "+e+", expiredDate : "+o.nextUpdate)).type=v.err.expired,a;if(e<o.thisUpdate)throw new Error("The crl is not valid yet. cuurent : "+e+", validDate : "+o.thisUpdate);return i},o.isRevoked=function(e){for(var t,r=0;r<o.revokedCertsAsn1.value.length;r++)if(null!==(t=S.revokedCertFromAsn1(o.revokedCertsAsn1.value[r],e.toLowerCase()))){for(r=0;r<t.exts.length;r++)if(void 0!==t.exts[r].cRLReason)return{revocationDate:t.revocationDate,reasonCode:t.exts[r].cRLReason};return{revocationDate:t.revocationDate,reasonCode:0}}return null},o.isIssuer=function(e){var t=!1,r=o.issuer,a=e.subject;if(r.hash&&a.hash)t=r.hash===a.hash;else if(r.attributes.length===a.attributes.length)for(var i,n,t=!0,s=0;t&&s<r.attributes.length;++s)i=r.attributes[s],n=a.attributes[s],i.type===n.type&&i.value===n.value||(t=!1);return t},o},S.certificateRevocationListFromAsn1=function(e,t){E();var r={},a=[];if(!f.validate(e,o,r,a)){var i=new Error("Cannot read X.509 certificate revocation list. ASN.1 object is not an X509v2 Certificate Revocation List.");throw i.errors=a,i}if("string"!=typeof r.signatureValue){for(var n="\0",s=0;s<r.signatureValue.length;++s)n+=f.toDer(r.signatureValue[s]).getBytes();r.signatureValue=n}a=S.createCertificateRevocationList();a.version=r.crlVersion?r.crlVersion.charCodeAt(0):0,a.signatureOid=v.asn1.derToOid(r.crlSignatureOid),a.signatureParam=v.pki.readSignatureParameters(a.signatureOid,r.crlSignatureParams,!0);i=v.util.createBuffer(r.signatureValue);++i.read,a.signature=i.getBytes();i=v.md.sha1.create();return a.issuer.attributes=S.RDNAttributesAsArray(r.crlIssuer,i),a.issuer.hash=i.digest().toHex(),void 0!==r.thisUpdate_utcTime&&(a.thisUpdate=f.utcTimeToDate(r.thisUpdate_utcTime)),void 0!==r.thisUpdate_generalizedTime&&(a.thisUpdate=f.generalizedTimeToDate(r.thisUpdate_generalizedTime)),void 0!==r.nextUpdate_utcTime&&(a.nextUpdate=f.utcTimeToDate(r.nextUpdate_utcTime)),void 0!==r.nextUpdate_generalizedTime&&(a.nextUpdate=f.generalizedTimeToDate(r.nextUpdate_generalizedTime)),a.tbsCertList=r.tbsCertList,a.revokedCertsAsn1=r.revokedCertificates,r.crlExtensions?a.extensions=S.crlExtensionsFromAsn1(r.crlExtensions):a.extensions=[],a},S.crlExtensionsFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;++r)for(var a=e.value[r],i=0;i<a.value.length;++i)t.push(S.crlExtensionFromAsn1(a.value[i]));return t},S.revokedCertificatesFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;r++)t.push(S.revokedCertFromAsn1(e.value[r]));return t},S.revokedCertFromAsn1=function(e,t){var r={},a=e.value[0];if(a.type!=f.Type.INTEGER)throw new Error("Wrong revoked certificates in CRL.");if(r.userCertificate=v.util.createBuffer(a.value).toHex(),null!=t&&r.userCertificate!==t)return null;t=e.value[1];if(t.type==f.Type.UTCTIME)r.revocationDate=f.utcTimeToDate(t.value);else{if(t.type!=f.Type.GENERALIZEDTIME)throw new Error("Wrong revoked certificates in CRL.");r.revocationDate=f.generalizedTimeToDate(t.value)}if(r.exts=[],3===e.value.length)for(var i=e.value[2],n=0;n<i.value.length;n++)r.exts.push(S.crlExtensionFromAsn1(i.value[n]));return r},S.crlExtensionFromAsn1=function(e){var t,r={};return r.id=f.derToOid(e.value[0].value),r.critical=!1,e.value[1].type===f.Type.BOOLEAN?(r.critical=0!==e.value[1].value.charCodeAt(0),r.value=e.value[2].value):r.value=e.value[1].value,r.id in h&&(r.name=h[r.id],"authorityKeyIdentifier"===r.name?m(r):"issuerAltName"===r.name?g(r):"cRLNumber"===r.name?(t=f.fromDer(r.value),r.cRLNumber=f.derToInteger(t.value)):"issuingDistributionPoint"===r.name?function(e){var t=f.fromDer(e.value);e.onlyContainsUserCerts=!1,e.onlyContainsCACerts=!1,e.indirectCRL=!1,e.onlyContainsAttributeCerts=!1;for(var r=0;r<t.value.length;++r)switch(t.value[r].type){case 0:e.distributionPoint=[];var a=t.value[r].value[0];0==a.type&&(S.processGeneralName(a.value[0],a={}),e.distributionPoint.push(a));break;case 1:e.onlyContainsUserCerts=0!==t.value[r].value.charCodeAt(0);break;case 2:e.onlyContainsCACerts=0!==t.value[r].value.charCodeAt(0);break;case 3:break;case 4:e.indirectCRL=0!==t.value[r].value.charCodeAt(0);break;case 5:e.onlyContainsAttributeCerts=0!==t.value[r].value.charCodeAt(0)}}(r):"cRLReason"===r.name?(t=f.fromDer(r.value),r.cRLReason=f.derToInteger(t.value)):"invalidityDate"===r.name&&(t=f.fromDer(r.value),r.invalidityDate=f.generalizedTimeToDate(t.value))),r},S.certificationRequestFromAsn1=function(e,t){E();var r={},a=[];if(!f.validate(e,p,r,a))throw(o=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.")).errors=a,o;if("string"!=typeof r.csrSignature){for(var i="\0",n=0;n<r.csrSignature.length;++n)i+=f.toDer(r.csrSignature[n]).getBytes();r.csrSignature=i}if(f.derToOid(r.publicKeyOid)!==S.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var s=S.createCertificationRequest();s.version=r.csrVersion?r.csrVersion.charCodeAt(0):0,s.signatureOid=v.asn1.derToOid(r.csrSignatureOid),s.signatureParameters=v.pki.readSignatureParameters(s.signatureOid,r.csrSignatureParams,!0),s.siginfo.algorithmOid=v.asn1.derToOid(r.csrSignatureOid),s.siginfo.parameters=v.pki.readSignatureParameters(s.siginfo.algorithmOid,r.csrSignatureParams,!1);var o,a=v.util.createBuffer(r.csrSignature);if(++a.read,s.signature=a.getBytes(),s.certificationRequestInfo=r.certificationRequestInfo,t){if(s.md=null,s.signatureOid in h)switch(h[s.signatureOid]){case"sha1WithRSAEncryption":s.md=v.md.sha1.create();break;case"md5WithRSAEncryption":s.md=v.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA_PSS":s.md=v.md.sha256.create()}if(null===s.md)throw(o=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=s.signatureOid,o;var c=f.toDer(s.certificationRequestInfo);s.md.update(c.getBytes())}c=v.md.sha1.create();return s.subject.getField=function(e){return l(s.subject,e)},s.subject.addField=function(e){y([e]),s.subject.attributes.push(e)},s.subject.attributes=S.RDNAttributesAsArray(r.certificationRequestInfoSubject,c),s.subject.hash=c.digest().toHex(),s.publicKey=S.publicKeyFromAsn1(r.subjectPublicKeyInfo),s.getAttribute=function(e){return l(s,e)},s.addAttribute=function(e){y([e]),s.attributes.push(e)},s.attributes=S.CRIAttributesAsArray(r.certificationRequestInfoAttributes||[]),s},S.createCertificationRequest=function(){var a={version:0,signatureOid:null,signature:null,siginfo:{}};return a.siginfo.algorithmOid=null,a.subject={},a.subject.getField=function(e){return l(a.subject,e)},a.subject.addField=function(e){y([e]),a.subject.attributes.push(e)},a.subject.attributes=[],a.subject.hash=null,a.publicKey=null,a.attributes=[],a.getAttribute=function(e){return l(a,e)},a.addAttribute=function(e){y([e]),a.attributes.push(e)},a.md=null,a.setSubject=function(e){y(e),a.subject.attributes=e,a.subject.hash=null},a.setAttributes=function(e){y(e),a.attributes=e},a.sign=function(e,t){a.md=t||v.md.sha1.create();var r=h[a.md.algorithm+"WithRSAEncryption"];if(!r){t=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw t.algorithm=a.md.algorithm,t}a.signatureOid=a.siginfo.algorithmOid=r,a.certificationRequestInfo=S.getCertificationRequestInfo(a);r=f.toDer(a.certificationRequestInfo);a.md.update(r.getBytes()),a.signature=e.sign(a.md)},a.verify=function(){var e=!1,t=a.md;if(null===t){if(a.signatureOid in h)switch(h[a.signatureOid]){case"sha1WithRSAEncryption":t=v.md.sha1.create();break;case"md5WithRSAEncryption":t=v.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA_PSS":t=v.md.sha256.create()}if(null===t){var r=new Error("Could not compute certification request digest. Unknown signature OID.");throw r.signatureOid=a.signatureOid,r}r=a.certificationRequestInfo||S.getCertificationRequestInfo(a)}return e=null!==t?S.verifySignature(a.signatureOid,a.signatureParameters,t,a.publicKey,f.toDer(r).getBytes(),a.signature):e},a},S.signatureParametersToAsn1=function(e,t){switch(e){case h.RSASSA_PSS:var r=[];return void 0!==t.hash.algorithmOid&&t.hash.algorithmOid!==h.sha1&&r.push(f.create(f.Class.CONTEXT_SPECIFIC,0,!0,[f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(t.hash.algorithmOid).getBytes()),f.create(f.Class.UNIVERSAL,f.Type.NULL,!1,"")])])),void 0===t.mgf.algorithmOid||t.mgf.algorithmOid===h.mgf1&&t.mgf.hash.algorithmOid===h.sha1||r.push(f.create(f.Class.CONTEXT_SPECIFIC,1,!0,[f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(t.mgf.algorithmOid).getBytes()),f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(t.mgf.hash.algorithmOid).getBytes()),f.create(f.Class.UNIVERSAL,f.Type.NULL,!1,"")])])])),void 0!==t.saltLength&&20!==t.saltLength&&r.push(f.create(f.Class.CONTEXT_SPECIFIC,2,!0,[f.create(f.Class.UNIVERSAL,f.Type.INTEGER,!1,f.integerToDer(t.saltLength).getBytes())])),f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,r);case h.kcdsa1:return S.toKCDSAParam(t.domainParam);default:return f.create(f.Class.UNIVERSAL,f.Type.NULL,!1,"")}},S.getTBSCertificate=function(e){var t=f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.CONTEXT_SPECIFIC,0,!0,[f.create(f.Class.UNIVERSAL,f.Type.INTEGER,!1,f.integerToDer(e.version).getBytes())]),f.create(f.Class.UNIVERSAL,f.Type.INTEGER,!1,v.util.hexToBytes(e.serialNumber)),f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(e.siginfo.algorithmOid).getBytes()),S.signatureParametersToAsn1(e.siginfo.algorithmOid,e.siginfo.parameters)]),i(e.issuer),f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.UTCTIME,!1,f.dateToUtcTime(e.validity.notBefore)),f.create(f.Class.UNIVERSAL,f.Type.UTCTIME,!1,f.dateToUtcTime(e.validity.notAfter))]),i(e.subject),S.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&t.value.push(f.create(f.Class.CONTEXT_SPECIFIC,1,!0,[f.create(f.Class.UNIVERSAL,f.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&t.value.push(f.create(f.Class.CONTEXT_SPECIFIC,2,!0,[f.create(f.Class.UNIVERSAL,f.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),0<e.extensions.length&&t.value.push(S.certificateExtensionsToAsn1(e.extensions)),t},S.getCertificationRequestInfo=function(e){return f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.INTEGER,!1,f.integerToDer(e.version).getBytes()),i(e.subject),S.publicKeyToAsn1(e.publicKey),function(e){var t=f.create(f.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return t;for(var r=e.attributes,a=0;a<r.length;++a){var i=r[a],n=i.value,s=f.Type.UTF8;(s="valueTagClass"in i?i.valueTagClass:s)===f.Type.UTF8&&(n=v.util.encodeUtf8(n));var o=!1;"valueConstructed"in i&&(o=i.valueConstructed);n=f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(i.type).getBytes()),f.create(f.Class.UNIVERSAL,f.Type.SET,!0,[f.create(f.Class.UNIVERSAL,s,o,n)])]);t.value.push(n)}return t}(e)])},S.distinguishedNameToAsn1=i,S.certificateToAsn1=function(e){var t=e.tbsCertificate||S.getTBSCertificate(e);return f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[t,f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(e.signatureOid).getBytes()),S.signatureParametersToAsn1(e.signatureOid,e.signatureParameters)]),f.create(f.Class.UNIVERSAL,f.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},S.certificateExtensionsToAsn1=function(e){var t=f.create(f.Class.CONTEXT_SPECIFIC,3,!0,[]),r=f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[]);t.value.push(r);for(var a=0;a<e.length;++a)r.value.push(S.certificateExtensionToAsn1(e[a]));return t},S.certificateExtensionToAsn1=function(e){var t=f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[]);t.value.push(f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(e.id).getBytes())),e.critical&&t.value.push(f.create(f.Class.UNIVERSAL,f.Type.BOOLEAN,!1,String.fromCharCode(255)));var r=e.value;return"string"!=typeof e.value&&(r=f.toDer(r).getBytes()),t.value.push(f.create(f.Class.UNIVERSAL,f.Type.OCTETSTRING,!1,r)),t},S.certificationRequestToAsn1=function(e){var t=e.certificationRequestInfo||S.getCertificationRequestInfo(e);return f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[t,f.create(f.Class.UNIVERSAL,f.Type.SEQUENCE,!0,[f.create(f.Class.UNIVERSAL,f.Type.OID,!1,f.oidToDer(e.signatureOid).getBytes()),S.signatureParametersToAsn1(e.signatureOid,e.signatureParameters)]),f.create(f.Class.UNIVERSAL,f.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},S.createCaStore=function(e){var a={certs:{},getIssuer:function(e){var t,r=null;if(e.issuer.hash||(t=v.md.sha1.create(),e.issuer.attributes=S.RDNAttributesAsArray(i(e.issuer),t),e.issuer.hash=t.digest().toHex()),e.issuer.hash in a.certs&&(r=a.certs[e.issuer.hash],v.util.isArray(r)))throw new Error("Resolving multiple issuer matches not implemented yet.");return r},addCertificate:function(e){var t;(e="string"==typeof e?v.pki.certificateFromPem(e):e).subject.hash||(t=v.md.sha1.create(),e.subject.attributes=S.RDNAttributesAsArray(i(e.subject),t),e.subject.hash=t.digest().toHex()),e.subject.hash in a.certs?(t=a.certs[e.subject.hash],(t=!v.util.isArray(t)?[t]:t).push(e)):a.certs[e.subject.hash]=e}};if(e)for(var t=0;t<e.length;++t){var r=e[t];a.addCertificate(r)}return a},S.certificateError={bad_certificate:"dreamsecurity.pki.BadCertificate",unsupported_certificate:"dreamsecurity.pki.UnsupportedCertificate",certificate_revoked:"dreamsecurity.pki.CertificateRevoked",certificate_expired:"dreamsecurity.pki.CertificateExpired",certificate_unknown:"dreamsecurity.pki.CertificateUnknown",unknown_ca:"dreamsecurity.pki.UnknownCertificateAuthority"},S.verifyCertificateChain=function(e,t,r){E();var a=(t=t.slice(0)).slice(0),i=new Date,n=!0,s=null,o=0,c=null;do{var u=t.shift();if(i<u.validity.notBefore||i>u.validity.notAfter)s={error:S.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:i},i>u.validity.notAfter?(s.type=v.err.expired,s.message="Certificate has expired. current : "+i+", expiredDate : "+u.validity.notAfter):s.message="Certificate is not valid yet. cuurent : "+i+", validDate : "+u.validity.notBefore;else{var d=!1;if(0<t.length){c=t[0];try{d=c.verify(u)}catch(e){window&&window.console&&console.log(e);}}else{var p=e.getIssuer(u);if(null===p)s={message:"Certificate is not trusted.",error:S.certificateError.unknown_ca};else for(v.util.isArray(p)||(p=[p]);!d&&0<p.length;){c=p.shift();try{d=c.verify(u)}catch(e){window&&window.console&&console.log(e);}}}null!==s||d||(s={message:"Certificate signature is invalid.",error:S.certificateError.bad_certificate})}if(null===(s=null===s&&!u.isIssuer(c)?{message:"Certificate issuer is invalid.",error:S.certificateError.bad_certificate}:s))for(var l={keyUsage:!0,basicConstraints:!0,certificatePolicies:!0,policyConstraints:!0},y=0;null===s&&y<u.extensions.length;++y){var f=u.extensions[y];!f.critical||f.name in l||(s={message:"Certificate has an unsupported critical extension.",error:S.certificateError.unsupported_certificate})}if(null===s&&(!n||0===t.length&&!c)){var h=u.getExtension("basicConstraints"),g=u.getExtension("keyUsage");if(null!==g&&(g.keyCertSign&&null!==h||(s={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:S.certificateError.bad_certificate})),null===(s=null===s&&null!==h&&!h.cA?{message:"Certificate basicConstraints indicates the certificate is not a CA.",error:S.certificateError.bad_certificate}:s)&&null!==g&&"pathLenConstraint"in h){for(var m=0,y=1;y<t.length-1;++y)t[y].isIssuer(t[y])&&++m;var C=h.pathLenConstraint+1;t.length-m>C&&(s={message:"Certificate basicConstraints pathLenConstraint violated.",error:S.certificateError.bad_certificate})}}h=null===s||s.error,C=r?r(h,o,a):h;if(!0!==C)throw!0===h&&(s={message:"The application rejected the certificate.",error:S.certificateError.bad_certificate}),!C&&0!==C||("object"!=typeof C||v.util.isArray(C)?"string"==typeof C&&(s.error=C):(C.message&&(s.message=C.message),C.error&&(s.error=C.error))),s}while(s=null,n=!1,++o,0<t.length);return!0}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var e=dreamsecurity,t=e.asn1,r=e.pkcs7asn1=e.pkcs7asn1||{};e.pkcs7=e.pkcs7||{},e.pkcs7.asn1=r;var a=e.pki.algIdValidator,e={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};r.contentInfoValidator=e;a={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},a("EncryptedContentInfo.contentEncryptionAlgorithm","EncryptedContentInfo.contentEncryptionAlgorithm.algorithm","encAlgorithm","EncryptedContentInfo.contentEncryptionAlgorithm.parameter","encParameter"),{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};r.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(a)},r.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(a)},r.attributeValidator={name:"Attribute",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,capture:"values"}]},r.signerValidator={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignerInfo.IssuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.DigestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"digestAlgorithm"},{name:"SignerInfo.AuthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.DigestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"digestEncAlgorithm"},{name:"SignerInfo.EncryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.UnauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0}]},r.tbsDataSignedAttributes={name:"authenticatedAttributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,capture:"authenticatedAttributes"},r.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},e,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",constructed:!0,optional:!0}]},r.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"keyEncryptionAlgorithm"},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]},r.signedAndEnvelopedDataValidator={name:"SignedAndEnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedAndEnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedAndEnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"},{name:"SignedAndEnvelopedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},a,{name:"SignedAndEnvelopedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedAndEnvelopedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedAndEnvelopedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",constructed:!0,optional:!0}]}}(),function(){function e(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pkcs7")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var C=dreamsecurity,h=C.asn1,g=C.pkcs7=C.pkcs7||{};g.messageFromPem=function(e){var t=C.pem.decode(e)[0];if("PKCS7"!==t.type){e=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw e.headerType=t.type,e}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");t=h.fromDer(t.body);return g.messageFromAsn1(t)},g.messageToPem=function(e,t){e={type:"PKCS7",body:h.toDer(e.toAsn1()).getBytes()};return C.pem.encode(e,{maxline:t})},g.messageFromAsn1=function(e){var t={},r=[];if(!h.validate(e,g.asn1.contentInfoValidator,t,r)){e=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw e.errors=r,e}var a,i=h.derToOid(t.contentType);switch(i){case C.pki.oids.envelopedData:a=g.createEnvelopedData();break;case C.pki.oids.encryptedData:a=g.createEncryptedData();break;case C.pki.oids.signedData:a=g.createSignedData();break;case C.pki.oids.signedAndEnvelopedData:a=g.createSignedAndEnvelopedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+i+" is not (yet) supported.")}return a.fromAsn1(t.content.value[0]),a};function a(e){for(var t=[],r=0;r<e.length;r++)t.push(function(e){var t={},r=[];if(!h.validate(e,g.asn1.recipientInfoValidator,t,r))throw(n=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.")).errors=r,n;var a=h.derToOid(t.keyEncryptionAlgorithm[0].value),i=null;if(a===C.pki.oids.RSAES_OAEP){e={};if(!h.validate(t.keyEncryptionAlgorithm[1],C.pkcs1.asn1.rsaoaepParamValidator,e,r))throw(n=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.")).errors=r,n;var n="sha1";void 0!==e.hashAlgorithm&&(e=h.derToOid(e.hashAlgorithm[0].value),n=C.pki.oids[e].toLowerCase()),i={md:C.md.algorithms[n].create()}}return{version:t.version.charCodeAt(0),issuer:C.pki.RDNAttributesAsArray(t.issuer),serialNumber:C.util.createBuffer(t.serial).toHex(),encryptedContent:{algorithm:a,parameter:i,content:t.encKey}}}(e[r]));return t}function r(e){for(var t,r=[],a=0;a<e.length;a++)r.push((t=e[a],h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,h.integerToDer(t.version).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[C.pki.distinguishedNameToAsn1({attributes:t.issuer}),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,C.util.hexToBytes(t.serialNumber))]),h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(t.encryptedContent.algorithm).getBytes()),E(t.encryptedContent.parameter)]),h.create(h.Class.UNIVERSAL,h.Type.OCTETSTRING,!1,t.encryptedContent.content)])));return r}function i(e){return[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(C.pki.oids.data).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(e.algorithm).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.OCTETSTRING,!1,e.parameter.getBytes())]),h.create(h.Class.CONTEXT_SPECIFIC,0,!1,e.content.getBytes())]}function n(e){for(var t=[],r=0;r<e.length;r++)t.push(function(e){var t={},r=[];if(h.validate(e,C.pki.algIdValidator("mdAlg","mdOid","mdOid","mdParam","mdParam"),t,r))return h.derToOid(t.mdOid);t=new Error("Cannot read PKCS#7 message. ASN.1 object is not an MessageDigestAlgorithm.");throw t.errors=r,t}(e[r]));return t}function s(e){for(var t=[],r=0;r<e.length;r++)t.push(h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(e[r]).getBytes())]));return t}var m=function(e){var t,r={};if(e.authenticatedAttributes.length)for(var a=0;a<e.authenticatedAttributes.length;a++)(t=f(e.authenticatedAttributes[a])).oid===C.pki.oids.contentType?r.vContentType=h.derToOid(t.values[0].value):t.oid===C.pki.oids.messageDigest?r.vMmessageDigest=t.values[0].value:t.oid===C.pki.oids.signingTime?r.vSigningTime=h.utcTimeToDate(t.values[0].value):t.oid!==C.pki.oids.signingCertificate&&t.oid!==C.pki.oids.signingCertificateV2||(r.vSigningCert={},r.vSigningCert.oid=t.oid,r.vSigningCert.value=t.values[0].value);return r};g.attrFromAsn1=function(e){return f(e)};function o(e){return e=C.pki.oids[e],h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(e).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.NULL,!1,"")])}function c(e){for(var t=[],r=0;r<e.length;r++)t.push(function(e){var t={},r=[];if(!h.validate(e,g.asn1.signerValidator,t,r)){var a=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 SignedData.");throw a.errors=r,a}r=null;null!=t.authenticatedAttributes&&null!=t.authenticatedAttributes&&(i=m(t),r={derEncoded:t.authenticatedAttributes,contentType:i.vContentType,messageDigest:i.vMmessageDigest,signingTime:i.vSigningTime,signingCert:i.vSigningCert});var a=h.derToOid(t.digestEncAlgorithm[0].value),i=C.pki.readSignatureParameters(a,t.digestEncAlgorithm[1],!0);return{version:t.version.charCodeAt(0),issuer:C.pki.RDNAttributesAsArray(t.issuer),serialNumber:C.util.createBuffer(t.serial).toHex(),signedAttrs:r,signature:{algorithm:a,parameter:i,digestAlgorithm:h.derToOid(t.digestAlgorithm[0].value),content:t.signature},certificate:null}}(e[r]));return t}function u(e){for(var t=[],r=0;r<e.length;r++)t.push(function(e){var t=h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,h.integerToDer(e.version).getBytes()),r=h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[C.pki.distinguishedNameToAsn1({attributes:e.issuer}),h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,C.util.hexToBytes(e.serialNumber))]),a=h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(e.signature.digestAlgorithm).getBytes())]),i=h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(e.signature.algorithm).getBytes()),C.pki.signatureParametersToAsn1(e.signature.algorithm,e.signature.parameter)]),n=h.create(h.Class.UNIVERSAL,h.Type.OCTETSTRING,!1,e.signature.content);if(null==e.signedAttrs||null==e.signedAttrs)return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[t,r,a,i,n]);var s=null,s=e.signedAttrs.derEncoded?h.create(h.Class.CONTEXT_SPECIFIC,0,!0,e.signedAttrs.derEncoded):h.create(h.Class.CONTEXT_SPECIFIC,0,!0,v(e.signedAttrs.contentType,e.signedAttrs.signingTime,e.signedAttrs.messageDigest,e.signedAttrs.signingCert));return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[t,r,a,s,i,n])}(e[r]));return t}function d(e,t,r){if(e.length===t.length){for(var a=0;a<t.length;++a)if(r){if(e[a].value!==t[a].value)return}else if(e[a].type!==t[a].type||e[a].value!==t[a].value)return;return 1}}function p(e,t){for(var r=0;r<t.length;++r){var a=t[r];if(e.serialNumber===a.serialNumber){if(d(a.issuer.attributes,e.issuer,!1))return r;if(d(a.subject.attributes,e.issuer,!0))return r}}throw new Error("The signer certificate is not exist.")}function l(e,t,r){var a={};if(!h.validate(t,r,a,[])){r=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw r.errors=r}if(e.contentType=h.derToOid(a.contentType),a.encryptedContent){var i="";if(C.util.isArray(a.encryptedContent))for(var n=0;n<a.encryptedContent.length;++n){if(a.encryptedContent[n].type!==h.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");i+=a.encryptedContent[n].value}else i=a.encryptedContent;e.encryptedContent={algorithm:h.derToOid(a.encAlgorithm),parameter:C.util.createBuffer(a.encParameter.value),content:C.util.createBuffer(i)}}return null!=a.content?e.content=a.content.value[0].value:e.content=null,e.version=a.version.charCodeAt(0),a}function y(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content||null==e.content){var t;switch(e.encryptedContent.algorithm){case C.pki.oids["aes128-CBC"]:case C.pki.oids["aes192-CBC"]:case C.pki.oids["aes256-CBC"]:t=C.aes.createDecryptionCipher(e.encryptedContent.key);break;case C.pki.oids.desCBC:case C.pki.oids["des-EDE3-CBC"]:t=C.des.createDecryptionCipher(e.encryptedContent.key);break;case C.pki.oids.seedCBC:t=C.seed.createDecryptionCipher(e.encryptedContent.key);break;case C.pki.oids.ariaCBC:case C.pki.oids["aria128-CBC"]:case C.pki.oids["aria192-CBC"]:case C.pki.oids["aria256-CBC"]:t=C.aria.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}}var f=function(e){var t={},r=[];if(h.validate(e,g.asn1.attributeValidator,t,r))return{oid:h.derToOid(t.oid),values:[t.values[0]]};t=new Error("There is a invalid attribute in SignedAttributes.");throw t.errors=r,t},E=function(e){if(null==e)return h.create(h.Class.UNIVERSAL,h.Type.NULL,!1,"");var t=[];return"sha1"!==e.md.algorithm&&(t.push(h.create(h.Class.CONTEXT_SPECIFIC,0,!0,[o(e.md.algorithm)])),t.push(h.create(h.Class.CONTEXT_SPECIFIC,1,!0,[h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(C.pki.oids.mgf1).getBytes()),o(e.md.algorithm)])]))),h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,t)},v=function(e,t,r,a){var i=[];return i.push(h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(C.pki.oids.contentType).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(e).getBytes())])])),t&&i.push(h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(C.pki.oids.signingTime).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,[h.create(h.Class.UNIVERSAL,h.Type.UTCTIME,!1,h.dateToUtcTime(t))])])),i.push(h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(C.pki.oids.messageDigest).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,[h.create(h.Class.UNIVERSAL,h.Type.OCTETSTRING,!1,r)])])),a&&i.push(h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(a.oid).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,[h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,a.value)])])),S(i)},S=function(e){for(var t,r=[],a=[],i=0,n=0,i=0;i<e.length;++i)r[i]={idx:i,bytes:h.toDer(e[i]).getBytes()};for(i=r.length-1;0<i;i--)for(n=0;n<i;n++)0<I(r[n].bytes,r[n+1].bytes)&&(t={idx:r[n].idx,bytes:r[n].bytes},r[n].idx=r[n+1].idx,r[n].bytes=r[n+1].bytes,r[n+1].idx=t.idx,r[n+1].bytes=t.bytes);for(i=0;i<r.length;i++)a.push(e[r[i].idx]);return a},I=function(e,t){for(var r=0,r=(e.length>t.length?t:e).length,a=0;a<r;a++)if(e[a]!=t[a])return e[a]>t[a]?1:-1;return e.length==t.length?0:e.length>t.length?1:-1};g.createSignedData=function(){e();var f=null;return f={type:C.pki.oids.signedData,version:1,certificates:[],crls:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(e){e=l(f,e,g.asn1.signedDataValidator);f.certificates=[],f.crls=[],f.digestAlgorithmIdentifiers=[],f.contentInfo=null,f.signerInfos=[];for(var t=e.certificates.value,r=0;r<t.length;++r)16==t[r].type&&f.certificates.push(C.pki.certificateFromAsn1(t[r]));f.digestAlgorithmIdentifiers=n(e.digestAlgorithms.value),e.signerInfos&&(f.signerInfos=c(e.signerInfos))},toAsn1:function(){f.contentInfo||f.sign();for(var e=[],t=0;t<f.certificates.length;++t)e.push(C.pki.certificateToAsn1(f.certificates[t]));return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(f.type).getBytes()),h.create(h.Class.CONTEXT_SPECIFIC,0,!0,[h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,h.integerToDer(f.version).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,s(f.digestAlgorithmIdentifiers)),f.contentInfo,h.create(h.Class.CONTEXT_SPECIFIC,0,!0,e),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,u(f.signerInfos))])])])},sign:function(e,t,r,a,i,n){if("object"!=typeof f.content&&(f.contentInfo=h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(C.pki.oids.data).getBytes())]),2&i||"content"in f&&f.contentInfo.value.push(h.create(h.Class.CONTEXT_SPECIFIC,0,!0,[h.create(h.Class.UNIVERSAL,h.Type.OCTETSTRING,!1,f.content)]))),(void 0===n||void 0===n.setContent||!0!==n.setContent)&&null!=e){for(var s=0,o=!1,s=0;s<f.digestAlgorithmIdentifiers.length;s++)if(f.digestAlgorithmIdentifiers[s]==C.pki.oids[r.algorithm]){o=!0;break}o||f.digestAlgorithmIdentifiers.push(C.pki.oids[r.algorithm]);var c=null,u=null,d=null;if(32&i||4&i){if(16&i)throw new Error("The SignGateFormat and messageDigestContent is not supported.");d=f.content}else if(void 0!==n&&void 0!==n.composeSignedData&&1==n.composeSignedData){if(void 0===n.tbsData)throw new Error("The TBSData(SignedAttributes) is required to compose SignedData.");var p=function(e){var t={},r=[],e=dreamsecurity.asn1.fromDer(e);if(h.validate(e,g.asn1.tbsDataSignedAttributes,t,r))return m(t);t=new Error("The SignedAttributes is not a exptected format.");throw t.errors=r,t}(d=n.tbsData),c=p.vSigningTime,u=p.vMmessageDigest}else{if(u=16&i?f.content:(r.update(f.content),r.digest().getBytes()),n&&n.signingTime){if(!(n.signingTime instanceof Date))throw new Error("The signingTime is not an instance of Date.");c=n.signingTime}else c=new Date;var l=v(C.pki.oids.data,c,u,null),y=h.create(h.Class.UNIVERSAL,h.Type.SET,!0,l);if(void 0!==n&&void 0!==n.makeSignedAttributes&&!0===n.makeSignedAttributes)return h.toDer(y);d=h.toDer(y).getBytes()}p="",l={},y=null;if(void 0!==n&&void 0!==n.composeSignedData&&1==n.composeSignedData){if(void 0===n.signature)throw new Error("The signature is required to compose SignedData.");y=n.signature}if("rsa"===e.publicKey.algName)"string"==typeof a?p=C.pki.oids.rsaEncryption:(p=C.pki.oids.RSASSA_PSS,n=a.mgf.split("-"),l={hash:{algorithmOid:C.pki.oids[a.md]},mgf:{algorithmOid:C.pki.oids[n[0]],hash:{algorithmOid:C.pki.oids[n[1]]}},saltLength:a.saltLength}),y||(r.start(),r.update(d),y=t.sign(r,a));else{if("kcdsa"!==e.publicKey.algName)throw new Error("The algorithm("+t.algName+") is not supported.");p=C.pki.oids.kcdsa1,l={domainParam:e.publicKey},y=y||t.sign(d,r.algorithm,e.publicKey.y)}l={algorithm:p,parameter:l,digestAlgorithm:C.pki.oids[r.algorithm],content:y},y=null,y=4&i?{version:1,issuer:e.subject.attributes,serialNumber:e.serialNumber,signature:l}:32&i?{version:1,issuer:e.issuer.attributes,serialNumber:e.serialNumber,signature:l}:{version:1,issuer:e.issuer.attributes,serialNumber:e.serialNumber,signedAttrs:{contentType:C.pki.oids.data,signingTime:c,messageDigest:u},signature:l};f.signerInfos.push(y),f.certificates.push(e)}},verify:function(){for(var e=0;e<f.signerInfos.length;e++){var t=f.signerInfos[e],r=t.signedAttrs,a=null;t.certIndex=p(t,f.certificates);var i=C.oids[t.signature.digestAlgorithm];if(!i)throw new Error("The digest algorithm("+t.signature.digestAlgorithm+") is not supported.");a=C.md.algorithms[i].create(),i=null;if(null==r)i=f.content;else{if(a.update(f.content),a.digest().toHex()!==C.util.bytesToHex(r.messageDigest))throw new Error("The data integrity is damaged.");i=h.toDer(h.create(h.Class.UNIVERSAL,h.Type.SET,!0,r.derEncoded)).getBytes()}if(!C.pki.verifySignature(t.signature.algorithm,t.signature.parameter,a,f.certificates[t.certIndex].publicKey,i,t.signature.content))return!1}return!0},getSignerInfos:function(){for(var e=0,t=[],e=0;e<f.signerInfos.length;e++){var r=f.signerInfos[e].signedAttrs;t.push({certIndex:f.signerInfos[e].certIndex,signingTime:null!=r?r.signingTime:null})}return t},addCertificate:function(e){"string"==typeof e&&(e=C.pki.certificateFromPem(e)),f.certificates.push(e)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}}},g.createEncryptedData=function(){e();var t=null;return t={type:C.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:C.pki.oids["aes256-CBC"]},fromAsn1:function(e){l(t,e,g.asn1.encryptedDataValidator)},decrypt:function(e){void 0!==e&&(t.encryptedContent.key=e),y(t)}}},g.createEnvelopedData=function(){e();var o=null;return o={type:C.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:C.pki.oids["aes256-CBC"]},fromAsn1:function(e){e=l(o,e,g.asn1.envelopedDataValidator);o.recipients=a(e.recipientInfos.value)},toAsn1:function(){return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(o.type).getBytes()),h.create(h.Class.CONTEXT_SPECIFIC,0,!0,[h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,h.integerToDer(o.version).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,r(o.recipients)),h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,i(o.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,r=0;r<o.recipients.length;++r){var a=o.recipients[r],i=a.issuer;if(a.serialNumber===e.serialNumber&&i.length===t.length){for(var n=!0,s=0;s<t.length;++s)if(i[s].type!==t[s].type||i[s].value!==t[s].value){n=!1;break}if(n)return a}}return null},decrypt:function(e,t){if(void 0===o.encryptedContent.key&&void 0!==e&&void 0!==t)switch(e.encryptedContent.algorithm){case C.pki.oids.rsaEncryption:case C.pki.oids.desCBC:var r=t.decrypt(e.encryptedContent.content);o.encryptedContent.key=C.util.createBuffer(r);break;case C.pki.oids.RSAES_OAEP:r=t.decrypt(e.encryptedContent.content,"RSA-OAEP",e.encryptedContent.parameter);o.encryptedContent.key=C.util.createBuffer(r);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}y(o)},addRecipient:function(e,t,r){var a=null,i=void 0;null==t||"RSAES-PKCS1-V1_5"===t?a=C.pki.oids.rsaEncryption:(a=C.pki.oids.RSAES_OAEP,i=r),o.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:a,parameter:i,key:e.publicKey}})},encrypt:function(e,t){if(void 0===o.encryptedContent.content){var r,a,i;switch(t=t||o.encryptedContent.algorithm,e=e||o.encryptedContent.key,t){case C.pki.oids["aes128-CBC"]:a=r=16,i=C.aes.createEncryptionCipher;break;case C.pki.oids["aes192-CBC"]:r=24,a=16,i=C.aes.createEncryptionCipher;break;case C.pki.oids["aes256-CBC"]:r=32,a=16,i=C.aes.createEncryptionCipher;break;case C.pki.oids["des-EDE3-CBC"]:r=24,a=8,i=C.des.createEncryptionCipher;break;case C.pki.oids.seedCBC:a=r=16,i=C.seed.createEncryptionCipher;break;case C.pki.oids.ariaCBC:case C.pki.oids["aria128-CBC"]:a=r=16,i=C.aria.createEncryptionCipher;break;case C.pki.oids["aria192-CBC"]:r=24,a=16,i=C.aria.createEncryptionCipher;break;case C.pki.oids["aria256-CBC"]:r=32,a=16,i=C.aria.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(void 0===e)e=C.util.createBuffer(C.random.getBytes(r));else if(e.length()!=r)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+r+".");o.encryptedContent.algorithm=t,o.encryptedContent.key=e,o.encryptedContent.parameter=C.util.createBuffer(C.random.getBytes(a));e=i(e);if(e.start(o.encryptedContent.parameter.copy()),e.update(o.content),!e.finish())throw new Error("Symmetric encryption failed.");o.encryptedContent.content=e.output}for(var n=0;n<o.recipients.length;n++){var s=o.recipients[n];if(void 0===s.encryptedContent.content)switch(s.encryptedContent.algorithm){case C.pki.oids.rsaEncryption:s.encryptedContent.content=s.encryptedContent.key.encrypt(o.encryptedContent.key.data);break;case C.pki.oids.RSAES_OAEP:s.encryptedContent.content=s.encryptedContent.key.encrypt(o.encryptedContent.key.data,"RSA-OAEP",s.encryptedContent.parameter);break;default:throw new Error("Unsupported asymmetric cipher, OID "+s.encryptedContent.algorithm)}}}}},g.createSignedAndEnvelopedData=function(){e();var m=null;return m={type:C.pki.oids.signedAndEnvelopedData,version:1,recipients:[],digestAlgorithmIdentifiers:[],encryptedContent:{algorithm:C.pki.oids["aes256-CBC"]},certificates:[],crls:[],signerInfos:[],fromAsn1:function(e){e=l(m,e,g.asn1.signedAndEnvelopedDataValidator);m.recipients=a(e.recipientInfos.value),m.digestAlgorithmIdentifiers=[],m.certificates=[],m.crls=[],m.signerInfos=[];for(var t=e.certificates.value,r=0;r<t.length;++r)m.certificates.push(C.pki.certificateFromAsn1(t[r]));e.signerInfos&&(m.signerInfos=c(e.signerInfos))},toAsn1:function(){for(var e=[],t=0;t<m.certificates.length;++t)e.push(C.pki.certificateToAsn1(m.certificates[t]));return h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.OID,!1,h.oidToDer(m.type).getBytes()),h.create(h.Class.CONTEXT_SPECIFIC,0,!0,[h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,[h.create(h.Class.UNIVERSAL,h.Type.INTEGER,!1,h.integerToDer(m.version).getBytes()),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,r(m.recipients)),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,s(m.digestAlgorithmIdentifiers)),h.create(h.Class.UNIVERSAL,h.Type.SEQUENCE,!0,i(m.encryptedContent)),h.create(h.Class.CONTEXT_SPECIFIC,0,!0,e),h.create(h.Class.UNIVERSAL,h.Type.SET,!0,u(m.signerInfos))])])])},signAndEnv:function(e,t,r,a,i,n,s){m.digestAlgorithmIdentifiers.push(C.pki.oids[r.algorithm]);var o,c=m.content.getBytes(),u="",d={},p=null;if("rsa"==t.algName)"string"==typeof a?u=C.pki.oids.rsaEncryption:(u=C.pki.oids.RSASSA_PSS,o=a.mgf.split("-"),d={hash:{algorithmOid:C.pki.oids[a.md]},mgf:{algorithmOid:C.pki.oids[o[0]],hash:{algorithmOid:C.pki.oids[o[1]]}},saltLength:a.saltLength}),r.start(),r.update(c),p=t.sign(r,a);else{if("kcdsa"!=t.algName)throw new Error("The algorithm("+t.algName+") is not supported.");u=C.pki.oids.kcdsa1,d={domainParam:e.publicKey},p=t.sign(c,r.algorithm,e.publicKey.y)}var l,y,f,a=null,t=null;if(void 0===m.encryptedContent.content){switch(s=s||m.encryptedContent.algorithm,n=n||m.encryptedContent.key,s){case C.pki.oids["aes128-CBC"]:y=l=16,f=C.aes.createEncryptionCipher;break;case C.pki.oids["aes192-CBC"]:l=24,y=16,f=C.aes.createEncryptionCipher;break;case C.pki.oids["aes256-CBC"]:l=32,y=16,f=C.aes.createEncryptionCipher;break;case C.pki.oids["des-EDE3-CBC"]:l=24,y=8,f=C.des.createEncryptionCipher;break;case C.pki.oids.seedCBC:y=l=16,f=C.seed.createEncryptionCipher;break;case C.pki.oids.ariaCBC:case C.pki.oids["aria128-CBC"]:y=l=16,f=C.aria.createEncryptionCipher;break;case C.pki.oids["aria192-CBC"]:l=24,y=16,f=C.aria.createEncryptionCipher;break;case C.pki.oids["aria256-CBC"]:l=32,y=16,f=C.aria.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+s)}if(void 0===n)n=C.util.createBuffer(C.random.getBytes(l));else if(n.length()!=l)throw new Error("Symmetric key has wrong length; got "+n.length()+" bytes, expected "+l+".");m.encryptedContent.algorithm=s,m.encryptedContent.key=n,m.encryptedContent.parameter=C.util.createBuffer(C.random.getBytes(y));n=f(n);if(n.start(m.encryptedContent.parameter.copy()),n.update(C.util.createBuffer(c)),!n.finish())throw new Error("Symmetric encryption failed.");if(t=n.output,n.start(m.encryptedContent.parameter.copy()),n.update(C.util.createBuffer(p)),!n.finish())throw new Error("Symmetric encryption failed.");a=n.output}for(var h=0;h<m.recipients.length;h++){var g=m.recipients[h];if(void 0===g.encryptedContent.content)switch(g.encryptedContent.algorithm){case C.pki.oids.rsaEncryption:g.encryptedContent.content=g.encryptedContent.key.encrypt(m.encryptedContent.key.data);break;case C.pki.oids.RSAES_OAEP:g.encryptedContent.content=g.encryptedContent.key.encrypt(m.encryptedContent.key.data,"RSA-OAEP",g.encryptedContent.parameter);break;default:throw new Error("Unsupported asymmetric cipher, OID "+g.encryptedContent.algorithm)}}a={algorithm:u,parameter:d,digestAlgorithm:C.pki.oids[r.algorithm],content:a.getBytes()},a={version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,signature:a};m.signerInfos.push(a),m.certificates.push(e),m.encryptedContent.content=t},verifyAndDec:function(e,t){if(void 0===m.encryptedContent.key&&void 0!==e&&void 0!==t)switch(e.encryptedContent.algorithm){case C.pki.oids.rsaEncryption:case C.pki.oids.desCBC:var r=t.decrypt(e.encryptedContent.content);m.encryptedContent.key=C.util.createBuffer(r);break;case C.pki.oids.RSAES_OAEP:r=t.decrypt(e.encryptedContent.content,"RSA-OAEP",e.encryptedContent.parameter);m.encryptedContent.key=C.util.createBuffer(r);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}if(void 0===m.encryptedContent.key)throw new Error("Symmetric key not available.");var a=null;if(void 0===m.content||null==m.content){switch(m.encryptedContent.algorithm){case C.pki.oids["aes128-CBC"]:case C.pki.oids["aes192-CBC"]:case C.pki.oids["aes256-CBC"]:a=C.aes.createDecryptionCipher(m.encryptedContent.key);break;case C.pki.oids.desCBC:case C.pki.oids["des-EDE3-CBC"]:a=C.des.createDecryptionCipher(m.encryptedContent.key);break;case C.pki.oids.seedCBC:a=C.seed.createDecryptionCipher(m.encryptedContent.key);break;case C.pki.oids.ariaCBC:case C.pki.oids["aria128-CBC"]:case C.pki.oids["aria192-CBC"]:case C.pki.oids["aria256-CBC"]:a=C.aria.createDecryptionCipher(m.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+m.encryptedContent.algorithm)}if(a.start(m.encryptedContent.parameter.copy()),a.update(m.encryptedContent.content),!a.finish())throw new Error("Symmetric decryption failed.");m.content=a.output}for(var i=0;i<m.signerInfos.length;i++){var n=m.signerInfos[i],s=null;if(n.certIndex=p(n,m.certificates),n.signature.digestAlgorithm===C.pki.oids.sha1)s=C.md.sha1.create();else{if(n.signature.digestAlgorithm!==C.pki.oids.sha256)throw new Error("The digest algorithm("+n.signature.digestAlgorithm+") is not supported.");s=C.md.sha256.create()}var o=m.content.copy();if(a.start(m.encryptedContent.parameter.copy()),a.update(C.util.createBuffer(n.signature.content)),!a.finish())throw new Error("Symmetric decryption failed.");var c=a.output;if(!C.pki.verifySignature(n.signature.algorithm,n.signature.parameter,s,m.certificates[n.certIndex].publicKey,o.getBytes(),c.getBytes()))return!1}return!0},getSignerInfos:function(){for(var e=0,t=[],e=0;e<m.signerInfos.length;e++){var r=m.signerInfos[e].signedAttrs;t.push({certIndex:m.signerInfos[e].certIndex,signingTime:null!=r?r.signingTime:null})}return t},addCertificate:function(e){"string"==typeof e&&(e=C.pki.certificateFromPem(e)),m.certificates.push(e)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")},findRecipient:function(e){for(var t=e.issuer.attributes,r=0;r<m.recipients.length;++r){var a=m.recipients[r],i=a.issuer;if(a.serialNumber===e.serialNumber&&i.length===t.length){for(var n=!0,s=0;s<t.length;++s)if(i[s].type!==t[s].type||i[s].value!==t[s].value){n=!1;break}if(n)return a}}return null},addRecipient:function(e,t,r){var a=null,i=void 0;null==t||"RSAES-PKCS1-V1_5"===t?a=C.pki.oids.rsaEncryption:(a=C.pki.oids.RSAES_OAEP,i=r),m.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:a,parameter:i,key:e.publicKey}})},encrypt:function(e,t){if(void 0===m.encryptedContent.content){var r,a,i;switch(t=t||m.encryptedContent.algorithm,e=e||m.encryptedContent.key,t){case C.pki.oids["aes128-CBC"]:a=r=16,i=C.aes.createEncryptionCipher;break;case C.pki.oids["aes192-CBC"]:r=24,a=16,i=C.aes.createEncryptionCipher;break;case C.pki.oids["aes256-CBC"]:r=32,a=16,i=C.aes.createEncryptionCipher;break;case C.pki.oids["des-EDE3-CBC"]:r=24,a=8,i=C.des.createEncryptionCipher;break;case C.pki.oids.seedCBC:a=r=16,i=C.seed.createEncryptionCipher;break;case C.pki.oids.ariaCBC:case C.pki.oids["aria128-CBC"]:a=r=16,i=C.aria.createEncryptionCipher;break;case C.pki.oids["aria192-CBC"]:r=24,a=16,i=C.aria.createEncryptionCipher;break;case C.pki.oids["aria256-CBC"]:r=32,a=16,i=C.aria.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(void 0===e)e=C.util.createBuffer(C.random.getBytes(r));else if(e.length()!=r)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+r+".");m.encryptedContent.algorithm=t,m.encryptedContent.key=e,m.encryptedContent.parameter=C.util.createBuffer(C.random.getBytes(a));e=i(e);if(e.start(m.encryptedContent.parameter.copy()),e.update(m.content),!e.finish())throw new Error("Symmetric encryption failed.");m.encryptedContent.content=e.output}for(var n=0;n<m.recipients.length;n++){var s=m.recipients[n];if(void 0===s.encryptedContent.content)switch(s.encryptedContent.algorithm){case C.pki.oids.rsaEncryption:s.encryptedContent.content=s.encryptedContent.key.encrypt(m.encryptedContent.key.data);break;case C.pki.oids.RSAES_OAEP:s.encryptedContent.content=s.encryptedContent.key.encrypt(m.encryptedContent.key.data,"RSA-OAEP",s.encryptedContent.parameter);break;default:throw new Error("Unsupported asymmetric cipher, OID "+s.encryptedContent.algorithm)}}}}}}(),function(){function S(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pkcs12")}"undefined"==typeof dreamsecurity&&(dreamsecurity={});var I=dreamsecurity,T=I.asn1,A=I.pki,b=I.pkcs12=I.pkcs12||{},y={name:"ContentInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:T.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},p={name:"PFX",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"version"},y,{name:"PFX.macData",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:T.Class.UNIVERSAL,optional:!0,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:T.Class.UNIVERSAL,type:T.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:T.Class.UNIVERSAL,type:T.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},f={name:"SafeBag",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:T.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:T.Class.UNIVERSAL,type:T.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},h={name:"Attribute",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:T.Class.UNIVERSAL,type:T.Type.SET,constructed:!0,capture:"values"}]},g={name:"CertBag",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:T.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:T.Class.UNIVERSAL,type:T.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};function l(e,t,r,a){for(var i=[],n=0;n<e.length;n++)for(var s=0;s<e[n].safeBags.length;s++){var o=e[n].safeBags[s];void 0!==a&&o.type!==a||(null===t||void 0!==o.attributes[t]&&0<=o.attributes[t].indexOf(r))&&i.push(o)}return i}function m(e){if(e.composed||e.constructed){for(var t=I.util.createBuffer(),r=0;r<e.value.length;++r)t.putBytes(e.value[r].value);e.composed=e.constructed=!1,e.value=t.getBytes()}return e}b.pkcs12FromAsn1=function(e,t,r,a){S(),"string"==typeof t?(r=t,t=!0):void 0===t&&(t=!0);var i={},n=[];if(!T.validate(e,p,i,n))throw(d=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.")).errors=n,d;var s={version:i.version.charCodeAt(0),safeContents:[],getBags:function(e){var t,r={};return"localKeyId"in e?t=e.localKeyId:"localKeyIdHex"in e&&(t=I.util.hexToBytes(e.localKeyIdHex)),void 0===t&&!("friendlyName"in e)&&"bagType"in e&&(r[e.bagType]=l(s.safeContents,null,null,e.bagType)),void 0!==t&&(r.localKeyId=l(s.safeContents,"localKeyId",t,e.bagType)),"friendlyName"in e&&(r.friendlyName=l(s.safeContents,"friendlyName",e.friendlyName,e.bagType)),r},getBagsByFriendlyName:function(e,t){return l(s.safeContents,"friendlyName",e,t)},getBagsByLocalKeyId:function(e,t){return l(s.safeContents,"localKeyId",e,t)}};if(3!==i.version.charCodeAt(0))throw(d=new Error("PKCS#12 PFX of version other than 3 not supported.")).version=i.version.charCodeAt(0),d;if(T.derToOid(i.contentType)!==A.oids.data)throw(d=new Error("Only PKCS#12 PFX in password integrity mode supported.")).oid=T.derToOid(i.contentType),d;var o=i.content.value[0];if(o.tagClass!==T.Class.UNIVERSAL||o.type!==T.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(o=m(o),i.mac){var c=null,u=0,e=T.derToOid(i.macAlgorithm);switch(e){case A.oids.sha1:c=I.md.sha1.create(),u=20;break;case A.oids.sha256:c=I.md.sha256.create(),u=32}if(null===c)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+e);n=new I.util.ByteBuffer(i.macSalt),e="macIterations"in i?parseInt(I.util.bytesToHex(i.macIterations),16):1,n=b.generateKey(r,n,3,e,u,c),e=I.hmac.create();e.start(c,n),e.update(o.value);var d,e=e.getMac();if(e.getBytes()!==i.macDigest)throw(d=new Error("Confirm pfx password.")).type=I.err.wrongPasswd,d}return function(e,t,r,a,i){if((t=T.fromDer(t,r)).tagClass!==T.Class.UNIVERSAL||t.type!==T.Type.SEQUENCE||!0!==t.constructed)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var n=0;n<t.value.length;n++){var s=t.value[n],o={},c=[];if(!T.validate(s,y,o,c))throw(u=new Error("Cannot read ContentInfo.")).errors=c,u;var u,d={encrypted:!1},p=null,l=o.content.value[0];switch(T.derToOid(o.contentType)){case A.oids.data:if(l.tagClass!==T.Class.UNIVERSAL||l.type!==T.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");p=m(l).value;break;case A.oids.encryptedData:p=function(e,t){var r={},a=[];if(!T.validate(e,I.pkcs7.asn1.encryptedDataValidator,r,a))throw(i=new Error("Cannot read EncryptedContentInfo.")).errors=a,i;a=T.derToOid(r.contentType);if(a!==A.oids.data){var i;throw(i=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.")).oid=a,i}a=T.derToOid(r.encAlgorithm);t=A.pbe.getCipher(a,r.encParameter,t),r=m(r.encryptedContentAsn1),r=I.util.createBuffer(r.value);if(t.update(r),t.finish())return t.output.getBytes();throw new Error("Failed to decrypt PKCS#12 SafeContents.")}(l,a),d.encrypted=!0;break;default:throw(u=new Error("Unsupported PKCS#12 contentType.")).contentType=T.derToOid(o.contentType),u}d.safeBags=function(e,t,r,a){if(!t&&0===e.length)return[];if((e=T.fromDer(e,t)).tagClass!==T.Class.UNIVERSAL||e.type!==T.Type.SEQUENCE||!0!==e.constructed)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var i,n,s=[],o=0;o<e.value.length;o++){var c=e.value[o],u={},d=[];if(!T.validate(c,f,u,d))throw(l=new Error("Cannot read SafeBag.")).errors=d,l;var p={type:T.derToOid(u.bagId),attributes:function(e){var t={};if(void 0!==e)for(var r=0;r<e.length;++r){var a={},i=[];if(!T.validate(e[r],h,a,i)){var n=new Error("Cannot read PKCS#12 BagAttribute.");throw n.errors=i,n}var s=T.derToOid(a.oid);if(void 0!==A.oids[s]){t[A.oids[s]]=[];for(var o=0;o<a.values.length;++o)t[A.oids[s]].push(a.values[o].value)}}return t}(u.bagAttributes)};s.push(p);var l,y=u.bagValue.value[0];switch(p.type){case A.oids.pkcs8ShroudedKeyBag:if(!(a&&a.format&&1&a.format)&&null===(y=A.decryptPrivateKeyInfo(y,r)))throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case A.oids.keyBag:a&&a.format&&1&a.format?p.key=y:p.key=A.privateKeyFromAsn1(y);continue;case A.oids.certBag:i=g,n=function(){if(T.derToOid(u.certId)!==A.oids.x509Certificate){var e=new Error("Unsupported certificate type, only X.509 supported.");throw e.oid=T.derToOid(u.certId),e}p.cert=A.certificateFromAsn1(T.fromDer(u.cert,t),!0)};break;default:throw(l=new Error("Unsupported PKCS#12 SafeBag type.")).oid=p.type,l}if(void 0!==i&&!T.validate(y,i,u,d))throw(l=new Error("Cannot read PKCS#12 "+i.name)).errors=d,l;n()}return s}(p,r,a,i),e.safeContents.push(d)}}(s,o.value,t,r,a),s},b.makeBagAttr=function(e,t){var r=[];return r.push(T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.localKeyId).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.SET,!0,[T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,e)])])),"friendlyName"in t&&r.push(T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.friendlyName).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.SET,!0,[T.create(T.Class.UNIVERSAL,T.Type.BMPSTRING,!1,t.friendlyName)])])),T.create(T.Class.UNIVERSAL,T.Type.SET,!0,r)},b.toPkcs12Asn1=function(e,t,r,a){S(),(a=a||{}).saltSize=a.saltSize||8,a.count=a.count||2048,a.algorithm=a.algorithm||a.encAlgorithm||"aes128",a.format=a.format||0,"useMac"in a||(a.useMac=!0),a.usePkcs12=!0;for(var i=[],n=[],s=[],o=0;o<e.length;o++)s.push(b.makeBagAttr(e[o].keyId,a));for(o=0;o<e.length+t.length;o++){var c=null,c=o<e.length?e[o].cert:t[o-e.length],u=o<e.length?s[o]:void 0,c=A.certificateToAsn1(c),u=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.certBag).getBytes()),T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.x509Certificate).getBytes()),T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,T.toDer(c).getBytes())])])]),u]);n.push(u)}for(var d=[],p=null,o=0;o<e.length;++o){var l=null;if(1&a.format){var y=[],f=I.asn1.fromDer(e[o].priKey);if(!T.validate(f,A.pbe.encryptedPrivateKeyValidator,{},y)){var h=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw h.errors=y,h.type=I.err.decode,h}l=f}else l=A.priKeyToPriKeyInfo(e[o].priKey);p=null===r?T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.keyBag).getBytes()),T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[l]),s[o]]):T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.pkcs8ShroudedKeyBag).getBytes()),T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[1&a.format?l:A.encryptPrivateKeyInfo(l,r,a)]),s[o]]),(1&a.format?n:d).push(p)}0<d.length&&(v=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,d),g=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.data).getBytes()),T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,T.toDer(v).getBytes())])]),i.push(g)),0<n.length&&(m=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,n),C=null,C=2&a.format?T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.data).getBytes()),T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,T.toDer(m).getBytes())])]):A.encryptDataWithPBE(m,r,a),i.push(C));var g,m,C,E,v=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,i);return a.useMac&&(g=I.md.sha1.create(),m=new I.util.ByteBuffer(I.random.getBytes(a.saltSize)),E=a.count,C=b.generateKey(r,m,3,E,20),(i=I.hmac.create()).start(g,C),i.update(T.toDer(v).getBytes()),i=i.getMac(),E=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.sha1).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,"")]),T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,i.getBytes())]),T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,m.getBytes()),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(E).getBytes())])),T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(3).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(A.oids.data).getBytes()),T.create(T.Class.CONTEXT_SPECIFIC,0,!0,[T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,T.toDer(v).getBytes())])]),E])},b.generateKey=I.pbe.generatePkcs12Key}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var e=dreamsecurity,t=e.tsp=dreamsecurity.tsp||{},i=e.asn1,n=e.pki,s=(n.oids,{name:"TSTInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"TSTInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"TSTInfo.policy",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"policy"},{name:"TSTInfo.messageImprint",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"messageImprint",value:[n.algIdValidator("TSTInfo.messageImprint.hashAlgorithm","TSTInfo.messageImprint.hashAlgorithm","hashAlgorithm","TSTInfo.messageImprint.parameters","hashAlgorithmParameters"),{name:"TSTInfo.messageImprint.hashedMessage",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"hashedMessage"}]},{name:"TSTInfo.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"serialNumber"},{name:"TSTInfo.genTime",tagClass:i.Class.UNIVERSAL,type:i.Type.GENERALIZEDTIME,constructed:!1,capture:"genTime"},{name:"TSTInfo.accuracy",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,optional:!0,capture:"accuracy",value:[{name:"TSTInfo.accuracy.seconds",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"seconds"},{name:"TSTInfo.accuracy.millis",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"millis"},{name:"TSTInfo.accuracy.micros",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"micros"}]},{name:"TSTInfo.ordering",tagClass:i.Class.UNIVERSAL,type:i.Type.BOOLEAN,constructed:!1,optional:!0,capture:"ordering"},{name:"TSTInfo.nonce",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"nonce"},{name:"TSTInfo.tsa",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"tsa"},{name:"TSTInfo.extensions",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,captureAsn1:"certExtensions"}]});t.tstInfoFromAsn1=function(e){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"tsp")}();var t={},r=[];if(!i.validate(e,s,t,r)){var a=new Error("Cannot read time stamp token. ASN.1 object is not an time stamp token.");throw a.errors=r,a}a={msgImprint:{},tsa:{}};return a.version=t.version.charCodeAt(0),a.policy=i.derToOid(t.policy),a.msgImprint.hashAlg=i.derToOid(t.hashAlgorithm),a.msgImprint.hashedMessage=t.hashedMessage,a.serialNumber=t.serialNumber,a.genTime=i.generalizedTimeToDate(t.genTime),a.nonce=t.nonce,n.processGeneralName(t.tsa[0],a.tsa),a}}(),function(){"undefined"==typeof dreamsecurity&&(dreamsecurity={});var o=dreamsecurity,e=o.arcCert=dreamsecurity.arcCert||{},c=o.asn1,u=o.pki,s=u.oids,t=o.pki.algIdValidator,d={name:"ARCCertInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"ARCCertInfo.version",tagClass:c.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"ARCCertInfo.version.integer",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"version"}]},{name:"ARCCertInfo.serialNumber",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"serialNumber"},{name:"ARCCertInfo.issuer",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,capture:"issuer"},{name:"ARCCertInfo.dateOfIssue",tagClass:c.Class.UNIVERSAL,type:c.Type.GENERALIZEDTIME,constructed:!1,capture:"dateOfIssue"},{name:"ARCCertInfo.dateOfExpiration",captureAsn1:"dateOfExpiration"},{name:"ARCCertInfo.policy",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"policy"},{name:"ARCCertInfo.requestInfo",captureAsn1:"requestInfo"},{name:"ARCCertInfo.target",captureAsn1:"target"},{name:"ARCCertInfo.extensions",tagClass:c.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"extensions"}]},p={name:"ARCCertReq",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"ARCCertReq.version",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,options:!0,capture:"version"},{name:"ARCCertReq.requester",captureAsn1:"requester"},{name:"ARCCertReq.requestTime",captureAsn1:"requestTime"},{name:"ARCCertReq.policy",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"policy"},{name:"ARCCertReq.target",captureAsn1:"target"},{name:"ARCCertReq.nonce",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"nonce"},{name:"ARCCertReq.extensions",tagClass:c.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"extensions"}]},l={name:"HashedDataInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[t("HashedDataInfo.hashAlg","AlgorithmIdentifier.algorithm","hashAlgOid","AlgorithmIdentifier.parameter","parameters"),{name:"HashedDataInfo.hashedData",tagClass:c.Class.UNIVERSAL,type:c.Type.BITSTRING,constructed:!1,capture:"hashedData"}]};function y(e,t){var r={},a=[];if(!c.validate(e,l,r,a)){var i=new Error("Cannot read HashedDataInfo. ASN.1 object is not an HashedDataInfo.");throw i.errors=a,i}if(t.hashAlg=o.pki.oids[o.asn1.derToOid(r.hashAlgOid)],"string"!=typeof r.hashedData){for(var n="\0",s=0;s<r.hashedData.length;++s)n+=c.toDer(r.hashedData[s]).getBytes();r.hashedData=n}i=o.util.createBuffer(r.hashedData);++i.read,t.hashedData=i.getBytes()}function f(e){for(var t=[],r=0;r<e.value.length;++r){var a=e.value[r],i={};if(i.id=c.derToOid(a.value[0].value),i.critical=!1,a.value[1].type===c.Type.BOOLEAN?(i.critical=0!==a.value[1].value.charCodeAt(0),i.value=a.value[2].value):i.value=a.value[1].value,!(i.id in s))throw new Error("Extension("+i.name+") is not supported.");i.name=s[i.id];var n=c.fromDer(i.value);"kiec_usageType"===i.name&&(a=0,1<n.value.length&&(a=n.value.charCodeAt(1)),i.online=128==(128&a),i.mobile=64==(64&a),i.paperEnable=32==(32&a)),t.push(i)}return t}e.arcCertResFromAsn1=function(e){!function(){dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"arccert")}();var t={},r=[],a=new Error("Cannot read ARCCertResponse. ASN.1 object is not an ARCCertResponse.");if(e.tagClass!==c.Class.CONTEXT_SPECIFIC)throw a;var i={};if(0!=e.type)throw 1==e.type?new Error("The ARCCertResponse is an arcErrorNotice."):a;if(!c.validate(e.value[0],d,t,r))throw a.errors=r,a;i.version=t.version.charCodeAt(0);a=o.util.createBuffer(t.serialNumber);i.serialNumber=a.toHex(),i.issuer=[];for(var n=0;n<t.issuer.length;n++){var s={};u.processGeneralName(t.issuer[n],s),i.issuer.push(s)}return i.dateOfIssue=c.generalizedTimeToDate(t.dateOfIssue),i.dateOfExpiration=function(e){{if(e.type==c.Type.GENERALIZEDTIME)return c.generalizedTimeToDate(e.value);if(e.type==c.Type.NULL)return null}throw new Error("ASN.1 object is not an CertDateOfExpiration")}(t.dateOfExpiration),i.policy=u.processCertPolicies(t.policy),i.requestInfo=function(e){var t={},r=[];{if(e.type==c.Type.SEQUENCE){if(!c.validate(e,p,t,r)){var a=new Error("Cannot read ARCCertRequest. ASN.1 object is not an ARCCertRequest.");throw a.errors=r,a}var i={};if(i.version=t.version.charCodeAt(0),t.requester.type==c.Type.SEQUENCE){i.requester=[];for(var n=0;n<t.requester.value.length;n++){var s={};u.processGeneralName(t.requester.value[n],s),i.requester.push(s)}}else{if(t.requester.type!=c.Type.NULL)throw new Error("ASN.1 object is not an ARCCertRequest (invalid requester)");i.requester=null}if(t.requestTime.type==c.Type.GENERALIZEDTIME)i.requestTime=c.generalizedTimeToDate(t.requestTime.value);else{if(t.requester.type!=c.Type.NULL)throw new Error("ASN.1 object is not an ARCCertRequest (invalid requestTime)");i.requestTime=null}return i.policy=u.processCertPolicies(t.policy),i.target=function(e){var t={};{if(e.type==c.Type.SEQUENCE)throw t.choice="targetRecord",new Error("targetRecord in Target is not supported.");if(e.tagClass!=c.Class.CONTEXT_SPECIFIC)throw new Error("ASN.1 object is not an Target");if(0!=e.type)throw 1==e.type?(t.choice="targetDocInfo",new Error("targetDocInfo in Target is not supported.")):new Error("ASN.1 object is not an Target");t.choice="targetHash",y(e.value[0],t)}return t}(t.target),i.nonce=t.nonce,i.extensions=f(t.extensions[0]),i}if(e.type==c.Type.NULL)return null}throw new Error("ASN.1 object is not an RequestInfo")}(t.requestInfo),i.target=function(e){var t={};{if(e.tagClass!=c.Class.CONTEXT_SPECIFIC)throw new Error("ASN.1 object is not an Target");if(0==e.type)throw t.choice="opRecord",new Error("opRecord in TargetToCertify is not supported.");if(1==e.type)throw t.choice="orgAndIssued",new Error("orgAndIssued in TargetToCertify is not supported.");if(2!=e.type)throw new Error("ASN.1 object is not an Target");t.choice="dataHash",y(e.value[0],t)}return t}(t.target),i.extensions=f(t.extensions[0]),i}}(),"undefined"==typeof magicjs&&(magicjs={}),function f(g){if(null==g){if(dreamsecurity.chkIntegrity)return void("function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"magicjs"));throw new Error("The MagicJS is not initialized!!")}g.version="1.2.4.0",g.md=g.md||{},g.hmac=g.hmac||{},g.cipher=g.cipher||{},g.pubKey=g.pubKey||{},g.priKey=g.priKey||{},g.pkcs5=g.pkcs5||{},g.x509Cert=g.x509Cert||{},g.x509Crl=g.x509Crl||{},g.pkcs7=g.pkcs7||{},g.pkcs7.signedData=g.pkcs7.signedData||{},g.pkcs7.envelopedData=g.pkcs7.envelopedData||{},g.pkcs7.signedAndEnvData=g.pkcs7.signedAndEnvData||{},g.pkcs10=g.pkcs10||{},g.pkcs12=g.pkcs12||{},g.tsp=g.tsp||{},g.tsp.token=g.tsp.token||{},g.arcCert=g.arcCert||{},g.arcCert.response=g.arcCert.response||{},g.pem=g.pem||{},g.base64=g.base64||{},g.hex=g.hex||{},g.utf8=g.utf8||{},g.err=g.err||{},g.ByteStringBuffer=g.ByteStringBuffer||{};var m={};function a(e,t,r,a,i){e.func=t,e.name=r,e.code=a,"string"==typeof i?e.message=i:(e.message=i.message,void 0!==i.errors&&(e.detail=i.errors))}function h(e,t,r){a(this,e,"UnsupportedError",m.msg.unsupported|t,r)}function n(e,t,r){a(this,e,"WrongPasswordError",m.msg.wrongPasswd|t,r)}function s(e,t,r){a(this,e,"RevokedError",m.msg.revoked|t,r)}function o(e,t,r){a(this,e,"ExpiredError",m.msg.expired|t,r)}function u(e,t,r){a(this,e,"VidNotExistError",m.msg.vidNotExist|t,r)}function c(e,t,r){a(this,e,"NotValidRecpError",m.msg.notValidRecp|t,r)}function d(e,t,r){a(this,e,"EncryptError",m.op.encrypt|t,r)}function p(e,t,r){a(this,e,"DecryptError",m.op.decrypt|t,r)}function l(e,t,r){a(this,e,"SignError",m.op.sign|t,r)}function y(e,t,r){a(this,e,"VerifyError",m.op.verify|t,r)}function C(e,t,r){a(this,e,"GenerateError",m.op.generate|t,r)}function E(e,t,r){a(this,e,"ProcessError",m.op.process|t,r)}function v(e,t,r){a(this,e,"EncodeError",m.op.encode|t,r)}function S(e,t,r){a(this,e,"DecodeError",m.op.decode|t,r)}function I(e,t,r){a(this,e,"LicenseError",m.op.decode|t,r)}function T(e,t,r){a(this,e,"InvalidInputError",m.msg.invalidInput|t,r)}function A(e,t,r,a){var i=dreamsecurity.err;switch(e=void 0!==a.type?a.type:e){case i.unsupported:throw new h(t,r,a);case i.wrongPasswd:throw new n(t,r,a);case i.revoked:throw new s(t,r,a);case i.expired:throw new o(t,r,a);case i.encrypt:throw new d(t,r,a);case i.decrypt:throw new p(t,r,a);case i.sign:throw new l(t,r,a);case i.verify:throw new y(t,r,a);case i.generate:throw new C(t,r,a);case i.process:throw new E(t,r,a);case i.encode:throw new v(t,r,a);case i.decode:throw new S(t,r,a);case i.license:throw new I(t,r,a);case i.invalidInput:throw new T(t,r,a);case i.vidNotExist:throw new u(t,r,a);default:throw a}}function b(e){var t=null;if(null!=e)return new dreamsecurity.util.ByteBuffer(e).data;throw(t=(t=new Error("The input is null."))||new Error("The input is invalid type.")).type=dreamsecurity.err.invalidInput,t.code=g.err.msg.invalidInput,t}function N(e,t){if("sha256"==(e=e.toLowerCase())||"sha1"==e)return e;throw new h(t,m.alg.md,'Unknown hash algorithm "'+e+'"')}function B(e,t){var r=void 0,a=void 0;return!e||e.scheme&&"RSAES-PKCS1-V1_5"===e.scheme.toUpperCase()?a="RSAES-PKCS1-V1_5":!e.scheme&&e.md||e.scheme&&"RSA-OAEP"===e.scheme.toUpperCase()?(a="RSA-OAEP",r={},e.md?r.md=dreamsecurity.md.algorithms[e.md.toLowerCase()].create():r.md=t||dreamsecurity.md.algorithms.sha1.create()):e.scheme&&"ECIES"===e.scheme.toUpperCase()?(a="ECIES",r={curveName:e.curveName,macAlgName:e.mac,symAlgName:e.sym}):a="RSAES-PKCS1-V1_5",{scheme:a,schemeOpts:r}}function R(e,t){if(!e)return"RSASSA-PKCS1-V1_5";if(e.scheme&&"RSASSA-PKCS1-V1_5"===e.scheme.toUpperCase())return"RSASSA-PKCS1-V1_5";if(!e.scheme&&e.md||e.scheme&&"RSA-PSS"===e.scheme.toUpperCase()){var r=20,a="sha1";return t?a=t.toLowerCase():e.md&&(a=e.md.toLowerCase()),t=dreamsecurity.md.algorithms[a].create(),r=e.saltLength||t.digestLength,dreamsecurity.pss.create({md:t,mgf:dreamsecurity.mgf.mgf1.create(dreamsecurity.md.algorithms[a].create()),saltLength:r})}return"RSASSA-PKCS1-V1_5"}function k(e){return("sha1WithRSAEncryption"===e.signAlg.name?dreamsecurity.md.algorithms.sha1:dreamsecurity.md.algorithms.sha256).create()}function w(e){var t="";for(i=e.attributes.length-1;0<=i;i--)i!=e.attributes.length-1&&(t+=","),t+=e.attributes[i].shortName+"="+dreamsecurity.util.decodeUtf8(e.attributes[i].value);return t}function D(e){var t={};if(t.id={oid:e.id,name:e.name},t.critical=e.critical,e.id===dreamsecurity.pki.oids.authorityKeyIdentifier)t.aki={},void 0!==e.keyIdentifier&&(t.aki.keyIdentifier=dreamsecurity.util.createBuffer(e.keyIdentifier)),void 0!==e.authorityCertIssuer&&(t.aki.authorityCertIssuer=w(e.authorityCertIssuer)),void 0!==e.authorityCertSerialNumber&&(t.aki.authorityCertSerialNumber=dreamsecurity.util.createBuffer(e.authorityCertSerialNumber).toHex());else if(e.id===dreamsecurity.pki.oids.issuerAltName){t.issuerAltName=[];for(var r=0;r<e.altNames.length;r++)t.issuerAltName.push(e.altNames[r])}else e.id===dreamsecurity.pki.oids.cRLNumber?t.cRLNumber=e.cRLNumber:e.id===dreamsecurity.pki.oids.issuingDistributionPoint?(t.issuingDistributionPoint={},t.issuingDistributionPoint.distributionPoint=e.distributionPoint,t.issuingDistributionPoint.onlyContainsUserCerts=e.onlyContainsUserCerts,t.issuingDistributionPoint.onlyContainsCACerts=e.onlyContainsCACerts,t.issuingDistributionPoint.indirectCRL=e.indirectCRL,t.issuingDistributionPoint.onlyContainsAttributeCerts=e.onlyContainsAttributeCerts):e.id===dreamsecurity.pki.oids.cRLReason?t.cRLReason=e.cRLReason:e.id===dreamsecurity.pki.oids.invalidityDate&&(t.invalidityDate=e.invalidityDate);return t}function U(e){return e.key.read=0,e.parameter.read=0,{algorithm:dreamsecurity.pki.oids[e.algorithm],key:e.key,iv:e.parameter.copy()}}m.data={keyPair:16777216,secretKey:33554432,x509Cert:50331648,x509Crl:67108864,pubKey:83886080,priKey:100663296,encPriKey:117440512,signedData:134217728,envelopedData:150994944,pkcs10Csr:167772160,pkcs12Pfx:184549376,signedAndEnvData:201326592,tsp:218103808,arcCert:234881024,bitMask:251658240},m.encoding={der:1048576,base64:2097152,pem:3145728,hex:4194304,utf8:5242880,bitMask:15728640},m.alg={md:65536,symmetric:131072,asymmetric:196608,sign:262144,hmac:327680,rand:393216,bitMask:983040},m.op={encrypt:4096,decrypt:8192,sign:12288,verify:16384,generate:20480,process:24576,encode:28672,decode:32768,bitMask:61440},m.step={init:256,udpate:512,finish:768,bitMask:3840},m.msg={unsupported:1,wrongPasswd:2,revoked:3,expired:4,vidNotExist:5,notValidRecp:6,invalidInput:7,bitMask:15},g.err=m||g.err,h.prototype=Error.prototype,n.prototype=Error.prototype,s.prototype=Error.prototype,o.prototype=Error.prototype,u.prototype=Error.prototype,d.prototype=Error.prototype,p.prototype=Error.prototype,l.prototype=Error.prototype,y.prototype=Error.prototype,C.prototype=Error.prototype,E.prototype=Error.prototype,v.prototype=Error.prototype,S.prototype=Error.prototype,T.prototype=Error.prototype,g.init=function(e){"gf"===e?dreamsecurity.vi.gf=!0:dreamsecurity.vi.l=e},g.md.create=function(e){var t="ds.md.create",r=e.toLowerCase(),e={algorithm:r},a=null;if(!(r in dreamsecurity.md.algorithms))throw new h(t,m.alg.hmac,'Unknown message digest algorithm "'+r+'"');try{f(),a=dreamsecurity.md.algorithms[r].create()}catch(e){A(dreamsecurity.err.generate,t,m.alg.md|m.step.init,e)}return e.init=function(){try{a.start()}catch(e){A(dreamsecurity.err.generate,"ds.md.init",m.alg.md|m.step.init,e)}},e.update=function(e,t){try{a.update(b(e),t)}catch(e){A(dreamsecurity.err.generate,"ds.md.udpate",m.alg.md|m.step.update,e)}},e.digest=function(e,t){try{if(null!=e){if(void 0!==e.getEngine&&!0===e.getEngine)return a;a.update(b(e),t)}var r=a.digest();return a.start(),r}catch(e){A(dreamsecurity.err.generate,"ds.md.digest",m.alg.md|m.step.finish,e)}},e},g.hmac.create=function(e){var e=e.toLowerCase(),t=null,r={algorithm:e};if(!(e in dreamsecurity.md.algorithms))throw new h("ds.hamc.create",m.alg.hmac,'Unknown mac algorithm "'+e+'"');try{f(),t=dreamsecurity.hmac.create()}catch(e){A(dreamsecurity.err.generate,"ds.hamc.create",m.alg.hamc|m.step.init,e)}return r.init=function(e){try{t.start(r.algorithm,e)}catch(e){A(dreamsecurity.err.generate,"ds.hmac.init",m.alg.hmac|m.step.init,e)}},r.update=function(e){try{t.update(b(e))}catch(e){A(dreamsecurity.err.generate,"ds.hmac.udpate",m.alg.hmac|m.step.update,e)}},r.generate=function(){try{return t.digest()}catch(e){A(dreamsecurity.err.generate,"ds.hmac.generate",m.alg.hmac|m.step.finish,e)}},r.verify=function(e){try{return t.digest().toHex()==dreamsecurity.util.bytesToHex(b(e))}catch(e){A(dreamsecurity.err.generate,"ds.hmac.verify",m.alg.hmac|m.step.finish,e)}},r},g.cipher.create=function(e,t,r){var a={algorithm:t.toUpperCase(),encrypt:e},i=null;try{f();var n=0,s=a.algorithm;if(0==s.indexOf("SEED")||-1!=s.indexOf("128"))n=16;else if(0==s.indexOf("3DES")||-1!=s.indexOf("192"))n=24;else if(-1!=s.indexOf("256"))n=32;else{if(0!=s.indexOf("DES"))throw new h("ds.cipher.create",m.alg.symmetric,'Unknown cipher algorithm "'+s+'"');n=8}var o=b(r);n!=o.length&&A(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.create",m.alg.symmetric,"The "+o.length+" bytes key length is not valid for "+s+" algorithm."),0==s.indexOf("AES")?s="AES-CBC":0==s.indexOf("ARIA")&&(s="ARIA-CBC"),i=1==e?dreamsecurity.cipher.createCipher(s,o):dreamsecurity.cipher.createDecipher(s,o)}catch(e){A(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.create",m.alg.symmetric,e)}return a.init=function(e){try{i.start({iv:b(e)})}catch(e){A(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.init",m.alg.symmetric|m.step.init,e)}},a.update=function(e){try{return i.update(dreamsecurity.util.createBuffer(e))}catch(e){A(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.update",m.alg.symmetric|m.step.update,e)}},a.finish=function(e){if(null!=e&&"pkcs5padding"!=e.toLowerCase())throw new h("ds.cipher.finish",m.alg.symmetric|m.step.finish,'Unknown padding : "'+e+'"');try{i.finish()||A(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.finish",m.alg.symmetric|m.step.finish,"The Operation failed.")}catch(e){A(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.finish",m.alg.symmetric|m.step.finish,e)}return a.output=i.output,a.output},a},g.generateRandomBytes=function(e){try{return dreamsecurity.util.createBuffer(dreamsecurity.random.getBytesSync(e))}catch(e){A(dreamsecurity.err.generate,"ds.generateRandomBytes",m.alg.rand,e)}},g.generateKey=function(e,t){var r=e.toUpperCase(),a=0;if(-1!=r.indexOf("SEED")?a=16:-1!=r.indexOf("AES")||-1!=r.indexOf("ARIA")?null!=t&&null!=t.bits&&null!=t&&null!=t.bits?a=t.bits/8:-1!=r.indexOf("128")?a=16:-1!=r.indexOf("192")?a=24:-1!=r.indexOf("256")&&(a=32):-1!=r.indexOf("3DES")?a=24:-1!=r.indexOf("DES")&&(a=8),0==a)throw new h("ds.generateKey",m.alg.symmetric,'Unknown algorithm : "'+e+'"');try{return g.generateRandomBytes(a)}catch(e){throw e.func="ds.generateRandomBytes",e}},g.generateKeyPair=function(e,t){var r={},a=null,i=e.toLowerCase();if("rsa"==i)a=dreamsecurity.pki.rsa;else{if("ecc"!=i)throw new h("ds.generateKeyPair",m.alg.asymmetric,'Unknown algorithm : "'+e+'"');a=dreamsecurity.pki.ecc}try{f(),(r=a.generateKeyPair(t)).privateKey.algName=i,r.publicKey.algName=i,r.privateKey=g.priKey.create(r.privateKey),r.publicKey=g.pubKey.create(r.publicKey)}catch(e){if(void 0!==e.func)throw e.func="ds.generateKeyPair",e;A(dreamsecurity.err.generate,"ds.generateKeyPair",m.alg.asymmetric,e)}return r},g.pubKey.create=function(e){var t,c={algorithm:"",keyLength:0,curveName:""},r=0,u=null;try{f(),u="string"==typeof e?(t=null,t=0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,(t=dreamsecurity.pem.decode(e)[0]).body):(r=m.encoding.base64,g.base64.decode(e)),r=m.encoding.der,dreamsecurity.pki.publicKeyFromAsn1(dreamsecurity.asn1.fromDer(t))):e}catch(e){throw new S("ds.pubKey.create",m.data.pubKey|r,e)}if(c.algorithm=u.algName,null!=u.n)c.keyLength=u.n.bitLength();else if(null!=u.p)c.keyLength=u.p.bitLength();else{if(null==u.curveName)throw new h("ds.pubKey.create",m.data.pubKey,"The publicKey is not for RSA/KCDSA/ECC.");c.curveName=u.curveName}return c.toDer=function(){var e=null;try{e=dreamsecurity.pki.publicKeyToSubjectPublicKeyInfo(u)}catch(e){throw new v("ds.pubKey.toDer",m.data.pubKey|m.encoding.der,e)}return dreamsecurity.asn1.toDer(e).copy()},c.toPem=function(){try{return g.pem.encode(c,"PUBLIC KEY")}catch(e){throw new v("ds.pubKey.toPem",m.data.pubKey|m.encoding.pem,e)}},c.verify=function(e,t,r){if("rsa"!=c.algorithm)throw new y("ds.pubKey.verify",m.data.pubKey,"Wrong usage. This verify method works when public key is for RSA.");try{var a=R(r);return u.verify(e.digest().getBytes(),b(t),a)}catch(e){A(dreamsecurity.err.verify,"ds.pubKey.verify",m.data.pubKey,e)}},c.verifySignature=function(e,t,r,a){try{var i="ds.pubKey.verifySignature",n=N(t,i);if("rsa"!=c.algorithm)return u.verify(b(e),n,b(r));var s=dreamsecurity.md.algorithms[n].create();s.update(b(e));var o=R(a);return u.verify(s.digest().getBytes(),b(r),o)}catch(e){A(dreamsecurity.err.verify,i,m.data.pubKey,e)}},c.encrypt=function(e,t){try{t.curveName=this.curveName;var r=B(t),a=u.encrypt(b(e),r.scheme,r.schemeOpts);return r.schemeOpts&&r.schemeOpts.out_cek&&(t.out_cek=r.schemeOpts.out_cek),a}catch(e){A(dreamsecurity.err.encrypt,"ds.pubKey.encrypt",m.data.pubKey,e)}},c.decrypt=function(e){try{return B(null),dreamsecurity.pki.rsa.decrypt(b(e),u,!0,!0)}catch(e){throw new p("ds.pubKey.decrypt",m.data.pubKey,e)}},c.k=u,c},g.priKey.create=function(e){var t,o={algorithm:"",keyLength:0,curveName:""},r=0,c=null;try{f(),c="string"==typeof e?0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,dreamsecurity.pki.privateKeyFromPem(e)):(r=m.encoding.base64,t=g.base64.decode(e),r=m.encoding.der,dreamsecurity.pki.privateKeyFromAsn1(dreamsecurity.asn1.fromDer(t,!0))):e}catch(e){throw new S("ds.priKey.create",m.data.priKey|r,e)}if(o.algorithm=c.algName,null!=c.n)o.keyLength=c.n.bitLength();else if(null!=c.p)o.keyLength=c.p.bitLength();else{if(null==c.curveName)throw new h("ds.priKey.create",m.data.priKey,"The priKey is not supported algorithm(RSA/ECC/KCDSA).");o.curveName=c.curveName}return o.getRandomNum=function(){if(null!=c.randomNum)return c.randomNum;throw new u("ds.priKey.getRandomNum",m.data.priKey,"The priKey does not have a random number for VID.")},o.toDer=function(){var e=null;try{e=dreamsecurity.pki.priKeyToPriKeyInfo(c)}catch(e){throw new v("ds.priKey.toDer",m.data.priKey|m.encoding.der,e)}return dreamsecurity.asn1.toDer(e).copy()},o.toPem=function(){try{return g.pem.encode(o,"PRIVATE KEY")}catch(e){throw new v("ds.priKey.toPem",m.encoding.pem,e)}},o.sign=function(e,t){if("rsa"!=o.algorithm)throw new l("ds.priKey.sign",m.data.priKey,"Wrong usage. This sign method works when private key is for RSA.");return t=R(t),c.sign(e.digest({getEngine:!0}),t)},o.generateSignature=function(e,t,r){try{var a="ds.priKey.generateSignature",i=N(t,a);if("rsa"==o.algorithm){var n=dreamsecurity.md.algorithms[i].create();n.update(b(e));var s=R(r);return c.sign(n,s)}if("kcdsa"==o.algorithm){if(null==r||null==r.pubKey||null==r.pubKey)throw new l(a,m.data.priKey,"The publicKey is requred to KCDSA sign.");return c.sign(b(e),i,r.pubKey.k.y)}if("ecc"==o.algorithm)return c.sign(b(e),i);throw new l(a,m.data.priKey,"The "+o.algorithm+" sign is not supported.")}catch(e){A(dreamsecurity.err.sign,a,m.data.priKey,e)}},o.decrypt=function(e,t){try{var r=B(t);return c.decrypt(b(e),r.scheme,r.schemeOpts)}catch(e){A(dreamsecurity.err.decrypt,"ds.priKey.decrypt",m.data.priKey,e)}},o.encrypt=function(e){try{return dreamsecurity.pki.rsa.encrypt(b(e),c,1)}catch(e){A(dreamsecurity.err.encrypt,"ds.priKey.encrypt",m.data.priKey,e)}},o.k=c,o},g.x509Cert.create=function(e){var t,h={},r=null,a=0;try{f(),r="string"==typeof e?0===e.lastIndexOf("-----",0)?(a=m.encoding.pem,dreamsecurity.pki.certificateFromPem(e)):(a=m.encoding.base64,t=g.base64.decode(e),a=m.encoding.der,dreamsecurity.pki.certificateFromAsn1(dreamsecurity.asn1.fromDer(t))):e}catch(e){throw new S("ds.x509Cert.create",m.data.x509Cert|a,e)}h.version=r.version+1,h.serialNum=r.serialNumber,h.issuer=w(r.issuer),h.signAlg={oid:r.signatureOid,name:dreamsecurity.pki.oids[r.signatureOid]},h.validity={notBefore:r.validity.notBefore,notAfter:r.validity.notAfter},h.subject=w(r.subject),h.pubKey=g.pubKey.create(r.publicKey),h.signature=dreamsecurity.util.createBuffer(),h.signature.putBytes(r.signature),h.extensions=[];for(var i=0;i<r.extensions.length;i++)h.extensions.push(function(e){var t={};if(t.id={oid:e.id,name:e.name},t.critical=e.critical,e.id===dreamsecurity.pki.oids.authorityKeyIdentifier)t.aki={},void 0!==e.keyIdentifier&&(t.aki.keyIdentifier=dreamsecurity.util.createBuffer(e.keyIdentifier)),void 0!==e.authorityCertIssuer&&(t.aki.authorityCertIssuer=w(e.authorityCertIssuer)),void 0!==e.authorityCertSerialNumber&&(t.aki.authorityCertSerialNumber=dreamsecurity.util.createBuffer(e.authorityCertSerialNumber).toHex());else if(e.id===dreamsecurity.pki.oids.subjectKeyIdentifier)t.ski=dreamsecurity.util.createBuffer(dreamsecurity.util.hexToBytes(e.subjectKeyIdentifier));else if(e.id===dreamsecurity.pki.oids.keyUsage)t.keyUsage={},t.keyUsage.cRLSign=e.cRLSign,t.keyUsage.dataEncipherment=e.dataEncipherment,t.keyUsage.decipherOnly=e.decipherOnly,t.keyUsage.digitalSignature=e.digitalSignature,t.keyUsage.encipherOnly=e.encipherOnly,t.keyUsage.keyAgreement=e.keyAgreement,t.keyUsage.keyCertSign=e.keyCertSign,t.keyUsage.keyEncipherment=e.keyEncipherment,t.keyUsage.nonRepudiation=e.nonRepudiation;else if(e.id===dreamsecurity.pki.oids.certificatePolicies){t.certPolicies=[];for(var r=0;r<e.certificatePolicies.length;r++)t.certPolicies.push(e.certificatePolicies[r])}else if(e.id===dreamsecurity.pki.oids.issuerAltName)for(t.issuerAltName=[],r=0;r<e.altNames.length;r++)t.issuerAltName.push(e.altNames[r]);else if(e.id===dreamsecurity.pki.oids.subjectAltName)for(t.subjectAltName=[],r=0;r<e.altNames.length;r++)t.subjectAltName.push(e.altNames[r]);else e.id===dreamsecurity.pki.oids.basicConstraints?(t.basicConsts={},t.basicConsts.cA=e.cA,t.basicConsts.pathLenConstraint=e.pathLenConstraint):e.id===dreamsecurity.pki.oids.policyConstraints?t.policyConsts=e.policyConstraints:e.id===dreamsecurity.pki.oids.cRLDistributionPoints?t.crlDPs=e.cRLDistributionPoints:e.id===dreamsecurity.pki.oids.authorityInfoAccess&&(t.aia=e.authorityInfoAccess);return t}(r.extensions[i]));return h.toPem=function(){try{return dreamsecurity.pki.certificateToPem(r)}catch(e){throw new v("ds.x509Cert.toPem",m.data.x509Cert|m.encoding.pem,e)}},h.toDer=function(){try{return dreamsecurity.asn1.toDer(dreamsecurity.pki.certificateToAsn1(r))}catch(e){throw new v("ds.x509Cert.toDer",m.data.x509Cert|m.encoding.der,e)}},h.verifyVID=function(e,t){return h.makeVID(e,t,2,!0)},h.makeVID=function(e,t,r,a){var i=!1,n="ds.x509Cert."+((i=null!=a?a:i)?"verifyVID":"makeVirtualID");try{for(var s=0,o=!1,s=0;s<h.extensions.length;s++)if(null!=h.extensions[s].subjectAltName){o=!0;break}if(!o)throw new Error("VidNotExist");for(altName=h.extensions[s].subjectAltName,s=0;s<altName.length;s++)if(null!=altName[s].otherName){if(null==altName[s].otherName.vid)throw new Error("VidNotExist");var c=dreamsecurity.asn1,u=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.PRINTABLESTRING,!1,b(t)),c.create(c.Class.UNIVERSAL,c.Type.BITSTRING,!1,String.fromCharCode(0)+b(e))]),d=c.toDer(u).getBytes(),p=N(altName[s].otherName.vid.hashAlg,n),l=dreamsecurity.md.algorithms[p].create();l.update(d);var y=l.digest();if(null!=r&&2==r){var f=dreamsecurity.md.algorithms[p].create();if(f.update(y.getBytes()),y=f.digest(),i)return y.toHex()==altName[s].otherName.vid.value.toHex()}return y}throw new Error("VidNotExist")}catch(e){e.message&&"VidNotExist"==e.message&&(e.message="The certificate does not have a vid information.",e.type=dreamsecurity.err.vidNotExist),A(dreamsecurity.err.encode,n,m.data.x509Cert|m.encoding.der,e)}},h.k=r,h},g.x509Cert.verify=function(e,t){try{f();var r=[];r[0]=e.k;for(var a=dreamsecurity.pki.createCaStore(null),i=0;i<t.length;i++)a.addCertificate(t[i].k);dreamsecurity.pki.verifyCertificateChain(a,r)}catch(e){A(dreamsecurity.err.verify,"ds.x509Cert.verify",m.data.x509Cert,e)}},g.x509Crl.create=function(e,t){var r,a={},i=null,n=0,s=0;try{f(),i="string"==typeof e?0===e.lastIndexOf("-----",0)?(s=m.encoding.pem,dreamsecurity.pki.certificateRevocationListFromPem(e)):(s=m.encoding.base64,r=g.base64.decode(e),s=m.encoding.der,dreamsecurity.pki.certificateRevocationListFromAsn1(dreamsecurity.asn1.fromDer(r))):e}catch(e){throw new S("ds.x509Crl.create",m.data.x509Crl|s,e)}try{if(a.version=i.version+1,a.issuer=w(i.issuer),a.signAlg={oid:i.signatureOid,name:dreamsecurity.pki.oids[i.signatureOid]},a.thisUpdate=i.thisUpdate,a.nextUpdate=i.nextUpdate,a.signature=dreamsecurity.util.createBuffer(),a.signature.putBytes(i.signature),a.revokedCerts=[],t)for(i.revokedCerts=dreamsecurity.pki.revokedCertificatesFromAsn1(i.revokedCertsAsn1),n=0;n<i.revokedCerts.length;n++)a.revokedCerts.push(function(e){var t={};t.userCert=e.userCertificate,t.revocationDate=e.revocationDate,t.extensions=[];for(var r=0;r<e.exts.length;r++)t.extensions.push(D(e.exts[r]));return t}(i.revokedCerts[n]));for(a.extensions=[],n=0;n<i.extensions.length;n++)a.extensions.push(D(i.extensions[n]))}catch(e){throw new E("ds.x509Crl.create",m.data.x509Crl,e)}return a.toPem=function(){try{return g.pem.encode(a,g.pem.type.crl)}catch(e){throw new v("ds.x509Crl.toPem",m.data.x509Crl|m.encoding.pem,e)}},a.toDer=function(){try{return dreamsecurity.asn1.toDer(i.toAsn1())}catch(e){throw new v("ds.x509Crl.toDer",m.data.x509Crl|m.encoding.der,e)}},a.verify=function(e){try{return i.verify(e.k)}catch(e){A(dreamsecurity.err.verify,"ds.x509Crl.verify",m.data.x509Crl,e)}},a.isRevoked=function(e){try{return i.isRevoked(e)}catch(e){throw new E("ds.x509Crl.isRevoked",m.data.x509Crl,e)}},a},g.pkcs5.encrypt=function(e,t,r){if("rsa"!==e.algorithm&&"kcdsa"!==e.algorithm)throw new h("ds.pkcs5.encrypt",m.data.priKey,"Unknown privateKey algorithm : "+e.algorithm);try{f();var a=dreamsecurity.pki.priKeyToPriKeyInfo(e.k),i=dreamsecurity.pki.encryptPrivateKey(a,b(t),r)}catch(e){throw new d("ds.pkcs5.encrypt",m.data.priKey,e)}return i},g.pkcs5.decrypt=function(e,t,r){var a=null,i=0;r=r||!1;try{"string"==typeof e&&(n=null,n=0===e.lastIndexOf("-----",0)?(i=m.encoding.pem,(a=g.pem.decode(e)).body):(i=m.encoding.base64,g.base64.decode(e)),i=m.encoding.der,a=dreamsecurity.asn1.fromDer(n))}catch(e){throw new S("ds.pkcs5.decrypt",m.data.encPriKey|i,e)}var n=null,i=null;try{n=dreamsecurity.pki.decryptPrivateKeyInfo(a,b(t),r)}catch(e){t=m.data.encPriKey,void 0!==e.type&&e.type===dreamsecurity.err.decode&&(t|=m.encoding.der),A(dreamsecurity.err.decrypt,"ds.pkcs5.decrypt",t,e)}try{if(null==(i=r?n.privateKey:n))throw new Error("Confirm privateKey password.");return i=g.priKey.create(dreamsecurity.pki.privateKeyFromAsn1(i)),r?{algorithm:n.pbeAlg,version:n.pkcs5Version,fixedIv:n.fixedIv,priKey:i}:i}catch(e){void 0===e.type&&(e.message="Confirm privateKey password."),A(dreamsecurity.err.wrongPasswd,"ds.pkcs5.decrypt",m.data.encPriKey,e)}},g.pkcs5.changePassword=function(e,t,r){try{var a=g.pkcs5.decrypt(e,t,!0),i=a.algorithm.toLowerCase(),n=i.indexOf("-cbc");0<n&&(i=i.substr(0,n));var s={};s.algorithm=i,s.version=a.version,s.fixedIv=a.fixedIv;var o=dreamsecurity.pki.priKeyToPriKeyInfo(a.priKey.k);return dreamsecurity.pki.encryptPrivateKey(o,b(r),s)}catch(e){throw new E("ds.pkcs5.changePassword",e.code,e)}},g.pkcs7.signedData.format={},g.pkcs7.signedData.format.none=0,g.pkcs7.signedData.format.useContentInfo=1,g.pkcs7.signedData.format.noContent=2,g.pkcs7.signedData.format.signGateFormat=4,g.pkcs7.signedData.format.hashedContent=18,g.pkcs7.signedData.format.noSignedAttributes=32,g.pkcs7.signedData.create=function(e){var t,d={},r=0,l=null;d.contentType=null,d.content=null,d.signerInfos=[],d.certificates=[];try{f(),null!=e?0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,l=dreamsecurity.pkcs7.messageFromPem(e)):(r=m.encoding.base64,t=g.base64.decode(e),r=m.encoding.der,l=dreamsecurity.pkcs7.messageFromAsn1(dreamsecurity.asn1.fromDer(t)),d.contentType=l.contentType,d.content=l.content):l=dreamsecurity.pkcs7.createSignedData()}catch(e){throw new S("ds.pkcs7.signedData.create",m.data.signedData|r,e)}return d.makeTBSData=function(e,t,r){var a="ds.pkcs7.signedData.makeTBSData";try{if(r&&32&r.format||4&r.format)return e;var i=N(t,a),n=dreamsecurity.md.algorithms[i].create(),s={makeSignedAttributes:!0,signingTime:r?r.signingTime:void 0};return l.content=b(e),l.sign(null,null,n,null,null,s).getBytes()}catch(e){throw new C(a,m.data.signedData,e)}},d.compose=function(e,t,r,a,i){var n="ds.pkcs7.signedData.compose",s=null,o=null;try{if(1===e){var c,u=t;u&&(u.md&&(c=N(u.md,n),s=dreamsecurity.md.algorithms[c].create()),u.format&&(o=u.format));var d=R(u,(s=s||k(cert)).algorithm);l.content=b(r);var p={composeSignedData:!0,tbsData:a,signature:i};l.sign(u.cert.k,null,s,d,o,p)}else if(2===e){if(p={setContent:!0},null!==l.content)throw new E(n,m.data.signedData,"The signedData already contains the content.");l.content=b(t),l.sign(null,null,null,null,null,p)}}catch(e){throw new C(n,m.data.signedData,e)}},d.addSign=function(e,t,r){try{if(!d.verify())throw new E("ds.pkcs7.signedData.addSign",m.data.signedData,"There is a signature can't verify.");d.sign(e,t,r)}catch(e){throw e.func="ds.pkcs7.signedData.addSign",e}},d.sign=function(e,t,r){var a,i,n=null,s=null,o="ds.pkcs7.signedData.sign";try{r&&(r.md&&(i=N(r.md,o),n=dreamsecurity.md.algorithms[i].create()),r.format&&(s=r.format)),a=R(r,(n=n||k(e)).algorithm),l.content=b(d.content);for(var c=0,c=0;c<d.certificates.length;c++)l.addCertificate(d.certificates[c].k);var u={signingTime:r?r.signingTime:void 0};l.sign(e.k,t.k,n,a,s,u)}catch(e){throw new C(o,m.data.signedData,e)}},d.toDer=function(){try{return dreamsecurity.asn1.toDer(l.toAsn1())}catch(e){throw new v("ds.pkcs7.signedData.toDer",m.data.signedData|m.encoding.der,e)}},d.toPem=function(){try{return g.pem.encode(d,g.pem.type.pkcs7)}catch(e){throw new v("ds.pkcs7.signedData.toPem",m.data.signedData|m.encoding.pem,e)}},d.verify=function(){if(null==l.content){if(null==d.content)throw new E("ds.pkcs7.signedData.verify",m.data.signedData,"The content is required. The SignedData does not have a content.");l.content=b(d.content)}try{if(!l.verify())return!1;d.content=l.content,d.signerInfos=[],d.certificates=[];for(var e=0,t=[],e=0;e<l.certificates.length;e++)t.push(!1);var r=l.getSignerInfos();for(e=0;e<r.length;e++)t[r[e].certIndex]=!0,d.signerInfos.push({cert:g.x509Cert.create(l.certificates[r[e].certIndex]),signingTime:r[e].signingTime});for(e=0;e<t.length;e++)t[e]||d.certificates.push(g.x509Cert.create(l.certificates[e]));return!0}catch(e){throw new E("ds.pkcs7.signedData.verify",m.data.signedData,e)}},d},g.pkcs7.envelopedData.create=function(e){var t,s={},r=0,o=null;try{f(),o=null!=e?0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,dreamsecurity.pkcs7.messageFromPem(e)):(r=m.encoding.base64,t=g.base64.decode(e),r=m.encoding.der,dreamsecurity.pkcs7.messageFromAsn1(dreamsecurity.asn1.fromDer(t))):dreamsecurity.pkcs7.createEnvelopedData()}catch(e){throw new S("ds.pkcs7.envelopedData.create",m.data.envelopedData|r,e)}return s.content=null,s.contentEncInfo={},s.addRecipient=function(e,t){var r,a=null;try{t&&t.scheme&&"RSA-OAEP"==t.scheme.toUpperCase()&&(null!=t.md&&null!=t.md||(a=k(e))),r=B(t,a),o.addRecipient(e.k,r.scheme,r.schemeOpts)}catch(e){throw new C("ds.pkcs7.envelopedData.addRecipient",m.data.envelopedData,e)}},s.encrypt=function(e,t){var r=e.split("-"),a="ds.pkcs7.envelopedData.encrypt";if(r.length<2)throw new h(a,m.alg.symmetric,'Invalid cipher algorithm form. (ex. "SEED-CBC") : '+e);var i=1,n=r[0].toLowerCase();if(3===r.length&&(n+="-"+r[1].toUpperCase(),i=2),"seed"===n)algName="seed";else if("3des"===n||"des-EDE3"===n)algName="des-EDE3-";else if("aes"===n||"aes128"===n)algName="aes128-";else if("aes192"===n)algName="aes192-";else if("aes256"===n)algName="aes256-";else if("aria"===n||"aria128"===n)algName="aria";else if("aria192"===n)algName="aria192-";else{if("aria256"!==n)throw new h(a,m.alg.symmetric,"Unknown cipher algorithm  : "+e);algName="aria256-"}if(algName+=r[i].toUpperCase(),void 0===dreamsecurity.pki.oids[algName])throw new h(a,m.alg.symmetric,"Unknown cipher algorithm  : "+e);try{o.content=new dreamsecurity.util.ByteBuffer(s.content),o.encrypt(t,dreamsecurity.pki.oids[algName]),s.contentEncInfo=U(o.encryptedContent)}catch(e){throw new C(a,m.data.envelopedData,e)}},s.toDer=function(){try{return dreamsecurity.asn1.toDer(o.toAsn1())}catch(e){throw new v("ds.pkcs7.envelopedData.toDer",m.data.envelopedData|m.encoding.der,e)}},s.toPem=function(){try{return g.pem.encode(s,g.pem.type.pkcs7)}catch(e){throw new v("ds.pkcs7.envelopedData.toPem",m.data.envelopedData|m.encoding.pem,e)}},s.decrypt=function(e,t){var r,a="ds.pkcs7.envelopedData.decrypt";try{if(null==(r=o.findRecipient(e.k)))throw new c(a,m.data.envelopedData,"The certificiate is not a valid recipient.");o.decrypt(r,t.k),s.content=o.content.getBytes(),s.contentEncInfo=U(o.encryptedContent)}catch(e){throw new E(a,m.data.envelopedData,e)}},s},g.pkcs7.signedAndEnvData.create=function(e){var t,l={},r=0,y=null;try{f(),y=null!=e?0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,dreamsecurity.pkcs7.messageFromPem(e)):(r=m.encoding.base64,t=g.base64.decode(e),r=m.encoding.der,dreamsecurity.pkcs7.messageFromAsn1(dreamsecurity.asn1.fromDer(t))):dreamsecurity.pkcs7.createSignedAndEnvelopedData()}catch(e){throw new S("ds.pkcs7.signedAndEnvData.create",m.data.signedAndEnvData|r,e)}return l.content=null,l.signerInfos=[],l.certificates=[],l.contentEncInfo={},l.signAndEnv=function(e,t,r,a){var i,n=null,s="ds.pkcs7.signedAndEnvData.signAndEnv";try{a&&a.md&&(i=N(a.md,s),n=dreamsecurity.md.algorithms[i].create());var o=R(a,(n=n||k(e)).algorithm),c=r.split("-");if(c.length<2)throw new h(s,m.alg.symmetric,'Invalid cipher algorithm form. (ex. "SEED-CBC") : '+r);var u=1,d=c[0].toLowerCase();if(3===c.length&&(d+="-"+c[1].toUpperCase(),u=2),"seed"===d)algName="seed";else if("3des"===d||"des-EDE3"===d)algName="des-EDE3-";else if("aes"===d||"aes128"===d)algName="aes128-";else if("aes192"===d)algName="aes192-";else if("aes256"===d)algName="aes256-";else if("aria"===d||"aria128"===d)algName="aria";else if("aria192"===d)algName="aria192-";else{if("aria256"!==d)throw new h(s,m.alg.symmetric,"Unknown cipher algorithm  : "+r);algName="aria256-"}if(algName+=c[u].toUpperCase(),void 0===dreamsecurity.pki.oids[algName])throw new h(s,m.alg.symmetric,"Unknown cipher algorithm  : "+r);y.content=new dreamsecurity.util.ByteBuffer(l.content);for(var p=0,p=0;p<l.certificates.length;p++)y.addCertificate(l.certificates[p].k);y.signAndEnv(e.k,t.k,n,o,null,a?a.key:null,dreamsecurity.pki.oids[algName]),l.contentEncInfo=U(y.encryptedContent)}catch(e){throw new C(s,m.data.signedAndEnvData,e)}},l.toDer=function(){try{return dreamsecurity.asn1.toDer(y.toAsn1())}catch(e){throw new v("ds.pkcs7.signedAndEnvData.toDer",m.data.signedAndEnvData|m.encoding.der,e)}},l.toPem=function(){try{return g.pem.encode(l,g.pem.type.pkcs7)}catch(e){throw new v("ds.pkcs7.signedAndEnvData.toPem",m.data.signedAndEnvData|m.encoding.pem,e)}},l.verifyAndDec=function(e,t){try{var r,a="ds.pkcs7.signedAndEnvData.verifyAndDec";if(null==(r=y.findRecipient(e.k)))throw new c(a,m.data.signedAndEnvData,"The certificiate is not a valid recipient.");if(!y.verifyAndDec(r,t.k))return!1;l.content=y.content.getBytes(),l.signerInfos=[],l.certificates=[];for(var i=0,n=[],i=0;i<y.certificates.length;i++)n.push(!1);var s=y.getSignerInfos();for(i=0;i<s.length;i++)n[s[i].certIndex]=!0,l.signerInfos.push({cert:g.x509Cert.create(y.certificates[s[i].certIndex])});return l.contentEncInfo=U(y.encryptedContent),!0}catch(e){throw new E(a,m.data.signedAndEnvData,e)}},l.addRecipient=function(e,t){var r,a=null;try{t&&t.scheme&&"RSA-OAEP"==t.scheme.toUpperCase()&&(t.md||(a=k(e))),r=B(t,a),y.addRecipient(e.k,r.scheme,r.schemeOpts)}catch(e){throw new C("ds.pkcs7.signedAndEnvData.addRecipient",m.data.signedAndEnvData,e)}},l},g.pkcs10.create=function(){var o={},c=null;try{f(),c=dreamsecurity.pki.createCertificationRequest()}catch(e){throw new C("ds.pkcs10.create",m.data.pkcs10Csr,e)}return o.keyPair={},o.setSubject=function(e){for(var t=[],r=e.split(","),a={cn:"2.5.4.3",c:"2.5.4.6",o:"2.5.4.10",ou:"2.5.4.11"},i=0,i=0;i<r.length;i++){var n=r[i].split("=");if(2!=n.length)throw new C("ds.pkcs10.create",m.data.pkcs10Csr,"The dn is wrong format. : "+e);t.push({type:a[n[0]],value:n[1]})}try{c.setSubject(t)}catch(e){throw new C("ds.pkcs10.create",m.data.pkcs10Csr,e)}},o.sign=function(e,t){var r,a,i,n=null,s="ds.pkcs10.sign";n=null==e?dreamsecurity.md.algorithms.sha256.create():"string"==typeof e?(r=N(e,s),dreamsecurity.md.algorithms[r].create()):e.digest({getEngine:!0});try{null!=o.keyPair.privateKey&&null!=o.keyPair.publicKey||(a="",i=0,i=null!=t?(a=null==t.algorithm?"rsa":t.algorithm.toLowerCase(),null==t.bits?2048:t.bits):(a="rsa",2048),o.keyPair=g.generateKeyPair(a,{bits:i})),c.version=0,c.publicKey=o.keyPair.publicKey.k,c.sign(o.keyPair.privateKey.k,n)}catch(e){A(dreamsecurity.err.generate,s,m.data.pkcs10Csr,e)}},o.toPem=function(){try{return g.pem.encode(o,g.pem.type.pkcs10)}catch(e){throw new v("ds.pkcs10.toPem",m.data.pkcs10Csr|m.encoding.pem,e)}},o.toDer=function(){try{return dreamsecurity.asn1.toDer(dreamsecurity.pki.certificationRequestToAsn1(c))}catch(e){throw new v("ds.pkcs10.toDer",m.data.pkcs10Csr|m.encoding.der,e)}},o},g.pkcs12.format={},g.pkcs12.format.encPriKey=1,g.pkcs12.format.noEncCert=2,g.pkcs12.create=function(e){var p={},l=null;try{f()}catch(e){throw new C("ds.pkcs10.create",m.data.pkcs10Csr,e)}return l=null!=e?e:null,p.safeContents=[],p.certificates=[],p.exportPfx=function(e,t){if(0===p.safeContents.length)throw new C("ds.pkcs12.exportPfx",m.data.pkcs12Pfx,"A certificate and priKey pair is not setted.");try{for(var r=0,a=[],i=[],r=0;r<p.safeContents.length;r++){var n=null;null==(n=t&&t.format&&t.format&g.pkcs12.format.encPriKey?0===p.safeContents[r].priKey.lastIndexOf("-----",0)?g.pem.decode(p.safeContents[r].priKey).body:g.base64.decode(p.safeContents[r].priKey):n)&&(n=p.safeContents[r].priKey.k),a.push({cert:p.safeContents[r].cert.k,priKey:n,keyId:String.fromCharCode(4)+String.fromCharCode(4)+String.fromCharCode(r+1)+String.fromCharCode(0)+String.fromCharCode(0)+String.fromCharCode(0)})}for(r=0;r<p.certificates.length;r++)i.push(p.certificates[r].k);p.pfx=dreamsecurity.pkcs12.toPkcs12Asn1(a,i,b(e),t)}catch(e){throw new C("ds.pkcs12.exportPfx",m.data.pkcs12Pfx,e)}},p.toDer=function(){try{return dreamsecurity.asn1.toDer(p.pfx)}catch(e){throw new v("ds.pkcs12.toDer",m.data.pkcs12Pfx|m.encoding.der,e)}},p.importPfx=function(e,t){try{m.encoding.base64;var r=dreamsecurity.util.decode64(l),r=dreamsecurity.asn1.fromDer(r);l=dreamsecurity.pkcs12.pkcs12FromAsn1(r,!0,b(e),t)}catch(e){if(e.type!=dreamsecurity.err.wrongPasswd)throw new E("ds.pkcs12.importPfx",m.data.pkcs12Pfx,e);A(dreamsecurity.err.wrongPasswd,"ds.pkcs12.importPfx",m.data.pkcs12Pfx,e)}var a=0,i=0,n=[],s=[],o=[];try{for(a=0;a<l.safeContents.length;a++)for(var c=0,u=l.safeContents[a],c=0;c<u.safeBags.length;c++)if(null!=u.safeBags[c].attributes.localKeyId)if(0==a){for(var d=-1,i=0;i<n.length;i++)if(n[i]===u.safeBags[c].attributes.localKeyId[0]){d=i;break}-1==d&&n.push(u.safeBags[c].attributes.localKeyId[0]),null!=u.safeBags[c].key?-1==d?(o.push(u.safeBags[c].key),s.push(null)):o[i]=u.safeBags[c].key:-1==d?(o.push(null),s.push(u.safeBags[c].cert)):s[i]=u.safeBags[c].cert}else for(i=0;i<n.length;i++)n[i]===u.safeBags[c].attributes.localKeyId[0]&&(null!=u.safeBags[c].key?o[i]=u.safeBags[c].key:s[i]=u.safeBags[c].cert);else p.certificates.push(g.x509Cert.create(u.safeBags[c].cert));for(a=0;a<n.length;a++)t&&t.format&&t.format&g.pkcs12.format.encPriKey?p.safeContents.push({cert:g.x509Cert.create(s[a]),priKey:dreamsecurity.asn1.toDer(o[a])}):p.safeContents.push({cert:g.x509Cert.create(s[a]),priKey:g.priKey.create(o[a])})}catch(e){throw new E("ds.pkcs12.importPfx",m.data.pkcs12Pfx,e)}},p},g.tsp.token.create=function(e){var s={signerCert:null};if(!e)throw new T("ds.tsp.token.create",m.data.tsp,"The input data is empty.");try{f(),s.token=g.pkcs7.signedData.create(e)}catch(e){throw new S("ds.tsp.token.create",m.data.tsp|m.encoding.der,e)}if(s.token.contentType!==dreamsecurity.oids.tstInfo)throw new T("ds.tsp.token.create",m.data.tsp,"The input data is not a timeStampToken.");try{s.info=dreamsecurity.tsp.tstInfoFromAsn1(dreamsecurity.asn1.fromDer(s.token.content))}catch(e){throw new S("ds.tsp.token.create",m.data.tsp|m.encoding.der,e)}return s.info.tsa=w(s.info.tsa.dn),s.verify=function(e,t){if(!s.token.verify())throw new y("ds.tsp.token.verify",m.data.tsp|m.alg.sign,"Verification of a signature in timeStampToken is failed.");try{var r=s.info.msgImprint,a=dreamsecurity.oids[r.hashAlg],i=dreamsecurity.md.algorithms[a].create();i.update(b(e));var n=i.digest()}catch(e){throw new y("ds.tsp.token.verify",m.data.tsp,"Verification of a messageImprint in timeStampToken is failed. ("+e.message+")")}if(n.toHex()!=dreamsecurity.util.bytesToHex(b(r.hashedMessage)))throw new y("ds.tsp.token.verify",m.data.tsp|m.alg.md,"The msg is not for this timeStampToken (The messageImprint is different).");if(1!=s.token.signerInfos.length)throw new y("ds.tsp.token.verify",m.data.tsp,"The count of signer is not 1.");s.signerCert=s.token.signerInfos[0].cert},s},g.arcCert.response.create=function(e){var t="ds.arcCert.response.create",n={signerCert:null};if(!e)throw new T(t,m.data.arccert,"The input data is empty.");try{f(),n.response=g.pkcs7.signedData.create(e)}catch(e){throw new S(t,m.data.arccert|m.encoding.der,e)}if(n.response.contentType!==dreamsecurity.oids.arcCertRes)throw new T(t,m.data.arccert,"The input data is not a arcCertResponse.");try{n.info=dreamsecurity.arcCert.arcCertResFromAsn1(dreamsecurity.asn1.fromDer(n.response.content))}catch(e){throw new S(t,m.data.arccert|m.encoding.der,e)}return n.verify=function(e,t){var r="ds.arcCert.response.verify";if(!n.response.verify())throw new y(r,m.data.arcCert|m.alg.sign,"Verification of a signature in ArcCert is failed.");try{var a=n.info.target;if("dataHash"!=a.choice)throw new h(r,m.data.arcCert,a.choice+" in Target is not supported");var i=dreamsecurity.md.algorithms[a.hashAlg].create();if(i.update(b(e)),i.digest().toHex()!=dreamsecurity.util.bytesToHex(b(a.hashedData)))throw new y(r,m.data.arcCert|m.alg.md,"The msg is not for this ArcCert (The dataHash is different).")}catch(e){throw new y(r,m.data.arcCert,"Verification of a dataHash in ArcCert is failed. ("+e.message+")")}if(1!=n.response.signerInfos.length)throw new y(r,m.data.arcCert,"The count of signer is not 1.");n.signerCert=n.response.signerInfos[0].cert},n},g.pem.type={},g.pem.type.publicKey="PUBLIC KEY",g.pem.type.privateKey="PRIVATE KEY",g.pem.type.rsaPubKey="RSA PUBLIC KEY",g.pem.type.rsaPriKey="RSA PRIVATE KEY",g.pem.type.cert="CERTIFICATE",g.pem.type.crl="X509 CRL",g.pem.type.pkcs7="PKCS7",g.pem.type.pkcs10="CERTIFICATE REQUEST",g.pem.type.encPriKey="ENCRYPTED PRIVATE KEY",g.pem.encode=function(e,t){var r={};try{return f(),r.type=t,"toDer"in e?r.body=e.toDer().getBytes():r.body=b(e),dreamsecurity.pem.encode(r)}catch(e){A(dreamsecurity.err.encode,"ds.pem.encode",m.encoding.pem,e.type&&e.message?e.message:"The "+t+" pem encoding failed.")}},g.pem.decode=function(e){try{return f(),dreamsecurity.pem.decode(b(e))[0]}catch(e){A(dreamsecurity.err.decode,"ds.pem.decode",m.encoding.pem,e.type&&e.message?e.message:"The pem decoding failed.")}},g.base64.encode=function(e){try{return f(),dreamsecurity.util.encode64(b(e))}catch(e){A(dreamsecurity.err.encode,"ds.base64.encode",m.encoding.base64,e.type&&e.message?e.message:"The Base64 encoding failed.")}},g.base64.decode=function(e){try{return f(),dreamsecurity.util.decode64(b(e))}catch(e){A(dreamsecurity.err.decode,"ds.base64.decode",m.encoding.base64,e.type&&e.message?e.message:"The Base64 decoding failed.")}},g.hex.encode=function(e){try{return f(),dreamsecurity.util.bytesToHex(b(e))}catch(e){A(dreamsecurity.err.encode,"ds.hex.encode",m.encoding.hex,e.type&&e.message?e.message:"The Hex encoding failed.")}},g.hex.decode=function(e){try{return f(),dreamsecurity.util.hexToBytes(b(e))}catch(e){A(dreamsecurity.err.decode,"ds.hex.decode",m.encoding.hex,e.type&&e.message?e.message:"The Hex decoding failed.")}},g.utf8.encode=function(e){try{return f(),dreamsecurity.util.encodeUtf8(b(e))}catch(e){A(dreamsecurity.err.encode,"ds.utf8.encode",m.encoding.utf8,e.type&&e.message?e:"The UTF8 encoding failed.")}},g.utf8.decode=function(e){try{return f(),dreamsecurity.util.decodeUtf8(b(e))}catch(e){A(dreamsecurity.err.decode,m.encoding.utf8,e.type&&e.message?e.message:"The UTF8 decoding failed.")}},g.ByteStringBuffer.create=function(e){return f(),dreamsecurity.util.createBuffer(e)},"function"==typeof Object.freeze&&Object.freeze(g)}(magicjs);